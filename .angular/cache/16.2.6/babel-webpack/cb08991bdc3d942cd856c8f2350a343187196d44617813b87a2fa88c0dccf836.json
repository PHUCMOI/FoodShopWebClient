{"ast":null,"code":"/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { BinaryStream, ucs2encode, base64ToUint8Array, HAS_TYPED_ARRAYS } from \"./utils\";\nimport { support } from '../common';\nimport { TTFFont } from \"./ttf\";\nimport { deflate, supportsDeflate } from './deflate';\nimport { encodeUTF16BE, BOM } from \"../util/encode-utf\";\nimport { encodeBase64 } from \"../util\";\nconst browser = support.browser;\nconst NL = \"\\n\";\nvar RESOURCE_COUNTER = 0;\nconst PAPER_SIZE = {\n  a0: [2383.94, 3370.39],\n  a1: [1683.78, 2383.94],\n  a2: [1190.55, 1683.78],\n  a3: [841.89, 1190.55],\n  a4: [595.28, 841.89],\n  a5: [419.53, 595.28],\n  a6: [297.64, 419.53],\n  a7: [209.76, 297.64],\n  a8: [147.40, 209.76],\n  a9: [104.88, 147.40],\n  a10: [73.70, 104.88],\n  b0: [2834.65, 4008.19],\n  b1: [2004.09, 2834.65],\n  b2: [1417.32, 2004.09],\n  b3: [1000.63, 1417.32],\n  b4: [708.66, 1000.63],\n  b5: [498.90, 708.66],\n  b6: [354.33, 498.90],\n  b7: [249.45, 354.33],\n  b8: [175.75, 249.45],\n  b9: [124.72, 175.75],\n  b10: [87.87, 124.72],\n  c0: [2599.37, 3676.54],\n  c1: [1836.85, 2599.37],\n  c2: [1298.27, 1836.85],\n  c3: [918.43, 1298.27],\n  c4: [649.13, 918.43],\n  c5: [459.21, 649.13],\n  c6: [323.15, 459.21],\n  c7: [229.61, 323.15],\n  c8: [161.57, 229.61],\n  c9: [113.39, 161.57],\n  c10: [79.37, 113.39],\n  executive: [521.86, 756.00],\n  folio: [612.00, 936.00],\n  legal: [612.00, 1008.00],\n  letter: [612.00, 792.00],\n  tabloid: [792.00, 1224.00]\n};\nfunction makeOutput() {\n  var indentLevel = 0,\n    output = BinaryStream();\n  function out() {\n    for (var i = 0; i < arguments.length; ++i) {\n      var x = arguments[i];\n      if (x === undefined) {\n        throw new Error(\"Cannot output undefined to PDF\");\n      } else if (x instanceof PDFValue) {\n        x.beforeRender(out);\n        x.render(out);\n      } else if (isArray(x)) {\n        renderArray(x, out);\n      } else if (isDate(x)) {\n        renderDate(x, out);\n      } else if (typeof x == \"number\") {\n        if (isNaN(x)) {\n          throw new Error(\"Cannot output NaN to PDF\");\n        }\n        // make sure it doesn't end up in exponent notation\n        var num = x.toFixed(7);\n        if (num.indexOf(\".\") >= 0) {\n          num = num.replace(/\\.?0+$/, \"\");\n        }\n        if (num == \"-0\") {\n          num = \"0\";\n        }\n        output.writeString(num);\n      } else if (/string|boolean/.test(typeof x)) {\n        output.writeString(String(x));\n      } else if (typeof x.get == \"function\") {\n        output.write(x.get());\n      } else if (typeof x == \"object\") {\n        if (!x) {\n          output.writeString(\"null\");\n        } else {\n          out(new PDFDictionary(x));\n        }\n      }\n    }\n  }\n  out.writeData = function (data) {\n    output.write(data);\n  };\n  out.withIndent = function (f) {\n    ++indentLevel;\n    f(out);\n    --indentLevel;\n  };\n  out.indent = function () {\n    out(NL, pad(\"\", indentLevel * 2, \"  \"));\n    out.apply(null, arguments);\n  };\n  out.offset = function () {\n    return output.offset();\n  };\n  out.toString = function () {\n    throw new Error(\"FIX CALLER\");\n  };\n  out.get = function () {\n    return output.get();\n  };\n  out.stream = function () {\n    return output;\n  };\n  return out;\n}\nfunction wrapObject(value, id) {\n  var beforeRender = value.beforeRender;\n  var renderValue = value.render;\n  value.beforeRender = function () {};\n  value.render = function (out) {\n    out(id, \" 0 R\");\n  };\n  value.renderFull = function (out) {\n    value._offset = out.offset();\n    out(id, \" 0 obj \");\n    beforeRender.call(value, out);\n    renderValue.call(value, out);\n    out(\" endobj\");\n  };\n}\nfunction getPaperOptions(getOption) {\n  if (typeof getOption != \"function\") {\n    var options = getOption;\n    getOption = function (key, def) {\n      return key in options ? options[key] : def;\n    };\n  }\n  var paperSize = getOption(\"paperSize\", PAPER_SIZE.a4);\n  if (!paperSize) {\n    return {};\n  }\n  if (typeof paperSize == \"string\") {\n    paperSize = PAPER_SIZE[paperSize.toLowerCase()];\n    if (paperSize == null) {\n      throw new Error(\"Unknown paper size\");\n    }\n  }\n  paperSize[0] = unitsToPoints(paperSize[0]);\n  paperSize[1] = unitsToPoints(paperSize[1]);\n  if (getOption(\"landscape\", false)) {\n    paperSize = [Math.max(paperSize[0], paperSize[1]), Math.min(paperSize[0], paperSize[1])];\n  }\n  var margin = getOption(\"margin\");\n  if (margin) {\n    if (typeof margin == \"string\" || typeof margin == \"number\") {\n      margin = unitsToPoints(margin, 0);\n      margin = {\n        left: margin,\n        top: margin,\n        right: margin,\n        bottom: margin\n      };\n    } else {\n      margin = {\n        left: unitsToPoints(margin.left, 0),\n        top: unitsToPoints(margin.top, 0),\n        right: unitsToPoints(margin.right, 0),\n        bottom: unitsToPoints(margin.bottom, 0)\n      };\n    }\n    if (getOption(\"addMargin\")) {\n      paperSize[0] += margin.left + margin.right;\n      paperSize[1] += margin.top + margin.bottom;\n    }\n  }\n  return {\n    paperSize: paperSize,\n    margin: margin\n  };\n}\nvar FONT_CACHE = {\n  \"Times-Roman\": true,\n  \"Times-Bold\": true,\n  \"Times-Italic\": true,\n  \"Times-BoldItalic\": true,\n  \"Helvetica\": true,\n  \"Helvetica-Bold\": true,\n  \"Helvetica-Oblique\": true,\n  \"Helvetica-BoldOblique\": true,\n  \"Courier\": true,\n  \"Courier-Bold\": true,\n  \"Courier-Oblique\": true,\n  \"Courier-BoldOblique\": true,\n  \"Symbol\": true,\n  \"ZapfDingbats\": true\n};\nfunction loadBinary(url, cont) {\n  // IE throws Accesss denied error for Data URIs\n  let m;\n  if (browser.msie && (m = /^data:.*?;base64,/i.exec(url))) {\n    cont(base64ToUint8Array(url.substr(m[0].length)));\n    return;\n  }\n  function error() {\n    if (window.console) {\n      if (window.console.error) {\n        window.console.error(\"Cannot load URL: %s\", url);\n      } else {\n        window.console.log(\"Cannot load URL: %s\", url);\n      }\n    }\n    cont(null);\n  }\n  var req = new XMLHttpRequest();\n  req.open('GET', url, true);\n  if (HAS_TYPED_ARRAYS) {\n    req.responseType = \"arraybuffer\";\n  }\n  req.onload = function () {\n    if (req.status == 200 || req.status == 304) {\n      if (HAS_TYPED_ARRAYS) {\n        cont(new Uint8Array(req.response));\n      } else {\n        cont(new window.VBArray(req.responseBody).toArray()); // IE9 only\n      }\n    } else {\n      error();\n    }\n  };\n  req.onerror = error;\n  req.send(null);\n}\nfunction loadFont(url, cont) {\n  var font = FONT_CACHE[url];\n  if (font) {\n    cont(font);\n  } else {\n    loadBinary(url, function (data) {\n      if (data == null) {\n        throw new Error(\"Cannot load font from \" + url);\n      } else {\n        var font = new TTFFont(data);\n        FONT_CACHE[url] = font;\n        cont(font);\n      }\n    });\n  }\n}\nvar IMAGE_CACHE = {};\nfunction clearImageCache() {\n  IMAGE_CACHE = {};\n}\nfunction loadImage(url, size, cont, options) {\n  var img = IMAGE_CACHE[url],\n    bloburl,\n    blob;\n  if (img) {\n    cont(img);\n  } else {\n    img = new Image();\n    if (!/^data:/i.test(url)) {\n      img.crossOrigin = \"Anonymous\";\n    }\n    if (HAS_TYPED_ARRAYS && !/^data:/i.test(url)) {\n      // IE10 fails to load images from another domain even when the server sends the\n      // proper CORS headers.  a XHR, however, will be able to load the data.\n      // http://stackoverflow.com/a/19734516/154985\n      //\n      // On the other hand, it's worth doing it this way for all browsers which support\n      // responseType = \"blob\" (HAS_TYPED_ARRAYS will be true), because we can inspect the\n      // mime type and if it's a JPEG (very common case) we can save a lot of time in\n      // _load below.\n      var xhr = new XMLHttpRequest();\n      xhr.onload = function () {\n        blob = xhr.response;\n        if (browser.mozilla && blob.type == \"image/svg+xml\") {\n          // Firefox won't render SVGs that don't contain width and height attributes.\n          let reader = new FileReader();\n          reader.onload = function () {\n            let doc = new window.DOMParser().parseFromString(this.result, \"image/svg+xml\");\n            let svg = doc.documentElement;\n            if (svg.getAttribute(\"width\") && svg.getAttribute(\"height\")) {\n              // we're good, continue with the existing blob.\n              bloburl = URL.createObjectURL(blob);\n              _load(bloburl);\n            } else {\n              svg.setAttribute(\"width\", size.width);\n              svg.setAttribute(\"height\", size.height);\n              let xml = new window.XMLSerializer().serializeToString(svg);\n              let dataURL = `data:image/svg+xml;base64,${encodeBase64(xml)}`;\n              _load(dataURL);\n            }\n          };\n          reader.readAsText(blob);\n        } else {\n          bloburl = URL.createObjectURL(blob);\n          _load(bloburl);\n        }\n      };\n      xhr.onerror = _onerror;\n      xhr.open(\"GET\", url, true);\n      xhr.responseType = \"blob\";\n      xhr.send();\n    } else {\n      _load(url);\n    }\n  }\n  function _load(url) {\n    img.src = url;\n    if (img.complete && !browser.msie) {\n      // IE, bless its little heart, says img.complete == true even though the image is\n      // not loaded (width=0), therefore we must go the onload route (ticket 929635).\n      _onload.call(img);\n    } else {\n      img.onload = _onload;\n      img.onerror = _onerror;\n    }\n  }\n  function _trycanvas() {\n    if (!size) {\n      size = {\n        width: img.width,\n        height: img.height\n      };\n    }\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = size.width;\n    canvas.height = size.height;\n    var ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0, size.width, size.height);\n    var imgdata;\n    try {\n      imgdata = ctx.getImageData(0, 0, size.width, size.height);\n    } catch (ex) {\n      // it tainted the canvas -- can't draw it.\n      _onerror();\n      return;\n    } finally {\n      if (bloburl) {\n        URL.revokeObjectURL(bloburl);\n      }\n    }\n\n    // in case it contains transparency, we must separate rgb data from the alpha\n    // channel and create a PDFRawImage image with opacity.  otherwise we can use a\n    // PDFJpegImage.\n    //\n    // to do this in one step, we create the rgb and alpha streams anyway, even if\n    // we might end up not using them if hasAlpha remains false.\n\n    var hasAlpha = false,\n      rgb = BinaryStream(),\n      alpha = BinaryStream();\n    var rawbytes = imgdata.data;\n    var i = 0;\n    while (i < rawbytes.length) {\n      rgb.writeByte(rawbytes[i++]);\n      rgb.writeByte(rawbytes[i++]);\n      rgb.writeByte(rawbytes[i++]);\n      var a = rawbytes[i++];\n      if (a < 255) {\n        hasAlpha = true;\n      }\n      alpha.writeByte(a);\n    }\n    if (hasAlpha || options.keepPNG) {\n      img = new PDFRawImage(size.width, size.height, rgb, alpha);\n    } else {\n      // no transparency, encode as JPEG.\n      var data = canvas.toDataURL(\"image/jpeg\", options.jpegQuality);\n      data = data.substr(data.indexOf(\";base64,\") + 8);\n      var stream = BinaryStream();\n      stream.writeBase64(data);\n      img = new PDFJpegImage(stream);\n    }\n    cont(IMAGE_CACHE[url] = img);\n  }\n  function _onerror() {\n    cont(IMAGE_CACHE[url] = \"ERROR\");\n  }\n  function _onload() {\n    if (size) {\n      const svg = blob && blob.type === 'image/svg+xml' || /^data:image\\/svg\\+xml;/i.test(this.src.substring(0, 19));\n      const upscale = size.width >= img.width || size.height >= img.height;\n\n      // Use the original image if requested size is bigger than the source,\n      // unless it's an SVG that can be upscaled.\n      if (!svg && upscale) {\n        size = null;\n      }\n    }\n    if (!size && blob && /^image\\/jpe?g$/i.test(blob.type)) {\n      // If we know we got a JPEG, we can skip the process of rendering it to a\n      // canvas, getting the pixel data, searching for transparency we know we won't\n      // find, getting back a data URI and then decoding the BASE64 to finally get the\n      // binary we already have.  Also, we avoid downgrading the image quality, with\n      // the possible drawback of making a bigger PDF; still, seems legit.\n      //\n      // Besides saving a lot of work, this also reuses the buffer memory\n      // (BinaryStream does not create a copy), potentially saving some GC cycles.\n      let reader = new FileReader();\n      reader.onload = function () {\n        try {\n          let img = new PDFJpegImage(BinaryStream(new Uint8Array(this.result)));\n          URL.revokeObjectURL(bloburl);\n          cont(IMAGE_CACHE[url] = img);\n        } catch (ex) {\n          // if there's an error parsing the JPEG stream, it could be due to a\n          // misconfigured server (improper content-type:\n          // https://github.com/telerik/kendo-ui-core/issues/4184).  If that's the case,\n          // the canvas will still be able to draw it.\n          _trycanvas();\n        }\n      };\n      reader.readAsArrayBuffer(blob);\n    } else {\n      _trycanvas();\n    }\n  }\n}\nfunction manyLoader(loadOne) {\n  return function (urls, callback) {\n    var n = urls.length,\n      i = n;\n    if (n === 0) {\n      return callback();\n    }\n    function next() {\n      if (--n === 0) {\n        callback();\n      }\n    }\n    while (i-- > 0) {\n      loadOne(urls[i], next);\n    }\n  };\n}\nvar loadFonts = manyLoader(loadFont);\nvar loadImages = function (images, callback, options) {\n  options = Object.assign({\n    jpegQuality: 0.92,\n    keepPNG: false\n  }, options);\n  var urls = Object.keys(images),\n    n = urls.length;\n  if (n === 0) {\n    return callback();\n  }\n  function next() {\n    if (--n === 0) {\n      callback();\n    }\n  }\n  urls.forEach(function (url) {\n    loadImage(url, images[url], next, options);\n  });\n};\nclass PDFDocument {\n  constructor(options) {\n    var self = this;\n    var out = makeOutput();\n    var objcount = 0;\n    var objects = [];\n    function getOption(name, defval) {\n      return options && options[name] != null ? options[name] : defval;\n    }\n    self.getOption = getOption;\n    self.attach = function (value) {\n      if (objects.indexOf(value) < 0) {\n        wrapObject(value, ++objcount);\n        objects.push(value);\n      }\n      return value;\n    };\n    self.pages = [];\n    self.FONTS = {};\n    self.IMAGES = {};\n    self.GRAD_COL_FUNCTIONS = {}; // cache for color gradient functions\n    self.GRAD_OPC_FUNCTIONS = {}; // cache for opacity gradient functions\n    self.GRAD_COL = {}; // cache for whole color gradient objects\n    self.GRAD_OPC = {}; // cache for whole opacity gradient objects\n\n    var catalog = self.attach(new PDFCatalog());\n    var pageTree = self.attach(new PDFPageTree());\n    if (getOption(\"autoPrint\")) {\n      let nameTree = {};\n      nameTree.JavaScript = new PDFDictionary({\n        Names: [new PDFString(\"JS\"), self.attach(new PDFDictionary({\n          S: _(\"JavaScript\"),\n          JS: new PDFString(\"print(true);\")\n        }))]\n      });\n      catalog.props.Names = new PDFDictionary(nameTree);\n    }\n    catalog.setPages(pageTree);\n    var info = self.attach(new PDFDictionary({\n      Producer: new PDFString(getOption(\"producer\", \"Kendo UI PDF Generator\"), true),\n      // XXX: kendo.version?\n      Title: new PDFString(getOption(\"title\", \"\"), true),\n      Author: new PDFString(getOption(\"author\", \"\"), true),\n      Subject: new PDFString(getOption(\"subject\", \"\"), true),\n      Keywords: new PDFString(getOption(\"keywords\", \"\"), true),\n      Creator: new PDFString(getOption(\"creator\", \"Kendo UI PDF Generator\"), true),\n      CreationDate: getOption(\"date\", new Date())\n    }));\n    self.addPage = function (options) {\n      var paperOptions = getPaperOptions(function (name, defval) {\n        return options && options[name] != null ? options[name] : defval;\n      });\n      var paperSize = paperOptions.paperSize;\n      var margin = paperOptions.margin;\n      var contentWidth = paperSize[0];\n      var contentHeight = paperSize[1];\n      if (margin) {\n        contentWidth -= margin.left + margin.right;\n        contentHeight -= margin.top + margin.bottom;\n      }\n      var content = new PDFStream(makeOutput(), null, true);\n      var props = {\n        Contents: self.attach(content),\n        Parent: pageTree,\n        MediaBox: [0, 0, paperSize[0], paperSize[1]]\n      };\n      var page = new PDFPage(self, props);\n      page._content = content;\n      pageTree.addPage(self.attach(page));\n\n      // canvas-like coord. system.  (0,0) is upper-left.\n      // text must be vertically mirorred before drawing.\n      page.transform(1, 0, 0, -1, 0, paperSize[1]);\n      if (margin) {\n        page.translate(margin.left, margin.top);\n        // XXX: clip to right/bottom margin.  Make this optional?\n        page.rect(0, 0, contentWidth, contentHeight);\n        page.clip();\n      }\n      self.pages.push(page);\n      return page;\n    };\n    self.render = function () {\n      var i;\n      /// file header\n      out(\"%PDF-1.4\", NL, \"%\\xc2\\xc1\\xda\\xcf\\xce\", NL, NL);\n\n      /// file body\n      for (i = 0; i < objects.length; ++i) {\n        objects[i].renderFull(out);\n        out(NL, NL);\n      }\n\n      /// cross-reference table\n      var xrefOffset = out.offset();\n      out(\"xref\", NL, 0, \" \", objects.length + 1, NL);\n      out(\"0000000000 65535 f \", NL);\n      for (i = 0; i < objects.length; ++i) {\n        out(zeropad(objects[i]._offset, 10), \" 00000 n \", NL);\n      }\n      out(NL);\n\n      /// trailer\n      out(\"trailer\", NL);\n      out(new PDFDictionary({\n        Size: objects.length + 1,\n        Root: catalog,\n        Info: info\n      }), NL, NL);\n\n      /// end\n      out(\"startxref\", NL, xrefOffset, NL);\n      out(\"%%EOF\", NL);\n      return out.stream().offset(0);\n    };\n    self.loadFonts = loadFonts;\n    self.loadImages = loadImages;\n  }\n  getFont(url) {\n    var font = this.FONTS[url];\n    if (!font) {\n      font = FONT_CACHE[url];\n      if (!font) {\n        throw new Error(\"Font \" + url + \" has not been loaded\");\n      }\n      if (font === true) {\n        font = this.attach(new PDFStandardFont(url));\n      } else {\n        font = this.attach(new PDFFont(this, font));\n      }\n      this.FONTS[url] = font;\n    }\n    return font;\n  }\n  getImage(url) {\n    var img = this.IMAGES[url];\n    if (!img) {\n      img = IMAGE_CACHE[url];\n      if (!img) {\n        throw new Error(\"Image \" + url + \" has not been loaded\");\n      }\n      if (img === \"ERROR\") {\n        return null;\n      }\n      img = this.IMAGES[url] = this.attach(img.asStream(this));\n    }\n    return img;\n  }\n  getOpacityGS(opacity, forStroke) {\n    var id = parseFloat(opacity).toFixed(3);\n    opacity = parseFloat(id);\n    id += forStroke ? \"S\" : \"F\";\n    var cache = this._opacityGSCache || (this._opacityGSCache = {});\n    var gs = cache[id];\n    if (!gs) {\n      var props = {\n        Type: _(\"ExtGState\")\n      };\n      if (forStroke) {\n        props.CA = opacity;\n      } else {\n        props.ca = opacity;\n      }\n      gs = this.attach(new PDFDictionary(props));\n      gs._resourceName = _(\"GS\" + ++RESOURCE_COUNTER);\n      cache[id] = gs;\n    }\n    return gs;\n  }\n  dict(props) {\n    return new PDFDictionary(props);\n  }\n  name(str) {\n    return _(str);\n  }\n  stream(props, content) {\n    return new PDFStream(content, props);\n  }\n}\n\n/* -----[ utils ]----- */\n\nfunction pad(str, len, ch) {\n  while (str.length < len) {\n    str = ch + str;\n  }\n  return str;\n}\nfunction zeropad(n, len) {\n  return pad(String(n), len, \"0\");\n}\nfunction hasOwnProperty(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\nvar isArray = Array.isArray || function (obj) {\n  return obj instanceof Array;\n};\nfunction isDate(obj) {\n  return obj instanceof Date;\n}\nfunction renderArray(a, out) {\n  out(\"[\");\n  if (a.length > 0) {\n    out.withIndent(function () {\n      for (var i = 0; i < a.length; ++i) {\n        if (i > 0 && i % 8 === 0) {\n          out.indent(a[i]);\n        } else {\n          out(\" \", a[i]);\n        }\n      }\n    });\n    //out.indent();\n  }\n\n  out(\" ]\");\n}\nfunction renderDate(date, out) {\n  out(\"(D:\", zeropad(date.getUTCFullYear(), 4), zeropad(date.getUTCMonth() + 1, 2), zeropad(date.getUTCDate(), 2), zeropad(date.getUTCHours(), 2), zeropad(date.getUTCMinutes(), 2), zeropad(date.getUTCSeconds(), 2), \"Z)\");\n}\nfunction mm2pt(mm) {\n  return mm * (72 / 25.4);\n}\nfunction cm2pt(cm) {\n  return mm2pt(cm * 10);\n}\nfunction in2pt(inch) {\n  return inch * 72;\n}\nfunction unitsToPoints(x, def) {\n  if (typeof x == \"number\") {\n    return x;\n  }\n  if (typeof x == \"string\") {\n    var m;\n    m = /^\\s*([0-9.]+)\\s*(mm|cm|in|pt)\\s*$/.exec(x);\n    if (m) {\n      var num = parseFloat(m[1]);\n      if (!isNaN(num)) {\n        if (m[2] == \"pt\") {\n          return num;\n        }\n        return {\n          \"mm\": mm2pt,\n          \"cm\": cm2pt,\n          \"in\": in2pt\n        }[m[2]](num);\n      }\n    }\n  }\n  if (def != null) {\n    return def;\n  }\n  throw new Error(\"Can't parse unit: \" + x);\n}\n\n/* -----[ PDF basic objects ]----- */\n\nclass PDFValue {\n  beforeRender() {}\n}\nclass PDFString extends PDFValue {\n  constructor(value, utf16be) {\n    super();\n    this.value = value;\n    this.utf16be = Boolean(utf16be);\n  }\n  render(out) {\n    let txt = this.value;\n    if (this.utf16be) {\n      txt = BOM + encodeUTF16BE(txt);\n      txt = txt.replace(/([\\(\\)\\\\])/g, \"\\\\$1\");\n      out(\"(\", txt, \")\");\n    } else {\n      // out.writeString truncates charcodes to 8 bits and\n      // 0x128 & 0xFF is 40, the code for open paren.\n      // therefore we need to do the chopping here to make\n      // sure we backslash all cases.\n      let data = [40]; // open PDF string '('\n      for (var i = 0; i < txt.length; ++i) {\n        let code = txt.charCodeAt(i) & 0xFF;\n        if (code == 40 || code == 41 || code == 92) {\n          // backslash before (, ) and \\\n          data.push(92);\n        }\n        data.push(code);\n      }\n      data.push(41); // ')' close PDF string\n      out.writeData(data);\n    }\n  }\n  toString() {\n    return this.value;\n  }\n}\nclass PDFHexString extends PDFString {\n  constructor(value) {\n    super(value);\n    this.value = value;\n  }\n  render(out) {\n    out(\"<\");\n    for (var i = 0; i < this.value.length; ++i) {\n      out(zeropad(this.value.charCodeAt(i).toString(16), 4));\n    }\n    out(\">\");\n  }\n}\n\n/// names\nclass PDFName extends PDFValue {\n  static get(name) {\n    return _(name);\n  }\n  constructor(name) {\n    super();\n    this.name = name;\n  }\n  render(out) {\n    out(\"/\" + this.escape());\n  }\n  escape() {\n    return this.name.replace(/[^\\x21-\\x7E]/g, function (c) {\n      return \"#\" + zeropad(c.charCodeAt(0).toString(16), 2);\n    });\n  }\n  toString() {\n    return this.name;\n  }\n}\nvar PDFName_cache = {};\nfunction _(name) {\n  if (hasOwnProperty(PDFName_cache, name)) {\n    return PDFName_cache[name];\n  }\n  return PDFName_cache[name] = new PDFName(name);\n}\n\n/// dictionary\n\nclass PDFDictionary extends PDFValue {\n  constructor(props) {\n    super();\n    this.props = props;\n  }\n  render(out) {\n    var props = this.props,\n      empty = true;\n    out(\"<<\");\n    out.withIndent(function () {\n      for (var i in props) {\n        if (hasOwnProperty(props, i) && !/^_/.test(i)) {\n          empty = false;\n          out.indent(_(i), \" \", props[i]);\n        }\n      }\n    });\n    if (!empty) {\n      out.indent();\n    }\n    out(\">>\");\n  }\n}\n\n/// streams\n\nclass PDFStream extends PDFValue {\n  constructor(data, props, compress) {\n    super();\n    if (typeof data == \"string\") {\n      var tmp = BinaryStream();\n      tmp.write(data);\n      data = tmp;\n    }\n    this.data = data;\n    this.props = props || {};\n    this.compress = compress;\n  }\n  render(out) {\n    var data = this.data.get(),\n      props = this.props;\n    if (this.compress && supportsDeflate()) {\n      if (!props.Filter) {\n        props.Filter = [];\n      } else if (!(props.Filter instanceof Array)) {\n        props.Filter = [props.Filter];\n      }\n      props.Filter.unshift(_(\"FlateDecode\"));\n      data = deflate(data);\n    }\n    props.Length = data.length;\n    out(new PDFDictionary(props), \" stream\", NL);\n    out.writeData(data);\n    out(NL, \"endstream\");\n  }\n}\n\n/// catalog\n\nclass PDFCatalog extends PDFDictionary {\n  constructor() {\n    super({\n      Type: _(\"Catalog\")\n    });\n  }\n  setPages(pagesObj) {\n    this.props.Pages = pagesObj;\n  }\n}\n\n/// page tree\n\nclass PDFPageTree extends PDFDictionary {\n  constructor() {\n    super({\n      Type: _(\"Pages\"),\n      Kids: [],\n      Count: 0\n    });\n  }\n  addPage(pageObj) {\n    this.props.Kids.push(pageObj);\n    this.props.Count++;\n  }\n}\n\n/// images\n\n// JPEG\n\nvar SOF_CODES = [0xc0, 0xc1, 0xc2, 0xc3, 0xc5, 0xc6, 0xc7, 0xc9, 0xca, 0xcb, 0xcd, 0xce, 0xcf];\nclass PDFJpegImage {\n  constructor(data) {\n    // we must determine the correct color space.  we'll parse a bit\n    // of the JPEG stream for this, it's still better than going\n    // through the canvas.\n    // https://github.com/telerik/kendo-ui-core/issues/2845\n    data.offset(0);\n    var width, height, colorSpace, bitsPerComponent;\n    var soi = data.readShort();\n    if (soi != 0xFFD8) {\n      // XXX: do we have some better options here?\n      throw new Error(\"Invalid JPEG image\");\n    }\n    while (!data.eof()) {\n      var ff = data.readByte();\n      if (ff != 0xFF) {\n        throw new Error(\"Invalid JPEG image\");\n      }\n      var marker = data.readByte();\n      var length = data.readShort();\n      if (SOF_CODES.indexOf(marker) >= 0) {\n        // \"start of frame\" marker\n        bitsPerComponent = data.readByte();\n        height = data.readShort();\n        width = data.readShort();\n        colorSpace = data.readByte();\n        break;\n      }\n      data.skip(length - 2);\n    }\n    if (colorSpace == null) {\n      throw new Error(\"Invalid JPEG image\");\n    }\n    var props = {\n      Type: _(\"XObject\"),\n      Subtype: _(\"Image\"),\n      Width: width,\n      Height: height,\n      BitsPerComponent: bitsPerComponent,\n      Filter: _(\"DCTDecode\")\n    };\n    switch (colorSpace) {\n      case 1:\n        props.ColorSpace = _(\"DeviceGray\");\n        break;\n      case 3:\n        props.ColorSpace = _(\"DeviceRGB\");\n        break;\n      case 4:\n        props.ColorSpace = _(\"DeviceCMYK\");\n        props.Decode = [1, 0, 1, 0, 1, 0, 1, 0]; // invert colors\n        break;\n    }\n    this.asStream = function () {\n      data.offset(0);\n      var stream = new PDFStream(data, props);\n      stream._resourceName = _(\"I\" + ++RESOURCE_COUNTER);\n      return stream;\n    };\n  }\n}\n\n// PDFRawImage will be used for images with transparency (PNG)\n\nclass PDFRawImage {\n  constructor(width, height, rgb, alpha) {\n    this.asStream = function (pdf) {\n      var mask = new PDFStream(alpha, {\n        Type: _(\"XObject\"),\n        Subtype: _(\"Image\"),\n        Width: width,\n        Height: height,\n        BitsPerComponent: 8,\n        ColorSpace: _(\"DeviceGray\")\n      }, true);\n      var stream = new PDFStream(rgb, {\n        Type: _(\"XObject\"),\n        Subtype: _(\"Image\"),\n        Width: width,\n        Height: height,\n        BitsPerComponent: 8,\n        ColorSpace: _(\"DeviceRGB\"),\n        SMask: pdf.attach(mask)\n      }, true);\n      stream._resourceName = _(\"I\" + ++RESOURCE_COUNTER);\n      return stream;\n    };\n  }\n}\n\n/// standard fonts\n\nclass PDFStandardFont extends PDFDictionary {\n  constructor(name) {\n    super({\n      Type: _(\"Font\"),\n      Subtype: _(\"Type1\"),\n      BaseFont: _(name)\n    });\n    this._resourceName = _(\"F\" + ++RESOURCE_COUNTER);\n  }\n  encodeText(str) {\n    return new PDFString(String(str));\n  }\n}\n\n/// TTF fonts\n\nclass PDFFont extends PDFDictionary {\n  constructor(pdf, font, props) {\n    super({});\n    props = this.props;\n    props.Type = _(\"Font\");\n    props.Subtype = _(\"Type0\");\n    props.Encoding = _(\"Identity-H\");\n    this._pdf = pdf;\n    this._font = font;\n    this._sub = font.makeSubset();\n    this._resourceName = _(\"F\" + ++RESOURCE_COUNTER);\n    var head = font.head;\n    this.name = font.psName;\n    var scale = this.scale = font.scale;\n    this.bbox = [head.xMin * scale, head.yMin * scale, head.xMax * scale, head.yMax * scale];\n    this.italicAngle = font.post.italicAngle;\n    this.ascent = font.ascent * scale;\n    this.descent = font.descent * scale;\n    this.lineGap = font.lineGap * scale;\n    this.capHeight = font.os2.capHeight || this.ascent;\n    this.xHeight = font.os2.xHeight || 0;\n    this.stemV = 0;\n    this.familyClass = (font.os2.familyClass || 0) >> 8;\n    this.isSerif = this.familyClass >= 1 && this.familyClass <= 7;\n    this.isScript = this.familyClass == 10;\n    this.flags = (font.post.isFixedPitch ? 1 : 0) | (this.isSerif ? 1 << 1 : 0) | (this.isScript ? 1 << 3 : 0) | (this.italicAngle !== 0 ? 1 << 6 : 0) | 1 << 5;\n  }\n  encodeText(text) {\n    return new PDFHexString(this._sub.encodeText(String(text)));\n  }\n  getTextWidth(fontSize, text) {\n    var width = 0,\n      codeMap = this._font.cmap.codeMap;\n    for (var i = 0; i < text.length; ++i) {\n      var glyphId = codeMap[text.charCodeAt(i)];\n      width += this._font.widthOfGlyph(glyphId || 0);\n    }\n    return width * fontSize / 1000;\n  }\n  beforeRender() {\n    var self = this;\n    var sub = self._sub;\n\n    // write the TTF data\n    var data = sub.render();\n    var fontStream = new PDFStream(BinaryStream(data), {\n      Length1: data.length\n    }, true);\n    var descriptor = self._pdf.attach(new PDFDictionary({\n      Type: _(\"FontDescriptor\"),\n      FontName: _(self._sub.psName),\n      FontBBox: self.bbox,\n      Flags: self.flags,\n      StemV: self.stemV,\n      ItalicAngle: self.italicAngle,\n      Ascent: self.ascent,\n      Descent: self.descent,\n      CapHeight: self.capHeight,\n      XHeight: self.xHeight,\n      FontFile2: self._pdf.attach(fontStream)\n    }));\n    var cmap = sub.ncid2ogid;\n    var firstChar = sub.firstChar;\n    var lastChar = sub.lastChar;\n    var charWidths = [];\n    (function loop(i, chunk) {\n      if (i <= lastChar) {\n        var gid = cmap[i];\n        if (gid == null) {\n          loop(i + 1);\n        } else {\n          if (!chunk) {\n            charWidths.push(i, chunk = []);\n          }\n          chunk.push(self._font.widthOfGlyph(gid));\n          loop(i + 1, chunk);\n        }\n      }\n    })(firstChar);\n\n    // As if two dictionaries weren't enough, we need another\n    // one, the \"descendant font\".  Only that one can be of\n    // Subtype CIDFontType2.  PDF is the X11 of document\n    // formats: portable but full of legacy that nobody cares\n    // about anymore.\n\n    var descendant = new PDFDictionary({\n      Type: _(\"Font\"),\n      Subtype: _(\"CIDFontType2\"),\n      BaseFont: _(self._sub.psName),\n      CIDSystemInfo: new PDFDictionary({\n        Registry: new PDFString(\"Adobe\"),\n        Ordering: new PDFString(\"Identity\"),\n        Supplement: 0\n      }),\n      FontDescriptor: descriptor,\n      FirstChar: firstChar,\n      LastChar: lastChar,\n      DW: Math.round(self._font.widthOfGlyph(0)),\n      W: charWidths,\n      CIDToGIDMap: self._pdf.attach(self._makeCidToGidMap())\n    });\n    var dict = self.props;\n    dict.BaseFont = _(self._sub.psName);\n    dict.DescendantFonts = [self._pdf.attach(descendant)];\n\n    // Compute the ToUnicode map so that apps can extract\n    // meaningful text from the PDF.\n    var unimap = new PDFToUnicodeCmap(firstChar, lastChar, sub.subset);\n    var unimapStream = new PDFStream(makeOutput(), null, true);\n    unimapStream.data(unimap);\n    dict.ToUnicode = self._pdf.attach(unimapStream);\n  }\n  _makeCidToGidMap() {\n    return new PDFStream(BinaryStream(this._sub.cidToGidMap()), null, true);\n  }\n}\nclass PDFToUnicodeCmap extends PDFValue {\n  constructor(firstChar, lastChar, map) {\n    super();\n    this.firstChar = firstChar;\n    this.lastChar = lastChar;\n    this.map = map;\n  }\n  render(out) {\n    out.indent(\"/CIDInit /ProcSet findresource begin\");\n    out.indent(\"12 dict begin\");\n    out.indent(\"begincmap\");\n    out.indent(\"/CIDSystemInfo <<\");\n    out.indent(\"  /Registry (Adobe)\");\n    out.indent(\"  /Ordering (UCS)\");\n    out.indent(\"  /Supplement 0\");\n    out.indent(\">> def\");\n    out.indent(\"/CMapName /Adobe-Identity-UCS def\");\n    out.indent(\"/CMapType 2 def\");\n    out.indent(\"1 begincodespacerange\");\n    out.indent(\"  <0000><ffff>\");\n    out.indent(\"endcodespacerange\");\n    var self = this;\n    out.indent(self.lastChar - self.firstChar + 1, \" beginbfchar\");\n    out.withIndent(function () {\n      for (var code = self.firstChar; code <= self.lastChar; ++code) {\n        var unicode = self.map[code];\n        var str = ucs2encode([unicode]);\n        out.indent(\"<\", zeropad(code.toString(16), 4), \">\", \"<\");\n        for (var i = 0; i < str.length; ++i) {\n          out(zeropad(str.charCodeAt(i).toString(16), 4));\n        }\n        out(\">\");\n      }\n    });\n    out.indent(\"endbfchar\");\n    out.indent(\"endcmap\");\n    out.indent(\"CMapName currentdict /CMap defineresource pop\");\n    out.indent(\"end\");\n    out.indent(\"end\");\n  }\n}\n\n/// gradients\n\nfunction makeHash(a) {\n  return a.map(function (x) {\n    return isArray(x) ? makeHash(x) : typeof x == \"number\" ? (Math.round(x * 1000) / 1000).toFixed(3) : x;\n  }).join(\" \");\n}\nfunction cacheColorGradientFunction(pdf, r1, g1, b1, r2, g2, b2) {\n  var hash = makeHash([r1, g1, b1, r2, g2, b2]);\n  var func = pdf.GRAD_COL_FUNCTIONS[hash];\n  if (!func) {\n    func = pdf.GRAD_COL_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n      FunctionType: 2,\n      Domain: [0, 1],\n      Range: [0, 1, 0, 1, 0, 1],\n      N: 1,\n      C0: [r1, g1, b1],\n      C1: [r2, g2, b2]\n    }));\n  }\n  return func;\n}\nfunction cacheOpacityGradientFunction(pdf, a1, a2) {\n  var hash = makeHash([a1, a2]);\n  var func = pdf.GRAD_OPC_FUNCTIONS[hash];\n  if (!func) {\n    func = pdf.GRAD_OPC_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n      FunctionType: 2,\n      Domain: [0, 1],\n      Range: [0, 1],\n      N: 1,\n      C0: [a1],\n      C1: [a2]\n    }));\n  }\n  return func;\n}\nfunction makeGradientFunctions(pdf, stops) {\n  var hasAlpha = false;\n  var opacities = [];\n  var colors = [];\n  var offsets = [];\n  var encode = [];\n  var i, prev, cur, prevColor, curColor;\n  for (i = 1; i < stops.length; ++i) {\n    prev = stops[i - 1];\n    cur = stops[i];\n    prevColor = prev.color;\n    curColor = cur.color;\n    colors.push(cacheColorGradientFunction(pdf, prevColor.r, prevColor.g, prevColor.b, curColor.r, curColor.g, curColor.b));\n    if (prevColor.a < 1 || curColor.a < 1) {\n      hasAlpha = true;\n    }\n    offsets.push(cur.offset);\n    encode.push(0, 1);\n  }\n  if (hasAlpha) {\n    for (i = 1; i < stops.length; ++i) {\n      prev = stops[i - 1];\n      cur = stops[i];\n      prevColor = prev.color;\n      curColor = cur.color;\n      opacities.push(cacheOpacityGradientFunction(pdf, prevColor.a, curColor.a));\n    }\n  }\n  offsets.pop();\n  return {\n    hasAlpha: hasAlpha,\n    colors: assemble(colors),\n    opacities: hasAlpha ? assemble(opacities) : null\n  };\n  function assemble(funcs) {\n    if (funcs.length == 1) {\n      return funcs[0];\n    }\n    return {\n      FunctionType: 3,\n      Functions: funcs,\n      Domain: [0, 1],\n      Bounds: offsets,\n      Encode: encode\n    };\n  }\n}\nfunction cacheColorGradient(pdf, isRadial, stops, coords, funcs, box) {\n  var shading, hash;\n  // if box is given then we have user-space coordinates, which\n  // means the gradient is designed for a certain position/size\n  // on page.  caching won't do any good.\n  if (!box) {\n    var a = [isRadial].concat(coords);\n    stops.forEach(function (x) {\n      a.push(x.offset, x.color.r, x.color.g, x.color.b);\n    });\n    hash = makeHash(a);\n    shading = pdf.GRAD_COL[hash];\n  }\n  if (!shading) {\n    shading = new PDFDictionary({\n      Type: _(\"Shading\"),\n      ShadingType: isRadial ? 3 : 2,\n      ColorSpace: _(\"DeviceRGB\"),\n      Coords: coords,\n      Domain: [0, 1],\n      Function: funcs,\n      Extend: [true, true]\n    });\n    pdf.attach(shading);\n    shading._resourceName = \"S\" + ++RESOURCE_COUNTER;\n    if (hash) {\n      pdf.GRAD_COL[hash] = shading;\n    }\n  }\n  return shading;\n}\nfunction cacheOpacityGradient(pdf, isRadial, stops, coords, funcs, box) {\n  var opacity, hash;\n  // if box is given then we have user-space coordinates, which\n  // means the gradient is designed for a certain position/size\n  // on page.  caching won't do any good.\n  if (!box) {\n    var a = [isRadial].concat(coords);\n    stops.forEach(function (x) {\n      a.push(x.offset, x.color.a);\n    });\n    hash = makeHash(a);\n    opacity = pdf.GRAD_OPC[hash];\n  }\n  if (!opacity) {\n    opacity = new PDFDictionary({\n      Type: _(\"ExtGState\"),\n      AIS: false,\n      CA: 1,\n      ca: 1,\n      SMask: {\n        Type: _(\"Mask\"),\n        S: _(\"Luminosity\"),\n        G: pdf.attach(new PDFStream(\"/a0 gs /s0 sh\", {\n          Type: _(\"XObject\"),\n          Subtype: _(\"Form\"),\n          FormType: 1,\n          BBox: box ? [box.left, box.top + box.height, box.left + box.width, box.top] : [0, 1, 1, 0],\n          Group: {\n            Type: _(\"Group\"),\n            S: _(\"Transparency\"),\n            CS: _(\"DeviceGray\"),\n            I: true\n          },\n          Resources: {\n            ExtGState: {\n              a0: {\n                CA: 1,\n                ca: 1\n              }\n            },\n            Shading: {\n              s0: {\n                ColorSpace: _(\"DeviceGray\"),\n                Coords: coords,\n                Domain: [0, 1],\n                ShadingType: isRadial ? 3 : 2,\n                Function: funcs,\n                Extend: [true, true]\n              }\n            }\n          }\n        }))\n      }\n    });\n    pdf.attach(opacity);\n    opacity._resourceName = \"O\" + ++RESOURCE_COUNTER;\n    if (hash) {\n      pdf.GRAD_OPC[hash] = opacity;\n    }\n  }\n  return opacity;\n}\nfunction cacheGradient(pdf, gradient, box) {\n  var isRadial = gradient.type == \"radial\";\n  var funcs = makeGradientFunctions(pdf, gradient.stops);\n  var coords = isRadial ? [gradient.start.x, gradient.start.y, gradient.start.r, gradient.end.x, gradient.end.y, gradient.end.r] : [gradient.start.x, gradient.start.y, gradient.end.x, gradient.end.y];\n  var shading = cacheColorGradient(pdf, isRadial, gradient.stops, coords, funcs.colors, gradient.userSpace && box);\n  var opacity = funcs.hasAlpha ? cacheOpacityGradient(pdf, isRadial, gradient.stops, coords, funcs.opacities, gradient.userSpace && box) : null;\n  return {\n    hasAlpha: funcs.hasAlpha,\n    shading: shading,\n    opacity: opacity\n  };\n}\n\n/// page object\n\nclass PDFPage extends PDFDictionary {\n  constructor(pdf, props) {\n    super(props);\n    this._pdf = pdf;\n    this._rcount = 0;\n    this._textMode = false;\n    this._fontResources = {};\n    this._gsResources = {};\n    this._xResources = {};\n    this._patResources = {};\n    this._shResources = {};\n    this._opacity = 1;\n    this._matrix = [1, 0, 0, 1, 0, 0];\n    this._annotations = [];\n    this._font = null;\n    this._fontSize = null;\n    this._contextStack = [];\n    props = this.props;\n    props.Type = _(\"Page\");\n    props.ProcSet = [_(\"PDF\"), _(\"Text\"), _(\"ImageB\"), _(\"ImageC\"), _(\"ImageI\")];\n    props.Resources = new PDFDictionary({\n      Font: new PDFDictionary(this._fontResources),\n      ExtGState: new PDFDictionary(this._gsResources),\n      XObject: new PDFDictionary(this._xResources),\n      Pattern: new PDFDictionary(this._patResources),\n      Shading: new PDFDictionary(this._shResources)\n    });\n    props.Annots = this._annotations;\n  }\n  _out() {\n    this._content.data.apply(null, arguments);\n  }\n  transform(a, b, c, d, e, f) {\n    if (!isIdentityMatrix(arguments)) {\n      this._matrix = mmul(arguments, this._matrix);\n      this._out(a, \" \", b, \" \", c, \" \", d, \" \", e, \" \", f, \" cm\");\n      // XXX: debug\n      // this._out(\" % current matrix: \", this._matrix);\n      this._out(NL);\n    }\n  }\n  translate(dx, dy) {\n    this.transform(1, 0, 0, 1, dx, dy);\n  }\n  scale(sx, sy) {\n    this.transform(sx, 0, 0, sy, 0, 0);\n  }\n  rotate(angle) {\n    var cos = Math.cos(angle),\n      sin = Math.sin(angle);\n    this.transform(cos, sin, -sin, cos, 0, 0);\n  }\n  beginText() {\n    this._textMode = true;\n    this._out(\"BT\", NL);\n  }\n  endText() {\n    this._textMode = false;\n    this._out(\"ET\", NL);\n  }\n  _requireTextMode() {\n    if (!this._textMode) {\n      throw new Error(\"Text mode required; call page.beginText() first\");\n    }\n  }\n  _requireFont() {\n    if (!this._font) {\n      throw new Error(\"No font selected; call page.setFont() first\");\n    }\n  }\n  setFont(font, size) {\n    this._requireTextMode();\n    if (font == null) {\n      font = this._font;\n    } else if (!(font instanceof PDFFont)) {\n      font = this._pdf.getFont(font);\n    }\n    if (size == null) {\n      size = this._fontSize;\n    }\n    this._fontResources[font._resourceName] = font;\n    this._font = font;\n    this._fontSize = size;\n    this._out(font._resourceName, \" \", size, \" Tf\", NL);\n  }\n  setTextLeading(size) {\n    this._requireTextMode();\n    this._out(size, \" TL\", NL);\n  }\n  setTextRenderingMode(mode) {\n    this._requireTextMode();\n    this._out(mode, \" Tr\", NL);\n  }\n  showText(text, requestedWidth) {\n    this._requireFont();\n    if (text.length > 1 && requestedWidth && this._font instanceof PDFFont) {\n      var outputWidth = this._font.getTextWidth(this._fontSize, text);\n      var scale = requestedWidth / outputWidth * 100;\n      this._out(scale, \" Tz \");\n    }\n    this._out(this._font.encodeText(text), \" Tj\", NL);\n  }\n  showTextNL(text) {\n    this._requireFont();\n    this._out(this._font.encodeText(text), \" '\", NL);\n  }\n  addLink(uri, box) {\n    var ll = this._toPage({\n      x: box.left,\n      y: box.bottom\n    });\n    var ur = this._toPage({\n      x: box.right,\n      y: box.top\n    });\n    this._annotations.push(new PDFDictionary({\n      Type: _(\"Annot\"),\n      Subtype: _(\"Link\"),\n      Rect: [ll.x, ll.y, ur.x, ur.y],\n      Border: [0, 0, 0],\n      A: new PDFDictionary({\n        Type: _(\"Action\"),\n        S: _(\"URI\"),\n        URI: new PDFString(uri)\n      })\n    }));\n  }\n  setStrokeColor(r, g, b) {\n    this._out(r, \" \", g, \" \", b, \" RG\", NL);\n  }\n  setOpacity(opacity) {\n    this.setFillOpacity(opacity);\n    this.setStrokeOpacity(opacity);\n    this._opacity *= opacity;\n  }\n  setStrokeOpacity(opacity) {\n    if (opacity < 1) {\n      var gs = this._pdf.getOpacityGS(this._opacity * opacity, true);\n      this._gsResources[gs._resourceName] = gs;\n      this._out(gs._resourceName, \" gs\", NL);\n    }\n  }\n  setFillColor(r, g, b) {\n    this._out(r, \" \", g, \" \", b, \" rg\", NL);\n  }\n  setFillOpacity(opacity) {\n    if (opacity < 1) {\n      var gs = this._pdf.getOpacityGS(this._opacity * opacity, false);\n      this._gsResources[gs._resourceName] = gs;\n      this._out(gs._resourceName, \" gs\", NL);\n    }\n  }\n  gradient(gradient, box) {\n    this.save();\n    this.rect(box.left, box.top, box.width, box.height);\n    this.clip();\n    if (!gradient.userSpace) {\n      this.transform(box.width, 0, 0, box.height, box.left, box.top);\n    }\n    var g = cacheGradient(this._pdf, gradient, box);\n    var sname = g.shading._resourceName,\n      oname;\n    this._shResources[sname] = g.shading;\n    if (g.hasAlpha) {\n      oname = g.opacity._resourceName;\n      this._gsResources[oname] = g.opacity;\n      this._out(\"/\" + oname + \" gs \");\n    }\n    this._out(\"/\" + sname + \" sh\", NL);\n    this.restore();\n  }\n  setDashPattern(dashArray, dashPhase) {\n    this._out(dashArray, \" \", dashPhase, \" d\", NL);\n  }\n  setLineWidth(width) {\n    this._out(width, \" w\", NL);\n  }\n  setLineCap(lineCap) {\n    this._out(lineCap, \" J\", NL);\n  }\n  setLineJoin(lineJoin) {\n    this._out(lineJoin, \" j\", NL);\n  }\n  setMitterLimit(mitterLimit) {\n    this._out(mitterLimit, \" M\", NL);\n  }\n  save() {\n    this._contextStack.push(this._context());\n    this._out(\"q\", NL);\n  }\n  restore() {\n    this._out(\"Q\", NL);\n    this._context(this._contextStack.pop());\n  }\n\n  // paths\n  moveTo(x, y) {\n    this._out(x, \" \", y, \" m\", NL);\n  }\n  lineTo(x, y) {\n    this._out(x, \" \", y, \" l\", NL);\n  }\n  bezier(x1, y1, x2, y2, x3, y3) {\n    this._out(x1, \" \", y1, \" \", x2, \" \", y2, \" \", x3, \" \", y3, \" c\", NL);\n  }\n  bezier1(x1, y1, x3, y3) {\n    this._out(x1, \" \", y1, \" \", x3, \" \", y3, \" y\", NL);\n  }\n  bezier2(x2, y2, x3, y3) {\n    this._out(x2, \" \", y2, \" \", x3, \" \", y3, \" v\", NL);\n  }\n  close() {\n    this._out(\"h\", NL);\n  }\n  rect(x, y, w, h) {\n    this._out(x, \" \", y, \" \", w, \" \", h, \" re\", NL);\n  }\n  ellipse(x, y, rx, ry) {\n    function _X(v) {\n      return x + v;\n    }\n    function _Y(v) {\n      return y + v;\n    }\n\n    // how to get to the \"magic number\" is explained here:\n    // http://www.whizkidtech.redprince.net/bezier/circle/kappa/\n    var k = 0.5522847498307936;\n    this.moveTo(_X(0), _Y(ry));\n    this.bezier(_X(rx * k), _Y(ry), _X(rx), _Y(ry * k), _X(rx), _Y(0));\n    this.bezier(_X(rx), _Y(-ry * k), _X(rx * k), _Y(-ry), _X(0), _Y(-ry));\n    this.bezier(_X(-rx * k), _Y(-ry), _X(-rx), _Y(-ry * k), _X(-rx), _Y(0));\n    this.bezier(_X(-rx), _Y(ry * k), _X(-rx * k), _Y(ry), _X(0), _Y(ry));\n  }\n  circle(x, y, r) {\n    this.ellipse(x, y, r, r);\n  }\n  stroke() {\n    this._out(\"S\", NL);\n  }\n  nop() {\n    this._out(\"n\", NL);\n  }\n  clip() {\n    this._out(\"W n\", NL);\n  }\n  clipStroke() {\n    this._out(\"W S\", NL);\n  }\n  closeStroke() {\n    this._out(\"s\", NL);\n  }\n  fill() {\n    this._out(\"f\", NL);\n  }\n  fillStroke() {\n    this._out(\"B\", NL);\n  }\n  drawImage(url) {\n    var img = this._pdf.getImage(url);\n    if (img) {\n      // the result can be null for a cross-domain image\n      this._xResources[img._resourceName] = img;\n      this._out(img._resourceName, \" Do\", NL);\n    }\n  }\n  comment(txt) {\n    var self = this;\n    txt.split(/\\r?\\n/g).forEach(function (line) {\n      self._out(\"% \", line, NL);\n    });\n  }\n\n  // internal\n  _context(val) {\n    if (val != null) {\n      this._opacity = val.opacity;\n      this._matrix = val.matrix;\n    } else {\n      return {\n        opacity: this._opacity,\n        matrix: this._matrix\n      };\n    }\n  }\n  _toPage(p) {\n    var m = this._matrix;\n    var a = m[0],\n      b = m[1],\n      c = m[2],\n      d = m[3],\n      e = m[4],\n      f = m[5];\n    return {\n      x: a * p.x + c * p.y + e,\n      y: b * p.x + d * p.y + f\n    };\n  }\n}\nfunction unquote(str) {\n  return str.replace(/^\\s*(['\"])(.*)\\1\\s*$/, \"$2\");\n}\nfunction parseFontDef(fontdef) {\n  // XXX: this is very crude for now and buggy.  Proper parsing is quite involved.\n  var rx = /^\\s*((normal|italic)\\s+)?((normal|small-caps)\\s+)?((normal|bold|\\d+)\\s+)?(([0-9.]+)(px|pt))(\\/(([0-9.]+)(px|pt)|normal))?\\s+(.*?)\\s*$/i;\n  var m = rx.exec(fontdef);\n  if (!m) {\n    return {\n      fontSize: 12,\n      fontFamily: \"sans-serif\"\n    };\n  }\n  var fontSize = m[8] ? parseInt(m[8], 10) : 12;\n  return {\n    italic: m[2] && m[2].toLowerCase() == \"italic\",\n    variant: m[4],\n    bold: m[6] && /bold|700/i.test(m[6]),\n    fontSize: fontSize,\n    lineHeight: m[12] ? m[12] == \"normal\" ? fontSize : parseInt(m[12], 10) : null,\n    fontFamily: m[14].split(/\\s*,\\s*/g).map(unquote)\n  };\n}\nfunction getFontURL(style) {\n  function mkFamily(name) {\n    if (style.bold) {\n      name += \"|bold\";\n    }\n    if (style.italic) {\n      name += \"|italic\";\n    }\n    return name.toLowerCase();\n  }\n  var fontFamily = style.fontFamily;\n  var name, url;\n  if (fontFamily instanceof Array) {\n    for (var i = 0; i < fontFamily.length; ++i) {\n      name = mkFamily(fontFamily[i]);\n      url = FONT_MAPPINGS[name];\n      if (url) {\n        break;\n      }\n    }\n  } else {\n    url = FONT_MAPPINGS[fontFamily.toLowerCase()];\n  }\n  while (typeof url == \"function\") {\n    url = url();\n  }\n  if (!url) {\n    url = \"Times-Roman\";\n  }\n  return url;\n}\nvar FONT_MAPPINGS = {\n  \"serif\": \"Times-Roman\",\n  \"serif|bold\": \"Times-Bold\",\n  \"serif|italic\": \"Times-Italic\",\n  \"serif|bold|italic\": \"Times-BoldItalic\",\n  \"sans-serif\": \"Helvetica\",\n  \"sans-serif|bold\": \"Helvetica-Bold\",\n  \"sans-serif|italic\": \"Helvetica-Oblique\",\n  \"sans-serif|bold|italic\": \"Helvetica-BoldOblique\",\n  \"monospace\": \"Courier\",\n  \"monospace|bold\": \"Courier-Bold\",\n  \"monospace|italic\": \"Courier-Oblique\",\n  \"monospace|bold|italic\": \"Courier-BoldOblique\",\n  \"zapfdingbats\": \"ZapfDingbats\",\n  \"zapfdingbats|bold\": \"ZapfDingbats\",\n  \"zapfdingbats|italic\": \"ZapfDingbats\",\n  \"zapfdingbats|bold|italic\": \"ZapfDingbats\"\n};\nfunction fontAlias(alias, name) {\n  alias = alias.toLowerCase();\n  FONT_MAPPINGS[alias] = function () {\n    return FONT_MAPPINGS[name];\n  };\n  FONT_MAPPINGS[alias + \"|bold\"] = function () {\n    return FONT_MAPPINGS[name + \"|bold\"];\n  };\n  FONT_MAPPINGS[alias + \"|italic\"] = function () {\n    return FONT_MAPPINGS[name + \"|italic\"];\n  };\n  FONT_MAPPINGS[alias + \"|bold|italic\"] = function () {\n    return FONT_MAPPINGS[name + \"|bold|italic\"];\n  };\n}\n\n// Let's define some common names to an appropriate replacement.\n// These are overridable via pdf.defineFont, should the user want to\n// include the proper versions.\n\nfontAlias(\"Times New Roman\", \"serif\");\nfontAlias(\"Courier New\", \"monospace\");\nfontAlias(\"Arial\", \"sans-serif\");\nfontAlias(\"Helvetica\", \"sans-serif\");\nfontAlias(\"Verdana\", \"sans-serif\");\nfontAlias(\"Tahoma\", \"sans-serif\");\nfontAlias(\"Georgia\", \"sans-serif\");\nfontAlias(\"Monaco\", \"monospace\");\nfontAlias(\"Andale Mono\", \"monospace\");\nfunction defineFont(name, url) {\n  if (arguments.length == 1) {\n    for (var i in name) {\n      if (hasOwnProperty(name, i)) {\n        defineFont(i, name[i]);\n      }\n    }\n  } else {\n    name = name.toLowerCase();\n    FONT_MAPPINGS[name] = url;\n\n    // special handling for DejaVu fonts: if they get defined,\n    // let them also replace the default families, for good\n    // Unicode support out of the box.\n    switch (name) {\n      case \"dejavu sans\":\n        FONT_MAPPINGS[\"sans-serif\"] = url;\n        break;\n      case \"dejavu sans|bold\":\n        FONT_MAPPINGS[\"sans-serif|bold\"] = url;\n        break;\n      case \"dejavu sans|italic\":\n        FONT_MAPPINGS[\"sans-serif|italic\"] = url;\n        break;\n      case \"dejavu sans|bold|italic\":\n        FONT_MAPPINGS[\"sans-serif|bold|italic\"] = url;\n        break;\n      case \"dejavu serif\":\n        FONT_MAPPINGS[\"serif\"] = url;\n        break;\n      case \"dejavu serif|bold\":\n        FONT_MAPPINGS[\"serif|bold\"] = url;\n        break;\n      case \"dejavu serif|italic\":\n        FONT_MAPPINGS[\"serif|italic\"] = url;\n        break;\n      case \"dejavu serif|bold|italic\":\n        FONT_MAPPINGS[\"serif|bold|italic\"] = url;\n        break;\n      case \"dejavu mono\":\n        FONT_MAPPINGS[\"monospace\"] = url;\n        break;\n      case \"dejavu mono|bold\":\n        FONT_MAPPINGS[\"monospace|bold\"] = url;\n        break;\n      case \"dejavu mono|italic\":\n        FONT_MAPPINGS[\"monospace|italic\"] = url;\n        break;\n      case \"dejavu mono|bold|italic\":\n        FONT_MAPPINGS[\"monospace|bold|italic\"] = url;\n        break;\n    }\n  }\n}\nfunction mmul(a, b) {\n  var a1 = a[0],\n    b1 = a[1],\n    c1 = a[2],\n    d1 = a[3],\n    e1 = a[4],\n    f1 = a[5];\n  var a2 = b[0],\n    b2 = b[1],\n    c2 = b[2],\n    d2 = b[3],\n    e2 = b[4],\n    f2 = b[5];\n  return [a1 * a2 + b1 * c2, a1 * b2 + b1 * d2, c1 * a2 + d1 * c2, c1 * b2 + d1 * d2, e1 * a2 + f1 * c2 + e2, e1 * b2 + f1 * d2 + f2];\n}\nfunction isIdentityMatrix(m) {\n  return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\nconst TEXT_RENDERING_MODE = {\n  fill: 0,\n  stroke: 1,\n  fillAndStroke: 2,\n  invisible: 3,\n  fillAndClip: 4,\n  strokeAndClip: 5,\n  fillStrokeClip: 6,\n  clip: 7\n};\nexport { PDFDocument as Document, BinaryStream, defineFont, parseFontDef, getFontURL, loadFonts, loadImages, getPaperOptions, clearImageCache, TEXT_RENDERING_MODE };","map":{"version":3,"names":["BinaryStream","ucs2encode","base64ToUint8Array","HAS_TYPED_ARRAYS","support","TTFFont","deflate","supportsDeflate","encodeUTF16BE","BOM","encodeBase64","browser","NL","RESOURCE_COUNTER","PAPER_SIZE","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","executive","folio","legal","letter","tabloid","makeOutput","indentLevel","output","out","i","arguments","length","x","undefined","Error","PDFValue","beforeRender","render","isArray","renderArray","isDate","renderDate","isNaN","num","toFixed","indexOf","replace","writeString","test","String","get","write","PDFDictionary","writeData","data","withIndent","f","indent","pad","apply","offset","toString","stream","wrapObject","value","id","renderValue","renderFull","_offset","call","getPaperOptions","getOption","options","key","def","paperSize","toLowerCase","unitsToPoints","Math","max","min","margin","left","top","right","bottom","FONT_CACHE","loadBinary","url","cont","m","msie","exec","substr","error","window","console","log","req","XMLHttpRequest","open","responseType","onload","status","Uint8Array","response","VBArray","responseBody","toArray","onerror","send","loadFont","font","IMAGE_CACHE","clearImageCache","loadImage","size","img","bloburl","blob","Image","crossOrigin","xhr","mozilla","type","reader","FileReader","doc","DOMParser","parseFromString","result","svg","documentElement","getAttribute","URL","createObjectURL","_load","setAttribute","width","height","xml","XMLSerializer","serializeToString","dataURL","readAsText","_onerror","src","complete","_onload","_trycanvas","canvas","document","createElement","ctx","getContext","drawImage","imgdata","getImageData","ex","revokeObjectURL","hasAlpha","rgb","alpha","rawbytes","writeByte","a","keepPNG","PDFRawImage","toDataURL","jpegQuality","writeBase64","PDFJpegImage","substring","upscale","readAsArrayBuffer","manyLoader","loadOne","urls","callback","n","next","loadFonts","loadImages","images","Object","assign","keys","forEach","PDFDocument","constructor","self","objcount","objects","name","defval","attach","push","pages","FONTS","IMAGES","GRAD_COL_FUNCTIONS","GRAD_OPC_FUNCTIONS","GRAD_COL","GRAD_OPC","catalog","PDFCatalog","pageTree","PDFPageTree","nameTree","JavaScript","Names","PDFString","S","_","JS","props","setPages","info","Producer","Title","Author","Subject","Keywords","Creator","CreationDate","Date","addPage","paperOptions","contentWidth","contentHeight","content","PDFStream","Contents","Parent","MediaBox","page","PDFPage","_content","transform","translate","rect","clip","xrefOffset","zeropad","Size","Root","Info","getFont","PDFStandardFont","PDFFont","getImage","asStream","getOpacityGS","opacity","forStroke","parseFloat","cache","_opacityGSCache","gs","Type","CA","ca","_resourceName","dict","str","len","ch","hasOwnProperty","obj","prototype","Array","date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","mm2pt","mm","cm2pt","cm","in2pt","inch","utf16be","Boolean","txt","code","charCodeAt","PDFHexString","PDFName","escape","c","PDFName_cache","empty","compress","tmp","Filter","unshift","Length","pagesObj","Pages","Kids","Count","pageObj","SOF_CODES","colorSpace","bitsPerComponent","soi","readShort","eof","ff","readByte","marker","skip","Subtype","Width","Height","BitsPerComponent","ColorSpace","Decode","pdf","mask","SMask","BaseFont","encodeText","Encoding","_pdf","_font","_sub","makeSubset","head","psName","scale","bbox","xMin","yMin","xMax","yMax","italicAngle","post","ascent","descent","lineGap","capHeight","os2","xHeight","stemV","familyClass","isSerif","isScript","flags","isFixedPitch","text","getTextWidth","fontSize","codeMap","cmap","glyphId","widthOfGlyph","sub","fontStream","Length1","descriptor","FontName","FontBBox","Flags","StemV","ItalicAngle","Ascent","Descent","CapHeight","XHeight","FontFile2","ncid2ogid","firstChar","lastChar","charWidths","loop","chunk","gid","descendant","CIDSystemInfo","Registry","Ordering","Supplement","FontDescriptor","FirstChar","LastChar","DW","round","W","CIDToGIDMap","_makeCidToGidMap","DescendantFonts","unimap","PDFToUnicodeCmap","subset","unimapStream","ToUnicode","cidToGidMap","map","unicode","makeHash","join","cacheColorGradientFunction","r1","g1","r2","g2","hash","func","FunctionType","Domain","Range","N","C0","C1","cacheOpacityGradientFunction","makeGradientFunctions","stops","opacities","colors","offsets","encode","prev","cur","prevColor","curColor","color","r","g","b","pop","assemble","funcs","Functions","Bounds","Encode","cacheColorGradient","isRadial","coords","box","shading","concat","ShadingType","Coords","Function","Extend","cacheOpacityGradient","AIS","G","FormType","BBox","Group","CS","I","Resources","ExtGState","Shading","s0","cacheGradient","gradient","start","y","end","userSpace","_rcount","_textMode","_fontResources","_gsResources","_xResources","_patResources","_shResources","_opacity","_matrix","_annotations","_fontSize","_contextStack","ProcSet","Font","XObject","Pattern","Annots","_out","d","e","isIdentityMatrix","mmul","dx","dy","sx","sy","rotate","angle","cos","sin","beginText","endText","_requireTextMode","_requireFont","setFont","setTextLeading","setTextRenderingMode","mode","showText","requestedWidth","outputWidth","showTextNL","addLink","uri","ll","_toPage","ur","Rect","Border","A","URI","setStrokeColor","setOpacity","setFillOpacity","setStrokeOpacity","setFillColor","save","sname","oname","restore","setDashPattern","dashArray","dashPhase","setLineWidth","setLineCap","lineCap","setLineJoin","lineJoin","setMitterLimit","mitterLimit","_context","moveTo","lineTo","bezier","x1","y1","x2","y2","x3","y3","bezier1","bezier2","close","w","h","ellipse","rx","ry","_X","v","_Y","k","circle","stroke","nop","clipStroke","closeStroke","fill","fillStroke","comment","split","line","val","matrix","p","unquote","parseFontDef","fontdef","fontFamily","parseInt","italic","variant","bold","lineHeight","getFontURL","style","mkFamily","FONT_MAPPINGS","fontAlias","alias","defineFont","d1","e1","f1","d2","e2","f2","TEXT_RENDERING_MODE","fillAndStroke","invisible","fillAndClip","strokeAndClip","fillStrokeClip","Document"],"sources":["C:/Internship/FoodShopUI/node_modules/@progress/kendo-drawing/dist/es2015/pdf/core.js"],"sourcesContent":["/* eslint-disable no-multi-spaces, key-spacing, indent, camelcase, space-before-blocks, eqeqeq, brace-style */\n/* eslint-disable space-infix-ops, space-before-function-paren, array-bracket-spacing, object-curly-spacing */\n/* eslint-disable no-nested-ternary, max-params, default-case, no-else-return, no-empty */\n/* eslint-disable no-param-reassign, no-var, block-scoped-var */\n\nimport { BinaryStream, ucs2encode, base64ToUint8Array, HAS_TYPED_ARRAYS } from \"./utils\";\nimport { support } from '../common';\nimport { TTFFont } from \"./ttf\";\nimport { deflate, supportsDeflate } from './deflate';\nimport { encodeUTF16BE, BOM } from \"../util/encode-utf\";\nimport { encodeBase64 } from \"../util\";\n\nconst browser = support.browser;\nconst NL = \"\\n\";\n\nvar RESOURCE_COUNTER = 0;\n\nconst PAPER_SIZE = {\n    a0        : [ 2383.94 , 3370.39 ],\n    a1        : [ 1683.78 , 2383.94 ],\n    a2        : [ 1190.55 , 1683.78 ],\n    a3        : [ 841.89  , 1190.55 ],\n    a4        : [ 595.28  , 841.89  ],\n    a5        : [ 419.53  , 595.28  ],\n    a6        : [ 297.64  , 419.53  ],\n    a7        : [ 209.76  , 297.64  ],\n    a8        : [ 147.40  , 209.76  ],\n    a9        : [ 104.88  , 147.40  ],\n    a10       : [ 73.70   , 104.88  ],\n    b0        : [ 2834.65 , 4008.19 ],\n    b1        : [ 2004.09 , 2834.65 ],\n    b2        : [ 1417.32 , 2004.09 ],\n    b3        : [ 1000.63 , 1417.32 ],\n    b4        : [ 708.66  , 1000.63 ],\n    b5        : [ 498.90  , 708.66  ],\n    b6        : [ 354.33  , 498.90  ],\n    b7        : [ 249.45  , 354.33  ],\n    b8        : [ 175.75  , 249.45  ],\n    b9        : [ 124.72  , 175.75  ],\n    b10       : [ 87.87   , 124.72  ],\n    c0        : [ 2599.37 , 3676.54 ],\n    c1        : [ 1836.85 , 2599.37 ],\n    c2        : [ 1298.27 , 1836.85 ],\n    c3        : [ 918.43  , 1298.27 ],\n    c4        : [ 649.13  , 918.43  ],\n    c5        : [ 459.21  , 649.13  ],\n    c6        : [ 323.15  , 459.21  ],\n    c7        : [ 229.61  , 323.15  ],\n    c8        : [ 161.57  , 229.61  ],\n    c9        : [ 113.39  , 161.57  ],\n    c10       : [ 79.37   , 113.39  ],\n    executive : [ 521.86  , 756.00  ],\n    folio     : [ 612.00  , 936.00  ],\n    legal     : [ 612.00  , 1008.00 ],\n    letter    : [ 612.00  , 792.00  ],\n    tabloid   : [ 792.00  , 1224.00 ]\n};\n\nfunction makeOutput() {\n    var indentLevel = 0, output = BinaryStream();\n    function out() {\n        for (var i = 0; i < arguments.length; ++i) {\n            var x = arguments[i];\n            if (x === undefined) {\n                throw new Error(\"Cannot output undefined to PDF\");\n            }\n            else if (x instanceof PDFValue) {\n                x.beforeRender(out);\n                x.render(out);\n            }\n            else if (isArray(x)) {\n                renderArray(x, out);\n            }\n            else if (isDate(x)) {\n                renderDate(x, out);\n            }\n            else if (typeof x == \"number\") {\n                if (isNaN(x)) {\n                    throw new Error(\"Cannot output NaN to PDF\");\n                }\n                // make sure it doesn't end up in exponent notation\n                var num = x.toFixed(7);\n                if (num.indexOf(\".\") >= 0) {\n                    num = num.replace(/\\.?0+$/, \"\");\n                }\n                if (num == \"-0\") {\n                    num = \"0\";\n                }\n                output.writeString(num);\n            }\n            else if (/string|boolean/.test(typeof x)) {\n                output.writeString(String(x));\n            }\n            else if (typeof x.get == \"function\") {\n                output.write(x.get());\n            }\n            else if (typeof x == \"object\") {\n                if (!x) {\n                    output.writeString(\"null\");\n                } else {\n                    out(new PDFDictionary(x));\n                }\n            }\n        }\n    }\n    out.writeData = function(data) {\n        output.write(data);\n    };\n    out.withIndent = function(f) {\n        ++indentLevel;\n        f(out);\n        --indentLevel;\n    };\n    out.indent = function() {\n        out(NL, pad(\"\", indentLevel * 2, \"  \"));\n        out.apply(null, arguments);\n    };\n    out.offset = function() {\n        return output.offset();\n    };\n    out.toString = function() {\n        throw new Error(\"FIX CALLER\");\n    };\n    out.get = function() {\n        return output.get();\n    };\n    out.stream = function() {\n        return output;\n    };\n    return out;\n}\n\nfunction wrapObject(value, id) {\n    var beforeRender = value.beforeRender;\n    var renderValue = value.render;\n\n    value.beforeRender = function(){};\n\n    value.render = function(out) {\n        out(id, \" 0 R\");\n    };\n\n    value.renderFull = function(out) {\n        value._offset = out.offset();\n        out(id, \" 0 obj \");\n        beforeRender.call(value, out);\n        renderValue.call(value, out);\n        out(\" endobj\");\n    };\n}\n\nfunction getPaperOptions(getOption) {\n    if (typeof getOption != \"function\") {\n        var options = getOption;\n        getOption = function(key, def) {\n            return key in options ? options[key] : def;\n        };\n    }\n    var paperSize = getOption(\"paperSize\", PAPER_SIZE.a4);\n    if (!paperSize) {\n        return {};\n    }\n    if (typeof paperSize == \"string\") {\n        paperSize = PAPER_SIZE[paperSize.toLowerCase()];\n        if (paperSize == null) {\n            throw new Error(\"Unknown paper size\");\n        }\n    }\n\n    paperSize[0] = unitsToPoints(paperSize[0]);\n    paperSize[1] = unitsToPoints(paperSize[1]);\n\n    if (getOption(\"landscape\", false)) {\n        paperSize = [\n            Math.max(paperSize[0], paperSize[1]),\n            Math.min(paperSize[0], paperSize[1])\n        ];\n    }\n\n    var margin = getOption(\"margin\");\n    if (margin) {\n        if (typeof margin == \"string\" || typeof margin == \"number\") {\n            margin = unitsToPoints(margin, 0);\n            margin = { left: margin, top: margin, right: margin, bottom: margin };\n        } else {\n            margin = {\n                left   : unitsToPoints(margin.left, 0),\n                top    : unitsToPoints(margin.top, 0),\n                right  : unitsToPoints(margin.right, 0),\n                bottom : unitsToPoints(margin.bottom, 0)\n            };\n        }\n        if (getOption(\"addMargin\")) {\n            paperSize[0] += margin.left + margin.right;\n            paperSize[1] += margin.top + margin.bottom;\n        }\n    }\n    return { paperSize: paperSize, margin: margin };\n}\n\nvar FONT_CACHE = {\n    \"Times-Roman\"           : true,\n    \"Times-Bold\"            : true,\n    \"Times-Italic\"          : true,\n    \"Times-BoldItalic\"      : true,\n    \"Helvetica\"             : true,\n    \"Helvetica-Bold\"        : true,\n    \"Helvetica-Oblique\"     : true,\n    \"Helvetica-BoldOblique\" : true,\n    \"Courier\"               : true,\n    \"Courier-Bold\"          : true,\n    \"Courier-Oblique\"       : true,\n    \"Courier-BoldOblique\"   : true,\n    \"Symbol\"                : true,\n    \"ZapfDingbats\"          : true\n};\n\nfunction loadBinary(url, cont) {\n    // IE throws Accesss denied error for Data URIs\n    let m;\n    if (browser.msie && (m = /^data:.*?;base64,/i.exec(url))) {\n        cont(base64ToUint8Array(url.substr(m[0].length)));\n        return;\n    }\n\n    function error() {\n        if (window.console) {\n            if (window.console.error) {\n                window.console.error(\"Cannot load URL: %s\", url);\n            } else {\n                window.console.log(\"Cannot load URL: %s\", url);\n            }\n        }\n        cont(null);\n    }\n    var req = new XMLHttpRequest();\n    req.open('GET', url, true);\n    if (HAS_TYPED_ARRAYS) {\n        req.responseType = \"arraybuffer\";\n    }\n    req.onload = function() {\n        if (req.status == 200 || req.status == 304) {\n            if (HAS_TYPED_ARRAYS) {\n                cont(new Uint8Array(req.response));\n            } else {\n                cont(new window.VBArray(req.responseBody).toArray()); // IE9 only\n            }\n        } else {\n            error();\n        }\n    };\n    req.onerror = error;\n    req.send(null);\n}\n\nfunction loadFont(url, cont) {\n    var font = FONT_CACHE[url];\n    if (font) {\n        cont(font);\n    } else {\n        loadBinary(url, function(data){\n            if (data == null) {\n                throw new Error(\"Cannot load font from \" + url);\n            } else {\n                var font = new TTFFont(data);\n                FONT_CACHE[url] = font;\n                cont(font);\n            }\n        });\n    }\n}\n\nvar IMAGE_CACHE = {};\n\nfunction clearImageCache() {\n    IMAGE_CACHE = {};\n}\n\nfunction loadImage(url, size, cont, options) {\n    var img = IMAGE_CACHE[url], bloburl, blob;\n    if (img) {\n        cont(img);\n    } else {\n        img = new Image();\n        if (!(/^data:/i.test(url))) {\n            img.crossOrigin = \"Anonymous\";\n        }\n        if (HAS_TYPED_ARRAYS && !(/^data:/i.test(url))) {\n            // IE10 fails to load images from another domain even when the server sends the\n            // proper CORS headers.  a XHR, however, will be able to load the data.\n            // http://stackoverflow.com/a/19734516/154985\n            //\n            // On the other hand, it's worth doing it this way for all browsers which support\n            // responseType = \"blob\" (HAS_TYPED_ARRAYS will be true), because we can inspect the\n            // mime type and if it's a JPEG (very common case) we can save a lot of time in\n            // _load below.\n            var xhr = new XMLHttpRequest();\n            xhr.onload = function() {\n                blob = xhr.response;\n                if (browser.mozilla && blob.type == \"image/svg+xml\") {\n                    // Firefox won't render SVGs that don't contain width and height attributes.\n                    let reader = new FileReader();\n                    reader.onload = function() {\n                        let doc = new window.DOMParser().parseFromString(this.result, \"image/svg+xml\");\n                        let svg = doc.documentElement;\n                        if (svg.getAttribute(\"width\") && svg.getAttribute(\"height\")) {\n                            // we're good, continue with the existing blob.\n                            bloburl = URL.createObjectURL(blob);\n                            _load(bloburl);\n                        } else {\n                            svg.setAttribute(\"width\", size.width);\n                            svg.setAttribute(\"height\", size.height);\n                            let xml = new window.XMLSerializer().serializeToString(svg);\n                            let dataURL = `data:image/svg+xml;base64,${encodeBase64(xml)}`;\n                            _load(dataURL);\n                        }\n                    };\n                    reader.readAsText(blob);\n                } else {\n                    bloburl = URL.createObjectURL(blob);\n                    _load(bloburl);\n                }\n            };\n            xhr.onerror = _onerror;\n            xhr.open(\"GET\", url, true);\n            xhr.responseType = \"blob\";\n            xhr.send();\n        } else {\n            _load(url);\n        }\n    }\n\n    function _load(url) {\n        img.src = url;\n        if (img.complete && !browser.msie) {\n            // IE, bless its little heart, says img.complete == true even though the image is\n            // not loaded (width=0), therefore we must go the onload route (ticket 929635).\n            _onload.call(img);\n        } else {\n            img.onload = _onload;\n            img.onerror = _onerror;\n        }\n    }\n\n    function _trycanvas() {\n        if (!size) {\n            size = { width: img.width, height: img.height };\n        }\n\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = size.width;\n        canvas.height = size.height;\n\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, 0, 0, size.width, size.height);\n\n        var imgdata;\n        try {\n            imgdata = ctx.getImageData(0, 0, size.width, size.height);\n        } catch (ex) {\n            // it tainted the canvas -- can't draw it.\n            _onerror();\n            return;\n        } finally {\n            if (bloburl) {\n                URL.revokeObjectURL(bloburl);\n            }\n        }\n\n        // in case it contains transparency, we must separate rgb data from the alpha\n        // channel and create a PDFRawImage image with opacity.  otherwise we can use a\n        // PDFJpegImage.\n        //\n        // to do this in one step, we create the rgb and alpha streams anyway, even if\n        // we might end up not using them if hasAlpha remains false.\n\n        var hasAlpha = false, rgb = BinaryStream(), alpha = BinaryStream();\n        var rawbytes = imgdata.data;\n        var i = 0;\n        while (i < rawbytes.length) {\n            rgb.writeByte(rawbytes[i++]);\n            rgb.writeByte(rawbytes[i++]);\n            rgb.writeByte(rawbytes[i++]);\n            var a = rawbytes[i++];\n            if (a < 255) {\n                hasAlpha = true;\n            }\n            alpha.writeByte(a);\n        }\n\n        if (hasAlpha || options.keepPNG) {\n            img = new PDFRawImage(size.width, size.height, rgb, alpha);\n        } else {\n            // no transparency, encode as JPEG.\n            var data = canvas.toDataURL(\"image/jpeg\", options.jpegQuality);\n            data = data.substr(data.indexOf(\";base64,\") + 8);\n\n            var stream = BinaryStream();\n            stream.writeBase64(data);\n            img = new PDFJpegImage(stream);\n        }\n\n        cont(IMAGE_CACHE[url] = img);\n    }\n\n    function _onerror() {\n        cont(IMAGE_CACHE[url] = \"ERROR\");\n    }\n\n    function _onload() {\n        if (size) {\n            const svg = (blob && blob.type === 'image/svg+xml') || (\n              /^data:image\\/svg\\+xml;/i.test(this.src.substring(0, 19))\n            );\n\n            const upscale = size.width >= img.width || size.height >= img.height;\n\n            // Use the original image if requested size is bigger than the source,\n            // unless it's an SVG that can be upscaled.\n            if (!svg && upscale) {\n                size = null;\n            }\n        }\n        if (!size && blob && /^image\\/jpe?g$/i.test(blob.type)) {\n            // If we know we got a JPEG, we can skip the process of rendering it to a\n            // canvas, getting the pixel data, searching for transparency we know we won't\n            // find, getting back a data URI and then decoding the BASE64 to finally get the\n            // binary we already have.  Also, we avoid downgrading the image quality, with\n            // the possible drawback of making a bigger PDF; still, seems legit.\n            //\n            // Besides saving a lot of work, this also reuses the buffer memory\n            // (BinaryStream does not create a copy), potentially saving some GC cycles.\n            let reader = new FileReader();\n            reader.onload = function() {\n                try {\n                    let img = new PDFJpegImage(BinaryStream(new Uint8Array(this.result)));\n                    URL.revokeObjectURL(bloburl);\n                    cont(IMAGE_CACHE[url] = img);\n                } catch (ex) {\n                    // if there's an error parsing the JPEG stream, it could be due to a\n                    // misconfigured server (improper content-type:\n                    // https://github.com/telerik/kendo-ui-core/issues/4184).  If that's the case,\n                    // the canvas will still be able to draw it.\n                    _trycanvas();\n                }\n            };\n            reader.readAsArrayBuffer(blob);\n        } else {\n            _trycanvas();\n        }\n    }\n}\n\nfunction manyLoader(loadOne) {\n    return function(urls, callback) {\n        var n = urls.length, i = n;\n        if (n === 0) {\n            return callback();\n        }\n        function next() {\n            if (--n === 0) {\n                callback();\n            }\n        }\n        while (i-- > 0) {\n            loadOne(urls[i], next);\n        }\n    };\n}\n\nvar loadFonts = manyLoader(loadFont);\nvar loadImages = function(images, callback, options) {\n    options = Object.assign({\n        jpegQuality : 0.92,\n        keepPNG     : false\n    }, options);\n    var urls = Object.keys(images), n = urls.length;\n    if (n === 0) {\n        return callback();\n    }\n    function next() {\n        if (--n === 0) {\n            callback();\n        }\n    }\n    urls.forEach(function(url){\n        loadImage(url, images[url], next, options);\n    });\n};\n\nclass PDFDocument {\n    constructor (options) {\n        var self = this;\n        var out = makeOutput();\n        var objcount = 0;\n        var objects = [];\n\n        function getOption(name, defval) {\n            return (options && options[name] != null) ? options[name] : defval;\n        }\n\n        self.getOption = getOption;\n\n        self.attach = function(value) {\n            if (objects.indexOf(value) < 0) {\n                wrapObject(value, ++objcount);\n                objects.push(value);\n            }\n            return value;\n        };\n\n        self.pages = [];\n\n        self.FONTS = {};\n        self.IMAGES = {};\n        self.GRAD_COL_FUNCTIONS = {}; // cache for color gradient functions\n        self.GRAD_OPC_FUNCTIONS = {}; // cache for opacity gradient functions\n        self.GRAD_COL = {};     // cache for whole color gradient objects\n        self.GRAD_OPC = {};     // cache for whole opacity gradient objects\n\n        var catalog = self.attach(new PDFCatalog());\n        var pageTree = self.attach(new PDFPageTree());\n\n        if (getOption(\"autoPrint\")) {\n            let nameTree = {};\n            nameTree.JavaScript = new PDFDictionary({ Names: [\n                new PDFString(\"JS\"), self.attach(new PDFDictionary({\n                    S: _(\"JavaScript\"),\n                    JS: new PDFString(\"print(true);\")\n                }))\n            ] });\n            catalog.props.Names = new PDFDictionary(nameTree);\n        }\n\n        catalog.setPages(pageTree);\n\n        var info = self.attach(new PDFDictionary({\n            Producer     : new PDFString(getOption(\"producer\", \"Kendo UI PDF Generator\"), true), // XXX: kendo.version?\n            Title        : new PDFString(getOption(\"title\", \"\"), true),\n            Author       : new PDFString(getOption(\"author\", \"\"), true),\n            Subject      : new PDFString(getOption(\"subject\", \"\"), true),\n            Keywords     : new PDFString(getOption(\"keywords\", \"\"), true),\n            Creator      : new PDFString(getOption(\"creator\", \"Kendo UI PDF Generator\"), true),\n            CreationDate : getOption(\"date\", new Date())\n        }));\n\n        self.addPage = function(options) {\n            var paperOptions  = getPaperOptions(function(name, defval){\n                return (options && options[name] != null) ? options[name] : defval;\n            });\n            var paperSize     = paperOptions.paperSize;\n            var margin        = paperOptions.margin;\n            var contentWidth  = paperSize[0];\n            var contentHeight = paperSize[1];\n            if (margin) {\n                contentWidth -= margin.left + margin.right;\n                contentHeight -= margin.top + margin.bottom;\n            }\n            var content = new PDFStream(makeOutput(), null, true);\n            var props = {\n                Contents : self.attach(content),\n                Parent   : pageTree,\n                MediaBox : [ 0, 0, paperSize[0], paperSize[1] ]\n            };\n            var page = new PDFPage(self, props);\n            page._content = content;\n            pageTree.addPage(self.attach(page));\n\n            // canvas-like coord. system.  (0,0) is upper-left.\n            // text must be vertically mirorred before drawing.\n            page.transform(1, 0, 0, -1, 0, paperSize[1]);\n\n            if (margin) {\n                page.translate(margin.left, margin.top);\n                // XXX: clip to right/bottom margin.  Make this optional?\n                page.rect(0, 0, contentWidth, contentHeight);\n                page.clip();\n            }\n\n            self.pages.push(page);\n            return page;\n        };\n\n        self.render = function() {\n            var i;\n            /// file header\n            out(\"%PDF-1.4\", NL, \"%\\xc2\\xc1\\xda\\xcf\\xce\", NL, NL);\n\n            /// file body\n            for (i = 0; i < objects.length; ++i) {\n                objects[i].renderFull(out);\n                out(NL, NL);\n            }\n\n            /// cross-reference table\n            var xrefOffset = out.offset();\n            out(\"xref\", NL, 0, \" \", objects.length + 1, NL);\n            out(\"0000000000 65535 f \", NL);\n            for (i = 0; i < objects.length; ++i) {\n                out(zeropad(objects[i]._offset, 10), \" 00000 n \", NL);\n            }\n            out(NL);\n\n            /// trailer\n            out(\"trailer\", NL);\n            out(new PDFDictionary({\n                Size: objects.length + 1,\n                Root: catalog,\n                Info: info\n            }), NL, NL);\n\n            /// end\n            out(\"startxref\", NL, xrefOffset, NL);\n            out(\"%%EOF\", NL);\n\n            return out.stream().offset(0);\n        };\n\n        self.loadFonts = loadFonts;\n        self.loadImages = loadImages;\n    }\n\n    getFont(url) {\n        var font = this.FONTS[url];\n        if (!font) {\n            font = FONT_CACHE[url];\n            if (!font) {\n                throw new Error(\"Font \" + url + \" has not been loaded\");\n            }\n            if (font === true) {\n                font = this.attach(new PDFStandardFont(url));\n            } else {\n                font = this.attach(new PDFFont(this, font));\n            }\n            this.FONTS[url] = font;\n        }\n        return font;\n    }\n\n    getImage(url) {\n        var img = this.IMAGES[url];\n        if (!img) {\n            img = IMAGE_CACHE[url];\n            if (!img) {\n                throw new Error(\"Image \" + url + \" has not been loaded\");\n            }\n            if (img === \"ERROR\") {\n                return null;\n            }\n            img = this.IMAGES[url] = this.attach(img.asStream(this));\n        }\n        return img;\n    }\n\n    getOpacityGS(opacity, forStroke) {\n        var id = parseFloat(opacity).toFixed(3);\n        opacity = parseFloat(id);\n        id += forStroke ? \"S\" : \"F\";\n        var cache = this._opacityGSCache || (this._opacityGSCache = {});\n        var gs = cache[id];\n        if (!gs) {\n            var props = {\n                Type: _(\"ExtGState\")\n            };\n            if (forStroke) {\n                props.CA = opacity;\n            } else {\n                props.ca = opacity;\n            }\n            gs = this.attach(new PDFDictionary(props));\n            gs._resourceName = _(\"GS\" + (++RESOURCE_COUNTER));\n            cache[id] = gs;\n        }\n        return gs;\n    }\n\n    dict(props) {\n        return new PDFDictionary(props);\n    }\n\n    name(str) {\n        return _(str);\n    }\n\n    stream(props, content) {\n        return new PDFStream(content, props);\n    }\n}\n\n/* -----[ utils ]----- */\n\nfunction pad(str, len, ch) {\n    while (str.length < len) {\n        str = ch + str;\n    }\n    return str;\n}\n\nfunction zeropad(n, len) {\n    return pad(String(n), len, \"0\");\n}\n\nfunction hasOwnProperty(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nvar isArray = Array.isArray || function(obj) {\n    return obj instanceof Array;\n};\n\nfunction isDate(obj) {\n    return obj instanceof Date;\n}\n\nfunction renderArray(a, out) {\n    out(\"[\");\n    if (a.length > 0) {\n        out.withIndent(function(){\n            for (var i = 0; i < a.length; ++i) {\n                if (i > 0 && i % 8 === 0) {\n                    out.indent(a[i]);\n                } else {\n                    out(\" \", a[i]);\n                }\n            }\n        });\n        //out.indent();\n    }\n    out(\" ]\");\n}\n\nfunction renderDate(date, out) {\n    out(\"(D:\",\n        zeropad(date.getUTCFullYear(), 4),\n        zeropad(date.getUTCMonth() + 1, 2),\n        zeropad(date.getUTCDate(), 2),\n        zeropad(date.getUTCHours(), 2),\n        zeropad(date.getUTCMinutes(), 2),\n        zeropad(date.getUTCSeconds(), 2),\n        \"Z)\");\n}\n\nfunction mm2pt(mm) {\n    return mm * (72/25.4);\n}\n\nfunction cm2pt(cm) {\n    return mm2pt(cm * 10);\n}\n\nfunction in2pt(inch)  {\n    return inch * 72;\n}\n\n\nfunction unitsToPoints(x, def) {\n    if (typeof x == \"number\") {\n        return x;\n    }\n    if (typeof x == \"string\") {\n        var m;\n        m = /^\\s*([0-9.]+)\\s*(mm|cm|in|pt)\\s*$/.exec(x);\n        if (m) {\n            var num = parseFloat(m[1]);\n            if (!isNaN(num)) {\n                if (m[2] == \"pt\") {\n                    return num;\n                }\n                return {\n                    \"mm\": mm2pt,\n                    \"cm\": cm2pt,\n                    \"in\": in2pt\n                }[m[2]](num);\n            }\n        }\n    }\n    if (def != null) {\n        return def;\n    }\n    throw new Error(\"Can't parse unit: \" + x);\n}\n\n/* -----[ PDF basic objects ]----- */\n\nclass PDFValue {\n    beforeRender() {}\n}\n\nclass PDFString extends PDFValue {\n    constructor(value, utf16be) {\n        super();\n        this.value = value;\n        this.utf16be = Boolean(utf16be);\n    }\n\n    render(out) {\n        let txt = this.value;\n        if (this.utf16be) {\n            txt = BOM + encodeUTF16BE(txt);\n            txt = txt.replace(/([\\(\\)\\\\])/g, \"\\\\$1\");\n            out(\"(\", txt, \")\");\n        } else {\n            // out.writeString truncates charcodes to 8 bits and\n            // 0x128 & 0xFF is 40, the code for open paren.\n            // therefore we need to do the chopping here to make\n            // sure we backslash all cases.\n            let data = [ 40 ]; // open PDF string '('\n            for (var i = 0; i < txt.length; ++i) {\n                let code = txt.charCodeAt(i) & 0xFF;\n                if (code == 40 || code == 41 || code == 92) {\n                    // backslash before (, ) and \\\n                    data.push(92);\n                }\n                data.push(code);\n            }\n            data.push(41);  // ')' close PDF string\n            out.writeData(data);\n        }\n    }\n\n    toString() {\n        return this.value;\n    }\n}\n\nclass PDFHexString extends PDFString {\n    constructor(value) {\n        super(value);\n        this.value = value;\n    }\n\n    render(out) {\n        out(\"<\");\n        for (var i = 0; i < this.value.length; ++i) {\n            out(zeropad(this.value.charCodeAt(i).toString(16), 4));\n        }\n        out(\">\");\n    }\n}\n\n/// names\nclass PDFName extends PDFValue {\n    static get(name) {\n        return _(name);\n    }\n\n    constructor(name) {\n        super();\n        this.name = name;\n    }\n\n    render(out) {\n        out(\"/\" + this.escape());\n    }\n\n    escape() {\n        return this.name.replace(/[^\\x21-\\x7E]/g, function(c){\n            return \"#\" + zeropad(c.charCodeAt(0).toString(16), 2);\n        });\n    }\n\n    toString() {\n        return this.name;\n    }\n}\n\nvar PDFName_cache = {};\n\nfunction _(name) {\n    if (hasOwnProperty(PDFName_cache, name)) {\n        return PDFName_cache[name];\n    }\n    return (PDFName_cache[name] = new PDFName(name));\n}\n\n/// dictionary\n\nclass PDFDictionary extends PDFValue {\n    constructor(props) {\n        super();\n        this.props = props;\n    }\n\n    render(out) {\n        var props = this.props, empty = true;\n        out(\"<<\");\n        out.withIndent(function(){\n            for (var i in props) {\n                if (hasOwnProperty(props, i) && !/^_/.test(i)) {\n                    empty = false;\n                    out.indent(_(i), \" \", props[i]);\n                }\n            }\n        });\n        if (!empty) {\n            out.indent();\n        }\n        out(\">>\");\n    }\n}\n\n/// streams\n\nclass PDFStream extends PDFValue {\n    constructor(data, props, compress) {\n        super();\n        if (typeof data == \"string\") {\n            var tmp = BinaryStream();\n            tmp.write(data);\n            data = tmp;\n        }\n        this.data = data;\n        this.props = props || {};\n        this.compress = compress;\n    }\n\n    render(out) {\n        var data = this.data.get(), props = this.props;\n        if (this.compress && supportsDeflate()) {\n            if (!props.Filter) {\n                props.Filter = [];\n            } else if (!(props.Filter instanceof Array)) {\n                props.Filter = [ props.Filter ];\n            }\n            props.Filter.unshift(_(\"FlateDecode\"));\n            data = deflate(data);\n        }\n        props.Length = data.length;\n        out(new PDFDictionary(props), \" stream\", NL);\n        out.writeData(data);\n        out(NL, \"endstream\");\n    }\n}\n\n/// catalog\n\nclass PDFCatalog extends PDFDictionary {\n    constructor() {\n        super({\n            Type: _(\"Catalog\")\n        });\n    }\n\n    setPages(pagesObj) {\n        this.props.Pages = pagesObj;\n    }\n}\n\n/// page tree\n\nclass PDFPageTree extends PDFDictionary {\n    constructor() {\n        super({\n            Type  : _(\"Pages\"),\n            Kids  : [],\n            Count : 0\n        });\n    }\n\n    addPage(pageObj) {\n        this.props.Kids.push(pageObj);\n        this.props.Count++;\n    }\n}\n\n/// images\n\n// JPEG\n\nvar SOF_CODES = [0xc0, 0xc1, 0xc2, 0xc3, 0xc5, 0xc6, 0xc7, 0xc9, 0xca, 0xcb, 0xcd, 0xce, 0xcf];\n\nclass PDFJpegImage {\n    constructor(data) {\n        // we must determine the correct color space.  we'll parse a bit\n        // of the JPEG stream for this, it's still better than going\n        // through the canvas.\n        // https://github.com/telerik/kendo-ui-core/issues/2845\n        data.offset(0);\n        var width, height, colorSpace, bitsPerComponent;\n        var soi = data.readShort();\n        if (soi != 0xFFD8) {\n            // XXX: do we have some better options here?\n            throw new Error(\"Invalid JPEG image\");\n        }\n        while (!data.eof()) {\n            var ff = data.readByte();\n            if (ff != 0xFF) {\n                throw new Error(\"Invalid JPEG image\");\n            }\n            var marker = data.readByte();\n            var length = data.readShort();\n            if (SOF_CODES.indexOf(marker) >= 0) {\n                // \"start of frame\" marker\n                bitsPerComponent = data.readByte();\n                height = data.readShort();\n                width = data.readShort();\n                colorSpace = data.readByte();\n                break;\n            }\n            data.skip(length - 2);\n        }\n\n        if (colorSpace == null) {\n            throw new Error(\"Invalid JPEG image\");\n        }\n\n        var props = {\n            Type             : _(\"XObject\"),\n            Subtype          : _(\"Image\"),\n            Width            : width,\n            Height           : height,\n            BitsPerComponent : bitsPerComponent,\n            Filter           : _(\"DCTDecode\")\n        };\n\n        switch (colorSpace) {\n        case 1:\n            props.ColorSpace = _(\"DeviceGray\");\n            break;\n        case 3:\n            props.ColorSpace = _(\"DeviceRGB\");\n            break;\n        case 4:\n            props.ColorSpace = _(\"DeviceCMYK\");\n            props.Decode = [ 1, 0, 1, 0, 1, 0, 1, 0 ]; // invert colors\n            break;\n        }\n\n        this.asStream = function() {\n            data.offset(0);\n            var stream = new PDFStream(data, props);\n            stream._resourceName = _(\"I\" + (++RESOURCE_COUNTER));\n            return stream;\n        };\n    }\n}\n\n// PDFRawImage will be used for images with transparency (PNG)\n\nclass PDFRawImage {\n    constructor(width, height, rgb, alpha) {\n        this.asStream = function(pdf) {\n            var mask = new PDFStream(alpha, {\n                Type             : _(\"XObject\"),\n                Subtype          : _(\"Image\"),\n                Width            : width,\n                Height           : height,\n                BitsPerComponent : 8,\n                ColorSpace       : _(\"DeviceGray\")\n            }, true);\n            var stream = new PDFStream(rgb, {\n                Type             : _(\"XObject\"),\n                Subtype          : _(\"Image\"),\n                Width            : width,\n                Height           : height,\n                BitsPerComponent : 8,\n                ColorSpace       : _(\"DeviceRGB\"),\n                SMask            : pdf.attach(mask)\n            }, true);\n            stream._resourceName = _(\"I\" + (++RESOURCE_COUNTER));\n            return stream;\n        };\n    }\n}\n\n/// standard fonts\n\nclass PDFStandardFont extends PDFDictionary {\n    constructor(name){\n        super({\n            Type     : _(\"Font\"),\n            Subtype  : _(\"Type1\"),\n            BaseFont : _(name)\n        });\n\n        this._resourceName = _(\"F\" + (++RESOURCE_COUNTER));\n    }\n\n    encodeText(str) {\n        return new PDFString(String(str));\n    }\n}\n\n/// TTF fonts\n\nclass PDFFont extends PDFDictionary {\n    constructor(pdf, font, props){\n        super({});\n\n        props = this.props;\n        props.Type = _(\"Font\");\n        props.Subtype = _(\"Type0\");\n        props.Encoding = _(\"Identity-H\");\n\n        this._pdf = pdf;\n        this._font = font;\n        this._sub = font.makeSubset();\n        this._resourceName = _(\"F\" + (++RESOURCE_COUNTER));\n\n        var head = font.head;\n\n        this.name = font.psName;\n        var scale = this.scale = font.scale;\n        this.bbox = [\n            head.xMin * scale,\n            head.yMin * scale,\n            head.xMax * scale,\n            head.yMax * scale\n        ];\n\n        this.italicAngle = font.post.italicAngle;\n        this.ascent = font.ascent * scale;\n        this.descent = font.descent * scale;\n        this.lineGap = font.lineGap * scale;\n        this.capHeight = font.os2.capHeight || this.ascent;\n        this.xHeight = font.os2.xHeight || 0;\n        this.stemV = 0;\n\n        this.familyClass = (font.os2.familyClass || 0) >> 8;\n        this.isSerif = this.familyClass >= 1 && this.familyClass <= 7;\n        this.isScript = this.familyClass == 10;\n\n        this.flags = ((font.post.isFixedPitch ? 1 : 0) |\n                    (this.isSerif ? 1 << 1 : 0) |\n                    (this.isScript ? 1 << 3 : 0) |\n                    (this.italicAngle !== 0 ? 1 << 6 : 0) |\n                    (1 << 5));\n        }\n\n        encodeText(text) {\n            return new PDFHexString(this._sub.encodeText(String(text)));\n        }\n\n        getTextWidth(fontSize, text) {\n            var width = 0, codeMap = this._font.cmap.codeMap;\n            for (var i = 0; i < text.length; ++i) {\n                var glyphId = codeMap[text.charCodeAt(i)];\n                width += this._font.widthOfGlyph(glyphId || 0);\n            }\n            return width * fontSize / 1000;\n        }\n\n        beforeRender() {\n            var self = this;\n            var sub = self._sub;\n\n            // write the TTF data\n            var data = sub.render();\n            var fontStream = new PDFStream(BinaryStream(data), {\n                Length1: data.length\n            }, true);\n\n            var descriptor = self._pdf.attach(new PDFDictionary({\n                Type         : _(\"FontDescriptor\"),\n                FontName     : _(self._sub.psName),\n                FontBBox     : self.bbox,\n                Flags        : self.flags,\n                StemV        : self.stemV,\n                ItalicAngle  : self.italicAngle,\n                Ascent       : self.ascent,\n                Descent      : self.descent,\n                CapHeight    : self.capHeight,\n                XHeight      : self.xHeight,\n                FontFile2    : self._pdf.attach(fontStream)\n            }));\n\n            var cmap = sub.ncid2ogid;\n            var firstChar = sub.firstChar;\n            var lastChar = sub.lastChar;\n            var charWidths = [];\n            (function loop(i, chunk){\n                if (i <= lastChar) {\n                    var gid = cmap[i];\n                    if (gid == null) {\n                        loop(i + 1);\n                    } else {\n                        if (!chunk) {\n                            charWidths.push(i, chunk = []);\n                        }\n                        chunk.push(self._font.widthOfGlyph(gid));\n                        loop(i + 1, chunk);\n                    }\n                }\n            })(firstChar);\n\n            // As if two dictionaries weren't enough, we need another\n            // one, the \"descendant font\".  Only that one can be of\n            // Subtype CIDFontType2.  PDF is the X11 of document\n            // formats: portable but full of legacy that nobody cares\n            // about anymore.\n\n            var descendant = new PDFDictionary({\n                Type: _(\"Font\"),\n                Subtype: _(\"CIDFontType2\"),\n                BaseFont: _(self._sub.psName),\n                CIDSystemInfo: new PDFDictionary({\n                    Registry   : new PDFString(\"Adobe\"),\n                    Ordering   : new PDFString(\"Identity\"),\n                    Supplement : 0\n                }),\n                FontDescriptor: descriptor,\n                FirstChar: firstChar,\n                LastChar: lastChar,\n                DW: Math.round(self._font.widthOfGlyph(0)),\n                W: charWidths,\n                CIDToGIDMap: self._pdf.attach(self._makeCidToGidMap())\n            });\n\n            var dict = self.props;\n            dict.BaseFont = _(self._sub.psName);\n            dict.DescendantFonts = [ self._pdf.attach(descendant) ];\n\n            // Compute the ToUnicode map so that apps can extract\n            // meaningful text from the PDF.\n            var unimap = new PDFToUnicodeCmap(firstChar, lastChar, sub.subset);\n            var unimapStream = new PDFStream(makeOutput(), null, true);\n            unimapStream.data(unimap);\n            dict.ToUnicode = self._pdf.attach(unimapStream);\n        }\n\n        _makeCidToGidMap() {\n            return new PDFStream(BinaryStream(this._sub.cidToGidMap()), null, true);\n        }\n}\n\nclass PDFToUnicodeCmap extends PDFValue {\n    constructor(firstChar, lastChar, map){\n        super();\n        this.firstChar = firstChar;\n        this.lastChar = lastChar;\n        this.map = map;\n    }\n\n    render(out) {\n        out.indent(\"/CIDInit /ProcSet findresource begin\");\n        out.indent(\"12 dict begin\");\n        out.indent(\"begincmap\");\n        out.indent(\"/CIDSystemInfo <<\");\n        out.indent(\"  /Registry (Adobe)\");\n        out.indent(\"  /Ordering (UCS)\");\n        out.indent(\"  /Supplement 0\");\n        out.indent(\">> def\");\n        out.indent(\"/CMapName /Adobe-Identity-UCS def\");\n        out.indent(\"/CMapType 2 def\");\n        out.indent(\"1 begincodespacerange\");\n        out.indent(\"  <0000><ffff>\");\n        out.indent(\"endcodespacerange\");\n\n        var self = this;\n        out.indent(self.lastChar - self.firstChar + 1, \" beginbfchar\");\n        out.withIndent(function(){\n            for (var code = self.firstChar; code <= self.lastChar; ++code) {\n                var unicode = self.map[code];\n                var str = ucs2encode([ unicode ]);\n                out.indent(\"<\", zeropad(code.toString(16), 4), \">\", \"<\");\n                for (var i = 0; i < str.length; ++i) {\n                    out(zeropad(str.charCodeAt(i).toString(16), 4));\n                }\n                out(\">\");\n            }\n        });\n        out.indent(\"endbfchar\");\n\n        out.indent(\"endcmap\");\n        out.indent(\"CMapName currentdict /CMap defineresource pop\");\n        out.indent(\"end\");\n        out.indent(\"end\");\n    }\n}\n\n/// gradients\n\nfunction makeHash(a) {\n    return a.map(function(x){\n        return isArray(x) ? makeHash(x)\n            : typeof x == \"number\" ? (Math.round(x * 1000) / 1000).toFixed(3)\n            : x;\n    }).join(\" \");\n}\n\nfunction cacheColorGradientFunction(pdf, r1, g1, b1, r2, g2, b2) {\n    var hash = makeHash([ r1, g1, b1, r2, g2, b2 ]);\n    var func = pdf.GRAD_COL_FUNCTIONS[hash];\n    if (!func) {\n        func = pdf.GRAD_COL_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n            FunctionType: 2,\n            Domain: [ 0, 1 ],\n            Range: [ 0, 1, 0, 1, 0, 1 ],\n            N: 1,\n            C0: [ r1 , g1 , b1 ],\n            C1: [ r2 , g2 , b2 ]\n        }));\n    }\n    return func;\n}\n\nfunction cacheOpacityGradientFunction(pdf, a1, a2) {\n    var hash = makeHash([ a1, a2 ]);\n    var func = pdf.GRAD_OPC_FUNCTIONS[hash];\n    if (!func) {\n        func = pdf.GRAD_OPC_FUNCTIONS[hash] = pdf.attach(new PDFDictionary({\n            FunctionType: 2,\n            Domain: [ 0, 1 ],\n            Range: [ 0, 1 ],\n            N: 1,\n            C0: [ a1 ],\n            C1: [ a2 ]\n        }));\n    }\n    return func;\n}\n\nfunction makeGradientFunctions(pdf, stops) {\n    var hasAlpha = false;\n    var opacities = [];\n    var colors = [];\n    var offsets = [];\n    var encode = [];\n    var i, prev, cur, prevColor, curColor;\n    for (i = 1; i < stops.length; ++i) {\n        prev = stops[i - 1];\n        cur = stops[i];\n        prevColor = prev.color;\n        curColor = cur.color;\n        colors.push(cacheColorGradientFunction(\n            pdf,\n            prevColor.r, prevColor.g, prevColor.b,\n            curColor.r,  curColor.g,  curColor.b\n        ));\n        if (prevColor.a < 1 || curColor.a < 1) {\n            hasAlpha = true;\n        }\n        offsets.push(cur.offset);\n        encode.push(0, 1);\n    }\n    if (hasAlpha) {\n        for (i = 1; i < stops.length; ++i) {\n            prev = stops[i - 1];\n            cur = stops[i];\n            prevColor = prev.color;\n            curColor = cur.color;\n            opacities.push(cacheOpacityGradientFunction(\n                pdf, prevColor.a, curColor.a\n            ));\n        }\n    }\n    offsets.pop();\n    return {\n        hasAlpha  : hasAlpha,\n        colors    : assemble(colors),\n        opacities : hasAlpha ? assemble(opacities) : null\n    };\n    function assemble(funcs) {\n        if (funcs.length == 1) {\n            return funcs[0];\n        }\n        return {\n            FunctionType: 3,\n            Functions: funcs,\n            Domain: [ 0, 1 ],\n            Bounds: offsets,\n            Encode: encode\n        };\n    }\n}\n\nfunction cacheColorGradient(pdf, isRadial, stops, coords, funcs, box) {\n    var shading, hash;\n    // if box is given then we have user-space coordinates, which\n    // means the gradient is designed for a certain position/size\n    // on page.  caching won't do any good.\n    if (!box) {\n        var a = [ isRadial ].concat(coords);\n        stops.forEach(function(x){\n            a.push(x.offset, x.color.r, x.color.g, x.color.b);\n        });\n        hash = makeHash(a);\n        shading = pdf.GRAD_COL[hash];\n    }\n    if (!shading) {\n        shading = new PDFDictionary({\n            Type: _(\"Shading\"),\n            ShadingType: isRadial ? 3 : 2,\n            ColorSpace: _(\"DeviceRGB\"),\n            Coords: coords,\n            Domain: [ 0, 1 ],\n            Function: funcs,\n            Extend: [ true, true ]\n        });\n        pdf.attach(shading);\n        shading._resourceName = \"S\" + (++RESOURCE_COUNTER);\n        if (hash) {\n            pdf.GRAD_COL[hash] = shading;\n        }\n    }\n    return shading;\n}\n\nfunction cacheOpacityGradient(pdf, isRadial, stops, coords, funcs, box) {\n    var opacity, hash;\n    // if box is given then we have user-space coordinates, which\n    // means the gradient is designed for a certain position/size\n    // on page.  caching won't do any good.\n    if (!box) {\n        var a = [ isRadial ].concat(coords);\n        stops.forEach(function(x){\n            a.push(x.offset, x.color.a);\n        });\n        hash = makeHash(a);\n        opacity = pdf.GRAD_OPC[hash];\n    }\n    if (!opacity) {\n        opacity = new PDFDictionary({\n            Type: _(\"ExtGState\"),\n            AIS: false,\n            CA: 1,\n            ca: 1,\n            SMask: {\n                Type: _(\"Mask\"),\n                S: _(\"Luminosity\"),\n                G: pdf.attach(new PDFStream(\"/a0 gs /s0 sh\", {\n                    Type: _(\"XObject\"),\n                    Subtype: _(\"Form\"),\n                    FormType: 1,\n                    BBox: (box ? [\n                        box.left, box.top + box.height, box.left + box.width, box.top\n                    ] : [ 0, 1, 1, 0 ]),\n                    Group: {\n                        Type: _(\"Group\"),\n                        S: _(\"Transparency\"),\n                        CS: _(\"DeviceGray\"),\n                        I: true\n                    },\n                    Resources: {\n                        ExtGState: {\n                            a0: { CA: 1, ca: 1 }\n                        },\n                        Shading: {\n                            s0: {\n                                ColorSpace: _(\"DeviceGray\"),\n                                Coords: coords,\n                                Domain: [ 0, 1 ],\n                                ShadingType: isRadial ? 3 : 2,\n                                Function: funcs,\n                                Extend: [ true, true ]\n                            }\n                        }\n                    }\n                }))\n            }\n        });\n        pdf.attach(opacity);\n        opacity._resourceName = \"O\" + (++RESOURCE_COUNTER);\n        if (hash) {\n            pdf.GRAD_OPC[hash] = opacity;\n        }\n    }\n    return opacity;\n}\n\nfunction cacheGradient(pdf, gradient, box) {\n    var isRadial = gradient.type == \"radial\";\n    var funcs = makeGradientFunctions(pdf, gradient.stops);\n    var coords = isRadial ? [\n        gradient.start.x , gradient.start.y , gradient.start.r,\n        gradient.end.x   , gradient.end.y   , gradient.end.r\n    ] : [\n        gradient.start.x , gradient.start.y,\n        gradient.end.x   , gradient.end.y\n    ];\n    var shading = cacheColorGradient(\n        pdf, isRadial, gradient.stops, coords, funcs.colors, gradient.userSpace && box\n    );\n    var opacity = funcs.hasAlpha ? cacheOpacityGradient(\n        pdf, isRadial, gradient.stops, coords, funcs.opacities, gradient.userSpace && box\n    ) : null;\n    return {\n        hasAlpha: funcs.hasAlpha,\n        shading: shading,\n        opacity: opacity\n    };\n}\n\n/// page object\n\nclass PDFPage extends PDFDictionary {\n    constructor(pdf, props){\n        super(props);\n\n        this._pdf = pdf;\n        this._rcount = 0;\n        this._textMode = false;\n        this._fontResources = {};\n        this._gsResources = {};\n        this._xResources = {};\n        this._patResources = {};\n        this._shResources = {};\n        this._opacity = 1;\n        this._matrix = [ 1, 0, 0, 1, 0, 0 ];\n        this._annotations = [];\n\n        this._font = null;\n        this._fontSize = null;\n\n        this._contextStack = [];\n\n        props = this.props;\n        props.Type = _(\"Page\");\n        props.ProcSet = [\n            _(\"PDF\"),\n            _(\"Text\"),\n            _(\"ImageB\"),\n            _(\"ImageC\"),\n            _(\"ImageI\")\n        ];\n        props.Resources = new PDFDictionary({\n            Font      : new PDFDictionary(this._fontResources),\n            ExtGState : new PDFDictionary(this._gsResources),\n            XObject   : new PDFDictionary(this._xResources),\n            Pattern   : new PDFDictionary(this._patResources),\n            Shading   : new PDFDictionary(this._shResources)\n        });\n        props.Annots = this._annotations;\n    }\n\n    _out() {\n        this._content.data.apply(null, arguments);\n    }\n\n    transform(a, b, c, d, e, f) {\n        if (!isIdentityMatrix(arguments)) {\n            this._matrix = mmul(arguments, this._matrix);\n            this._out(a, \" \", b, \" \", c, \" \", d, \" \", e, \" \", f, \" cm\");\n            // XXX: debug\n            // this._out(\" % current matrix: \", this._matrix);\n            this._out(NL);\n        }\n    }\n\n    translate(dx, dy) {\n        this.transform(1, 0, 0, 1, dx, dy);\n    }\n\n    scale(sx, sy) {\n        this.transform(sx, 0, 0, sy, 0, 0);\n    }\n\n    rotate(angle) {\n        var cos = Math.cos(angle), sin = Math.sin(angle);\n        this.transform(cos, sin, -sin, cos, 0, 0);\n    }\n\n    beginText() {\n        this._textMode = true;\n        this._out(\"BT\", NL);\n    }\n\n    endText() {\n        this._textMode = false;\n        this._out(\"ET\", NL);\n    }\n\n    _requireTextMode() {\n        if (!this._textMode) {\n            throw new Error(\"Text mode required; call page.beginText() first\");\n        }\n    }\n\n    _requireFont() {\n        if (!this._font) {\n            throw new Error(\"No font selected; call page.setFont() first\");\n        }\n    }\n\n    setFont(font, size) {\n        this._requireTextMode();\n        if (font == null) {\n            font = this._font;\n        } else if (!(font instanceof PDFFont)) {\n            font = this._pdf.getFont(font);\n        }\n        if (size == null) {\n            size = this._fontSize;\n        }\n        this._fontResources[font._resourceName] = font;\n        this._font = font;\n        this._fontSize = size;\n        this._out(font._resourceName, \" \", size, \" Tf\", NL);\n    }\n\n    setTextLeading(size) {\n        this._requireTextMode();\n        this._out(size, \" TL\", NL);\n    }\n\n    setTextRenderingMode(mode) {\n        this._requireTextMode();\n        this._out(mode, \" Tr\", NL);\n    }\n\n    showText(text, requestedWidth) {\n        this._requireFont();\n        if (text.length > 1 && requestedWidth && this._font instanceof PDFFont) {\n            var outputWidth = this._font.getTextWidth(this._fontSize, text);\n            var scale = requestedWidth / outputWidth * 100;\n            this._out(scale, \" Tz \");\n        }\n        this._out(this._font.encodeText(text), \" Tj\", NL);\n    }\n\n    showTextNL(text) {\n        this._requireFont();\n        this._out(this._font.encodeText(text), \" '\", NL);\n    }\n\n    addLink(uri, box) {\n        var ll = this._toPage({ x: box.left, y: box.bottom });\n        var ur = this._toPage({ x: box.right, y: box.top });\n        this._annotations.push(new PDFDictionary({\n            Type    : _(\"Annot\"),\n            Subtype : _(\"Link\"),\n            Rect    : [ ll.x, ll.y, ur.x, ur.y ],\n            Border  : [ 0, 0, 0 ],\n            A       : new PDFDictionary({\n                Type : _(\"Action\"),\n                S    : _(\"URI\"),\n                URI  : new PDFString(uri)\n            })\n        }));\n    }\n\n    setStrokeColor(r, g, b) {\n        this._out(r, \" \", g, \" \", b, \" RG\", NL);\n    }\n\n    setOpacity(opacity) {\n        this.setFillOpacity(opacity);\n        this.setStrokeOpacity(opacity);\n        this._opacity *= opacity;\n    }\n\n    setStrokeOpacity(opacity) {\n        if (opacity < 1) {\n            var gs = this._pdf.getOpacityGS(this._opacity * opacity, true);\n            this._gsResources[gs._resourceName] = gs;\n            this._out(gs._resourceName, \" gs\", NL);\n        }\n    }\n\n    setFillColor(r, g, b) {\n        this._out(r, \" \", g, \" \", b, \" rg\", NL);\n    }\n\n    setFillOpacity(opacity) {\n        if (opacity < 1) {\n            var gs = this._pdf.getOpacityGS(this._opacity * opacity, false);\n            this._gsResources[gs._resourceName] = gs;\n            this._out(gs._resourceName, \" gs\", NL);\n        }\n    }\n\n    gradient(gradient, box) {\n        this.save();\n        this.rect(box.left, box.top, box.width, box.height);\n        this.clip();\n        if (!gradient.userSpace) {\n            this.transform(box.width, 0, 0, box.height, box.left, box.top);\n        }\n        var g = cacheGradient(this._pdf, gradient, box);\n        var sname = g.shading._resourceName, oname;\n        this._shResources[sname] = g.shading;\n        if (g.hasAlpha) {\n            oname = g.opacity._resourceName;\n            this._gsResources[oname] = g.opacity;\n            this._out(\"/\" + oname + \" gs \");\n        }\n        this._out(\"/\" + sname + \" sh\", NL);\n        this.restore();\n    }\n\n    setDashPattern(dashArray, dashPhase) {\n        this._out(dashArray, \" \", dashPhase, \" d\", NL);\n    }\n\n    setLineWidth(width) {\n        this._out(width, \" w\", NL);\n    }\n\n    setLineCap(lineCap) {\n        this._out(lineCap, \" J\", NL);\n    }\n\n    setLineJoin(lineJoin) {\n        this._out(lineJoin, \" j\", NL);\n    }\n\n    setMitterLimit(mitterLimit) {\n        this._out(mitterLimit, \" M\", NL);\n    }\n\n    save() {\n        this._contextStack.push(this._context());\n        this._out(\"q\", NL);\n    }\n\n    restore() {\n        this._out(\"Q\", NL);\n        this._context(this._contextStack.pop());\n    }\n\n\n    // paths\n    moveTo(x, y) {\n        this._out(x, \" \", y, \" m\", NL);\n    }\n\n    lineTo(x, y) {\n        this._out(x, \" \", y, \" l\", NL);\n    }\n\n    bezier(x1, y1, x2, y2, x3, y3) {\n        this._out(x1, \" \", y1, \" \", x2, \" \", y2, \" \", x3, \" \", y3, \" c\", NL);\n    }\n\n    bezier1(x1, y1, x3, y3) {\n        this._out(x1, \" \", y1, \" \", x3, \" \", y3, \" y\", NL);\n    }\n\n    bezier2(x2, y2, x3, y3) {\n        this._out(x2, \" \", y2, \" \", x3, \" \", y3, \" v\", NL);\n    }\n\n    close() {\n        this._out(\"h\", NL);\n    }\n\n    rect(x, y, w, h) {\n        this._out(x, \" \", y, \" \", w, \" \", h, \" re\", NL);\n    }\n\n    ellipse(x, y, rx, ry) {\n        function _X(v) { return x + v; }\n        function _Y(v) { return y + v; }\n\n        // how to get to the \"magic number\" is explained here:\n        // http://www.whizkidtech.redprince.net/bezier/circle/kappa/\n        var k = 0.5522847498307936;\n\n        this.moveTo(_X(0), _Y(ry));\n        this.bezier(\n            _X(rx * k) , _Y(ry),\n            _X(rx)     , _Y(ry * k),\n            _X(rx)     , _Y(0)\n        );\n        this.bezier(\n            _X(rx)     , _Y(-ry * k),\n            _X(rx * k) , _Y(-ry),\n            _X(0)      , _Y(-ry)\n        );\n        this.bezier(\n            _X(-rx * k) , _Y(-ry),\n            _X(-rx)     , _Y(-ry * k),\n            _X(-rx)     , _Y(0)\n        );\n        this.bezier(\n            _X(-rx)     , _Y(ry * k),\n            _X(-rx * k) , _Y(ry),\n            _X(0)       , _Y(ry)\n        );\n    }\n\n    circle(x, y, r) {\n        this.ellipse(x, y, r, r);\n    }\n\n    stroke() {\n        this._out(\"S\", NL);\n    }\n\n    nop() {\n        this._out(\"n\", NL);\n    }\n\n    clip() {\n        this._out(\"W n\", NL);\n    }\n\n    clipStroke() {\n        this._out(\"W S\", NL);\n    }\n\n    closeStroke() {\n        this._out(\"s\", NL);\n    }\n\n    fill() {\n        this._out(\"f\", NL);\n    }\n\n    fillStroke() {\n        this._out(\"B\", NL);\n    }\n\n    drawImage(url) {\n        var img = this._pdf.getImage(url);\n        if (img) { // the result can be null for a cross-domain image\n            this._xResources[img._resourceName] = img;\n            this._out(img._resourceName, \" Do\", NL);\n        }\n    }\n\n    comment(txt) {\n        var self = this;\n        txt.split(/\\r?\\n/g).forEach(function(line){\n            self._out(\"% \", line, NL);\n        });\n    }\n\n    // internal\n    _context(val) {\n        if (val != null) {\n            this._opacity = val.opacity;\n            this._matrix = val.matrix;\n        } else {\n            return {\n                opacity: this._opacity,\n                matrix: this._matrix\n            };\n        }\n    }\n\n    _toPage(p) {\n        var m = this._matrix;\n        var a = m[0], b = m[1], c = m[2], d = m[3], e = m[4], f = m[5];\n        return {\n            x: a*p.x + c*p.y + e,\n            y: b*p.x + d*p.y + f\n        };\n    }\n}\n\nfunction unquote(str) {\n    return str.replace(/^\\s*(['\"])(.*)\\1\\s*$/, \"$2\");\n}\n\nfunction parseFontDef(fontdef) {\n    // XXX: this is very crude for now and buggy.  Proper parsing is quite involved.\n    var rx = /^\\s*((normal|italic)\\s+)?((normal|small-caps)\\s+)?((normal|bold|\\d+)\\s+)?(([0-9.]+)(px|pt))(\\/(([0-9.]+)(px|pt)|normal))?\\s+(.*?)\\s*$/i;\n    var m = rx.exec(fontdef);\n    if (!m) {\n        return { fontSize: 12, fontFamily: \"sans-serif\" };\n    }\n    var fontSize = m[8] ? parseInt(m[8], 10) : 12;\n    return {\n        italic     : m[2] && m[2].toLowerCase() == \"italic\",\n        variant    : m[4],\n        bold       : m[6] && /bold|700/i.test(m[6]),\n        fontSize   : fontSize,\n        lineHeight : m[12] ? m[12] == \"normal\" ? fontSize : parseInt(m[12], 10) : null,\n        fontFamily : m[14].split(/\\s*,\\s*/g).map(unquote)\n    };\n}\n\nfunction getFontURL(style) {\n    function mkFamily(name) {\n        if (style.bold) {\n            name += \"|bold\";\n        }\n        if (style.italic) {\n            name += \"|italic\";\n        }\n        return name.toLowerCase();\n    }\n    var fontFamily = style.fontFamily;\n    var name, url;\n    if (fontFamily instanceof Array) {\n        for (var i = 0; i < fontFamily.length; ++i) {\n            name = mkFamily(fontFamily[i]);\n            url = FONT_MAPPINGS[name];\n            if (url) {\n                break;\n            }\n        }\n    } else {\n        url = FONT_MAPPINGS[fontFamily.toLowerCase()];\n    }\n    while (typeof url == \"function\") {\n        url = url();\n    }\n    if (!url) {\n        url = \"Times-Roman\";\n    }\n    return url;\n}\n\nvar FONT_MAPPINGS = {\n    \"serif\"                    : \"Times-Roman\",\n    \"serif|bold\"               : \"Times-Bold\",\n    \"serif|italic\"             : \"Times-Italic\",\n    \"serif|bold|italic\"        : \"Times-BoldItalic\",\n    \"sans-serif\"               : \"Helvetica\",\n    \"sans-serif|bold\"          : \"Helvetica-Bold\",\n    \"sans-serif|italic\"        : \"Helvetica-Oblique\",\n    \"sans-serif|bold|italic\"   : \"Helvetica-BoldOblique\",\n    \"monospace\"                : \"Courier\",\n    \"monospace|bold\"           : \"Courier-Bold\",\n    \"monospace|italic\"         : \"Courier-Oblique\",\n    \"monospace|bold|italic\"    : \"Courier-BoldOblique\",\n    \"zapfdingbats\"             : \"ZapfDingbats\",\n    \"zapfdingbats|bold\"        : \"ZapfDingbats\",\n    \"zapfdingbats|italic\"      : \"ZapfDingbats\",\n    \"zapfdingbats|bold|italic\" : \"ZapfDingbats\"\n};\n\nfunction fontAlias(alias, name) {\n    alias = alias.toLowerCase();\n    FONT_MAPPINGS[alias] = function() {\n        return FONT_MAPPINGS[name];\n    };\n    FONT_MAPPINGS[alias + \"|bold\"] = function() {\n        return FONT_MAPPINGS[name + \"|bold\"];\n    };\n    FONT_MAPPINGS[alias + \"|italic\"] = function() {\n        return FONT_MAPPINGS[name + \"|italic\"];\n    };\n    FONT_MAPPINGS[alias + \"|bold|italic\"] = function() {\n        return FONT_MAPPINGS[name + \"|bold|italic\"];\n    };\n}\n\n// Let's define some common names to an appropriate replacement.\n// These are overridable via pdf.defineFont, should the user want to\n// include the proper versions.\n\nfontAlias(\"Times New Roman\" , \"serif\");\nfontAlias(\"Courier New\"     , \"monospace\");\nfontAlias(\"Arial\"           , \"sans-serif\");\nfontAlias(\"Helvetica\"       , \"sans-serif\");\nfontAlias(\"Verdana\"         , \"sans-serif\");\nfontAlias(\"Tahoma\"          , \"sans-serif\");\nfontAlias(\"Georgia\"         , \"sans-serif\");\nfontAlias(\"Monaco\"          , \"monospace\");\nfontAlias(\"Andale Mono\"     , \"monospace\");\n\nfunction defineFont(name, url) {\n    if (arguments.length == 1) {\n        for (var i in name) {\n            if (hasOwnProperty(name, i)) {\n                defineFont(i, name[i]);\n            }\n        }\n    } else {\n        name = name.toLowerCase();\n        FONT_MAPPINGS[name] = url;\n\n        // special handling for DejaVu fonts: if they get defined,\n        // let them also replace the default families, for good\n        // Unicode support out of the box.\n        switch (name) {\n          case \"dejavu sans\"               : FONT_MAPPINGS[\"sans-serif\"]              = url; break;\n          case \"dejavu sans|bold\"          : FONT_MAPPINGS[\"sans-serif|bold\"]         = url; break;\n          case \"dejavu sans|italic\"        : FONT_MAPPINGS[\"sans-serif|italic\"]       = url; break;\n          case \"dejavu sans|bold|italic\"   : FONT_MAPPINGS[\"sans-serif|bold|italic\"]  = url; break;\n          case \"dejavu serif\"              : FONT_MAPPINGS[\"serif\"]                   = url; break;\n          case \"dejavu serif|bold\"         : FONT_MAPPINGS[\"serif|bold\"]              = url; break;\n          case \"dejavu serif|italic\"       : FONT_MAPPINGS[\"serif|italic\"]            = url; break;\n          case \"dejavu serif|bold|italic\"  : FONT_MAPPINGS[\"serif|bold|italic\"]       = url; break;\n          case \"dejavu mono\"               : FONT_MAPPINGS[\"monospace\"]               = url; break;\n          case \"dejavu mono|bold\"          : FONT_MAPPINGS[\"monospace|bold\"]          = url; break;\n          case \"dejavu mono|italic\"        : FONT_MAPPINGS[\"monospace|italic\"]        = url; break;\n          case \"dejavu mono|bold|italic\"   : FONT_MAPPINGS[\"monospace|bold|italic\"]   = url; break;\n        }\n    }\n}\n\nfunction mmul(a, b) {\n    var a1 = a[0], b1 = a[1], c1 = a[2], d1 = a[3], e1 = a[4], f1 = a[5];\n    var a2 = b[0], b2 = b[1], c2 = b[2], d2 = b[3], e2 = b[4], f2 = b[5];\n    return [\n        a1*a2 + b1*c2,          a1*b2 + b1*d2,\n        c1*a2 + d1*c2,          c1*b2 + d1*d2,\n        e1*a2 + f1*c2 + e2,     e1*b2 + f1*d2 + f2\n    ];\n}\n\nfunction isIdentityMatrix(m) {\n    return m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 1 && m[4] === 0 && m[5] === 0;\n}\n\nconst TEXT_RENDERING_MODE = {\n    fill           : 0,\n    stroke         : 1,\n    fillAndStroke  : 2,\n    invisible      : 3,\n    fillAndClip    : 4,\n    strokeAndClip  : 5,\n    fillStrokeClip : 6,\n    clip           : 7\n};\n\nexport {\n    PDFDocument as Document,\n    BinaryStream,\n    defineFont,\n    parseFontDef,\n    getFontURL,\n    loadFonts,\n    loadImages,\n    getPaperOptions,\n    clearImageCache,\n    TEXT_RENDERING_MODE\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,SAASA,YAAY,EAAEC,UAAU,EAAEC,kBAAkB,EAAEC,gBAAgB,QAAQ,SAAS;AACxF,SAASC,OAAO,QAAQ,WAAW;AACnC,SAASC,OAAO,QAAQ,OAAO;AAC/B,SAASC,OAAO,EAAEC,eAAe,QAAQ,WAAW;AACpD,SAASC,aAAa,EAAEC,GAAG,QAAQ,oBAAoB;AACvD,SAASC,YAAY,QAAQ,SAAS;AAEtC,MAAMC,OAAO,GAAGP,OAAO,CAACO,OAAO;AAC/B,MAAMC,EAAE,GAAG,IAAI;AAEf,IAAIC,gBAAgB,GAAG,CAAC;AAExB,MAAMC,UAAU,GAAG;EACfC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,GAAG,EAAS,CAAE,KAAK,EAAK,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,GAAG,EAAS,CAAE,KAAK,EAAK,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,OAAO,EAAG,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,OAAO,CAAE;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,EAAE,EAAU,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,GAAG,EAAS,CAAE,KAAK,EAAK,MAAM,CAAG;EACjCC,SAAS,EAAG,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,KAAK,EAAO,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,KAAK,EAAO,CAAE,MAAM,EAAI,OAAO,CAAE;EACjCC,MAAM,EAAM,CAAE,MAAM,EAAI,MAAM,CAAG;EACjCC,OAAO,EAAK,CAAE,MAAM,EAAI,OAAO;AACnC,CAAC;AAED,SAASC,UAAUA,CAAA,EAAG;EAClB,IAAIC,WAAW,GAAG,CAAC;IAAEC,MAAM,GAAGvD,YAAY,CAAC,CAAC;EAC5C,SAASwD,GAAGA,CAAA,EAAG;IACX,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAE,EAAEF,CAAC,EAAE;MACvC,IAAIG,CAAC,GAAGF,SAAS,CAACD,CAAC,CAAC;MACpB,IAAIG,CAAC,KAAKC,SAAS,EAAE;QACjB,MAAM,IAAIC,KAAK,CAAC,gCAAgC,CAAC;MACrD,CAAC,MACI,IAAIF,CAAC,YAAYG,QAAQ,EAAE;QAC5BH,CAAC,CAACI,YAAY,CAACR,GAAG,CAAC;QACnBI,CAAC,CAACK,MAAM,CAACT,GAAG,CAAC;MACjB,CAAC,MACI,IAAIU,OAAO,CAACN,CAAC,CAAC,EAAE;QACjBO,WAAW,CAACP,CAAC,EAAEJ,GAAG,CAAC;MACvB,CAAC,MACI,IAAIY,MAAM,CAACR,CAAC,CAAC,EAAE;QAChBS,UAAU,CAACT,CAAC,EAAEJ,GAAG,CAAC;MACtB,CAAC,MACI,IAAI,OAAOI,CAAC,IAAI,QAAQ,EAAE;QAC3B,IAAIU,KAAK,CAACV,CAAC,CAAC,EAAE;UACV,MAAM,IAAIE,KAAK,CAAC,0BAA0B,CAAC;QAC/C;QACA;QACA,IAAIS,GAAG,GAAGX,CAAC,CAACY,OAAO,CAAC,CAAC,CAAC;QACtB,IAAID,GAAG,CAACE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;UACvBF,GAAG,GAAGA,GAAG,CAACG,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;QACnC;QACA,IAAIH,GAAG,IAAI,IAAI,EAAE;UACbA,GAAG,GAAG,GAAG;QACb;QACAhB,MAAM,CAACoB,WAAW,CAACJ,GAAG,CAAC;MAC3B,CAAC,MACI,IAAI,gBAAgB,CAACK,IAAI,CAAC,OAAOhB,CAAC,CAAC,EAAE;QACtCL,MAAM,CAACoB,WAAW,CAACE,MAAM,CAACjB,CAAC,CAAC,CAAC;MACjC,CAAC,MACI,IAAI,OAAOA,CAAC,CAACkB,GAAG,IAAI,UAAU,EAAE;QACjCvB,MAAM,CAACwB,KAAK,CAACnB,CAAC,CAACkB,GAAG,CAAC,CAAC,CAAC;MACzB,CAAC,MACI,IAAI,OAAOlB,CAAC,IAAI,QAAQ,EAAE;QAC3B,IAAI,CAACA,CAAC,EAAE;UACJL,MAAM,CAACoB,WAAW,CAAC,MAAM,CAAC;QAC9B,CAAC,MAAM;UACHnB,GAAG,CAAC,IAAIwB,aAAa,CAACpB,CAAC,CAAC,CAAC;QAC7B;MACJ;IACJ;EACJ;EACAJ,GAAG,CAACyB,SAAS,GAAG,UAASC,IAAI,EAAE;IAC3B3B,MAAM,CAACwB,KAAK,CAACG,IAAI,CAAC;EACtB,CAAC;EACD1B,GAAG,CAAC2B,UAAU,GAAG,UAASC,CAAC,EAAE;IACzB,EAAE9B,WAAW;IACb8B,CAAC,CAAC5B,GAAG,CAAC;IACN,EAAEF,WAAW;EACjB,CAAC;EACDE,GAAG,CAAC6B,MAAM,GAAG,YAAW;IACpB7B,GAAG,CAAC5C,EAAE,EAAE0E,GAAG,CAAC,EAAE,EAAEhC,WAAW,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;IACvCE,GAAG,CAAC+B,KAAK,CAAC,IAAI,EAAE7B,SAAS,CAAC;EAC9B,CAAC;EACDF,GAAG,CAACgC,MAAM,GAAG,YAAW;IACpB,OAAOjC,MAAM,CAACiC,MAAM,CAAC,CAAC;EAC1B,CAAC;EACDhC,GAAG,CAACiC,QAAQ,GAAG,YAAW;IACtB,MAAM,IAAI3B,KAAK,CAAC,YAAY,CAAC;EACjC,CAAC;EACDN,GAAG,CAACsB,GAAG,GAAG,YAAW;IACjB,OAAOvB,MAAM,CAACuB,GAAG,CAAC,CAAC;EACvB,CAAC;EACDtB,GAAG,CAACkC,MAAM,GAAG,YAAW;IACpB,OAAOnC,MAAM;EACjB,CAAC;EACD,OAAOC,GAAG;AACd;AAEA,SAASmC,UAAUA,CAACC,KAAK,EAAEC,EAAE,EAAE;EAC3B,IAAI7B,YAAY,GAAG4B,KAAK,CAAC5B,YAAY;EACrC,IAAI8B,WAAW,GAAGF,KAAK,CAAC3B,MAAM;EAE9B2B,KAAK,CAAC5B,YAAY,GAAG,YAAU,CAAC,CAAC;EAEjC4B,KAAK,CAAC3B,MAAM,GAAG,UAAST,GAAG,EAAE;IACzBA,GAAG,CAACqC,EAAE,EAAE,MAAM,CAAC;EACnB,CAAC;EAEDD,KAAK,CAACG,UAAU,GAAG,UAASvC,GAAG,EAAE;IAC7BoC,KAAK,CAACI,OAAO,GAAGxC,GAAG,CAACgC,MAAM,CAAC,CAAC;IAC5BhC,GAAG,CAACqC,EAAE,EAAE,SAAS,CAAC;IAClB7B,YAAY,CAACiC,IAAI,CAACL,KAAK,EAAEpC,GAAG,CAAC;IAC7BsC,WAAW,CAACG,IAAI,CAACL,KAAK,EAAEpC,GAAG,CAAC;IAC5BA,GAAG,CAAC,SAAS,CAAC;EAClB,CAAC;AACL;AAEA,SAAS0C,eAAeA,CAACC,SAAS,EAAE;EAChC,IAAI,OAAOA,SAAS,IAAI,UAAU,EAAE;IAChC,IAAIC,OAAO,GAAGD,SAAS;IACvBA,SAAS,GAAG,SAAAA,CAASE,GAAG,EAAEC,GAAG,EAAE;MAC3B,OAAOD,GAAG,IAAID,OAAO,GAAGA,OAAO,CAACC,GAAG,CAAC,GAAGC,GAAG;IAC9C,CAAC;EACL;EACA,IAAIC,SAAS,GAAGJ,SAAS,CAAC,WAAW,EAAErF,UAAU,CAACK,EAAE,CAAC;EACrD,IAAI,CAACoF,SAAS,EAAE;IACZ,OAAO,CAAC,CAAC;EACb;EACA,IAAI,OAAOA,SAAS,IAAI,QAAQ,EAAE;IAC9BA,SAAS,GAAGzF,UAAU,CAACyF,SAAS,CAACC,WAAW,CAAC,CAAC,CAAC;IAC/C,IAAID,SAAS,IAAI,IAAI,EAAE;MACnB,MAAM,IAAIzC,KAAK,CAAC,oBAAoB,CAAC;IACzC;EACJ;EAEAyC,SAAS,CAAC,CAAC,CAAC,GAAGE,aAAa,CAACF,SAAS,CAAC,CAAC,CAAC,CAAC;EAC1CA,SAAS,CAAC,CAAC,CAAC,GAAGE,aAAa,CAACF,SAAS,CAAC,CAAC,CAAC,CAAC;EAE1C,IAAIJ,SAAS,CAAC,WAAW,EAAE,KAAK,CAAC,EAAE;IAC/BI,SAAS,GAAG,CACRG,IAAI,CAACC,GAAG,CAACJ,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,CAAC,EACpCG,IAAI,CAACE,GAAG,CAACL,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,CAAC,CACvC;EACL;EAEA,IAAIM,MAAM,GAAGV,SAAS,CAAC,QAAQ,CAAC;EAChC,IAAIU,MAAM,EAAE;IACR,IAAI,OAAOA,MAAM,IAAI,QAAQ,IAAI,OAAOA,MAAM,IAAI,QAAQ,EAAE;MACxDA,MAAM,GAAGJ,aAAa,CAACI,MAAM,EAAE,CAAC,CAAC;MACjCA,MAAM,GAAG;QAAEC,IAAI,EAAED,MAAM;QAAEE,GAAG,EAAEF,MAAM;QAAEG,KAAK,EAAEH,MAAM;QAAEI,MAAM,EAAEJ;MAAO,CAAC;IACzE,CAAC,MAAM;MACHA,MAAM,GAAG;QACLC,IAAI,EAAKL,aAAa,CAACI,MAAM,CAACC,IAAI,EAAE,CAAC,CAAC;QACtCC,GAAG,EAAMN,aAAa,CAACI,MAAM,CAACE,GAAG,EAAE,CAAC,CAAC;QACrCC,KAAK,EAAIP,aAAa,CAACI,MAAM,CAACG,KAAK,EAAE,CAAC,CAAC;QACvCC,MAAM,EAAGR,aAAa,CAACI,MAAM,CAACI,MAAM,EAAE,CAAC;MAC3C,CAAC;IACL;IACA,IAAId,SAAS,CAAC,WAAW,CAAC,EAAE;MACxBI,SAAS,CAAC,CAAC,CAAC,IAAIM,MAAM,CAACC,IAAI,GAAGD,MAAM,CAACG,KAAK;MAC1CT,SAAS,CAAC,CAAC,CAAC,IAAIM,MAAM,CAACE,GAAG,GAAGF,MAAM,CAACI,MAAM;IAC9C;EACJ;EACA,OAAO;IAAEV,SAAS,EAAEA,SAAS;IAAEM,MAAM,EAAEA;EAAO,CAAC;AACnD;AAEA,IAAIK,UAAU,GAAG;EACb,aAAa,EAAa,IAAI;EAC9B,YAAY,EAAc,IAAI;EAC9B,cAAc,EAAY,IAAI;EAC9B,kBAAkB,EAAQ,IAAI;EAC9B,WAAW,EAAe,IAAI;EAC9B,gBAAgB,EAAU,IAAI;EAC9B,mBAAmB,EAAO,IAAI;EAC9B,uBAAuB,EAAG,IAAI;EAC9B,SAAS,EAAiB,IAAI;EAC9B,cAAc,EAAY,IAAI;EAC9B,iBAAiB,EAAS,IAAI;EAC9B,qBAAqB,EAAK,IAAI;EAC9B,QAAQ,EAAkB,IAAI;EAC9B,cAAc,EAAY;AAC9B,CAAC;AAED,SAASC,UAAUA,CAACC,GAAG,EAAEC,IAAI,EAAE;EAC3B;EACA,IAAIC,CAAC;EACL,IAAI3G,OAAO,CAAC4G,IAAI,KAAKD,CAAC,GAAG,oBAAoB,CAACE,IAAI,CAACJ,GAAG,CAAC,CAAC,EAAE;IACtDC,IAAI,CAACnH,kBAAkB,CAACkH,GAAG,CAACK,MAAM,CAACH,CAAC,CAAC,CAAC,CAAC,CAAC3D,MAAM,CAAC,CAAC,CAAC;IACjD;EACJ;EAEA,SAAS+D,KAAKA,CAAA,EAAG;IACb,IAAIC,MAAM,CAACC,OAAO,EAAE;MAChB,IAAID,MAAM,CAACC,OAAO,CAACF,KAAK,EAAE;QACtBC,MAAM,CAACC,OAAO,CAACF,KAAK,CAAC,qBAAqB,EAAEN,GAAG,CAAC;MACpD,CAAC,MAAM;QACHO,MAAM,CAACC,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAET,GAAG,CAAC;MAClD;IACJ;IACAC,IAAI,CAAC,IAAI,CAAC;EACd;EACA,IAAIS,GAAG,GAAG,IAAIC,cAAc,CAAC,CAAC;EAC9BD,GAAG,CAACE,IAAI,CAAC,KAAK,EAAEZ,GAAG,EAAE,IAAI,CAAC;EAC1B,IAAIjH,gBAAgB,EAAE;IAClB2H,GAAG,CAACG,YAAY,GAAG,aAAa;EACpC;EACAH,GAAG,CAACI,MAAM,GAAG,YAAW;IACpB,IAAIJ,GAAG,CAACK,MAAM,IAAI,GAAG,IAAIL,GAAG,CAACK,MAAM,IAAI,GAAG,EAAE;MACxC,IAAIhI,gBAAgB,EAAE;QAClBkH,IAAI,CAAC,IAAIe,UAAU,CAACN,GAAG,CAACO,QAAQ,CAAC,CAAC;MACtC,CAAC,MAAM;QACHhB,IAAI,CAAC,IAAIM,MAAM,CAACW,OAAO,CAACR,GAAG,CAACS,YAAY,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;MAC1D;IACJ,CAAC,MAAM;MACHd,KAAK,CAAC,CAAC;IACX;EACJ,CAAC;EACDI,GAAG,CAACW,OAAO,GAAGf,KAAK;EACnBI,GAAG,CAACY,IAAI,CAAC,IAAI,CAAC;AAClB;AAEA,SAASC,QAAQA,CAACvB,GAAG,EAAEC,IAAI,EAAE;EACzB,IAAIuB,IAAI,GAAG1B,UAAU,CAACE,GAAG,CAAC;EAC1B,IAAIwB,IAAI,EAAE;IACNvB,IAAI,CAACuB,IAAI,CAAC;EACd,CAAC,MAAM;IACHzB,UAAU,CAACC,GAAG,EAAE,UAASlC,IAAI,EAAC;MAC1B,IAAIA,IAAI,IAAI,IAAI,EAAE;QACd,MAAM,IAAIpB,KAAK,CAAC,wBAAwB,GAAGsD,GAAG,CAAC;MACnD,CAAC,MAAM;QACH,IAAIwB,IAAI,GAAG,IAAIvI,OAAO,CAAC6E,IAAI,CAAC;QAC5BgC,UAAU,CAACE,GAAG,CAAC,GAAGwB,IAAI;QACtBvB,IAAI,CAACuB,IAAI,CAAC;MACd;IACJ,CAAC,CAAC;EACN;AACJ;AAEA,IAAIC,WAAW,GAAG,CAAC,CAAC;AAEpB,SAASC,eAAeA,CAAA,EAAG;EACvBD,WAAW,GAAG,CAAC,CAAC;AACpB;AAEA,SAASE,SAASA,CAAC3B,GAAG,EAAE4B,IAAI,EAAE3B,IAAI,EAAEjB,OAAO,EAAE;EACzC,IAAI6C,GAAG,GAAGJ,WAAW,CAACzB,GAAG,CAAC;IAAE8B,OAAO;IAAEC,IAAI;EACzC,IAAIF,GAAG,EAAE;IACL5B,IAAI,CAAC4B,GAAG,CAAC;EACb,CAAC,MAAM;IACHA,GAAG,GAAG,IAAIG,KAAK,CAAC,CAAC;IACjB,IAAI,CAAE,SAAS,CAACxE,IAAI,CAACwC,GAAG,CAAE,EAAE;MACxB6B,GAAG,CAACI,WAAW,GAAG,WAAW;IACjC;IACA,IAAIlJ,gBAAgB,IAAI,CAAE,SAAS,CAACyE,IAAI,CAACwC,GAAG,CAAE,EAAE;MAC5C;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,IAAIkC,GAAG,GAAG,IAAIvB,cAAc,CAAC,CAAC;MAC9BuB,GAAG,CAACpB,MAAM,GAAG,YAAW;QACpBiB,IAAI,GAAGG,GAAG,CAACjB,QAAQ;QACnB,IAAI1H,OAAO,CAAC4I,OAAO,IAAIJ,IAAI,CAACK,IAAI,IAAI,eAAe,EAAE;UACjD;UACA,IAAIC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;UAC7BD,MAAM,CAACvB,MAAM,GAAG,YAAW;YACvB,IAAIyB,GAAG,GAAG,IAAIhC,MAAM,CAACiC,SAAS,CAAC,CAAC,CAACC,eAAe,CAAC,IAAI,CAACC,MAAM,EAAE,eAAe,CAAC;YAC9E,IAAIC,GAAG,GAAGJ,GAAG,CAACK,eAAe;YAC7B,IAAID,GAAG,CAACE,YAAY,CAAC,OAAO,CAAC,IAAIF,GAAG,CAACE,YAAY,CAAC,QAAQ,CAAC,EAAE;cACzD;cACAf,OAAO,GAAGgB,GAAG,CAACC,eAAe,CAAChB,IAAI,CAAC;cACnCiB,KAAK,CAAClB,OAAO,CAAC;YAClB,CAAC,MAAM;cACHa,GAAG,CAACM,YAAY,CAAC,OAAO,EAAErB,IAAI,CAACsB,KAAK,CAAC;cACrCP,GAAG,CAACM,YAAY,CAAC,QAAQ,EAAErB,IAAI,CAACuB,MAAM,CAAC;cACvC,IAAIC,GAAG,GAAG,IAAI7C,MAAM,CAAC8C,aAAa,CAAC,CAAC,CAACC,iBAAiB,CAACX,GAAG,CAAC;cAC3D,IAAIY,OAAO,GAAI,6BAA4BjK,YAAY,CAAC8J,GAAG,CAAE,EAAC;cAC9DJ,KAAK,CAACO,OAAO,CAAC;YAClB;UACJ,CAAC;UACDlB,MAAM,CAACmB,UAAU,CAACzB,IAAI,CAAC;QAC3B,CAAC,MAAM;UACHD,OAAO,GAAGgB,GAAG,CAACC,eAAe,CAAChB,IAAI,CAAC;UACnCiB,KAAK,CAAClB,OAAO,CAAC;QAClB;MACJ,CAAC;MACDI,GAAG,CAACb,OAAO,GAAGoC,QAAQ;MACtBvB,GAAG,CAACtB,IAAI,CAAC,KAAK,EAAEZ,GAAG,EAAE,IAAI,CAAC;MAC1BkC,GAAG,CAACrB,YAAY,GAAG,MAAM;MACzBqB,GAAG,CAACZ,IAAI,CAAC,CAAC;IACd,CAAC,MAAM;MACH0B,KAAK,CAAChD,GAAG,CAAC;IACd;EACJ;EAEA,SAASgD,KAAKA,CAAChD,GAAG,EAAE;IAChB6B,GAAG,CAAC6B,GAAG,GAAG1D,GAAG;IACb,IAAI6B,GAAG,CAAC8B,QAAQ,IAAI,CAACpK,OAAO,CAAC4G,IAAI,EAAE;MAC/B;MACA;MACAyD,OAAO,CAAC/E,IAAI,CAACgD,GAAG,CAAC;IACrB,CAAC,MAAM;MACHA,GAAG,CAACf,MAAM,GAAG8C,OAAO;MACpB/B,GAAG,CAACR,OAAO,GAAGoC,QAAQ;IAC1B;EACJ;EAEA,SAASI,UAAUA,CAAA,EAAG;IAClB,IAAI,CAACjC,IAAI,EAAE;MACPA,IAAI,GAAG;QAAEsB,KAAK,EAAErB,GAAG,CAACqB,KAAK;QAAEC,MAAM,EAAEtB,GAAG,CAACsB;MAAO,CAAC;IACnD;IAEA,IAAIW,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IAC7CF,MAAM,CAACZ,KAAK,GAAGtB,IAAI,CAACsB,KAAK;IACzBY,MAAM,CAACX,MAAM,GAAGvB,IAAI,CAACuB,MAAM;IAE3B,IAAIc,GAAG,GAAGH,MAAM,CAACI,UAAU,CAAC,IAAI,CAAC;IACjCD,GAAG,CAACE,SAAS,CAACtC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAED,IAAI,CAACsB,KAAK,EAAEtB,IAAI,CAACuB,MAAM,CAAC;IAEjD,IAAIiB,OAAO;IACX,IAAI;MACAA,OAAO,GAAGH,GAAG,CAACI,YAAY,CAAC,CAAC,EAAE,CAAC,EAAEzC,IAAI,CAACsB,KAAK,EAAEtB,IAAI,CAACuB,MAAM,CAAC;IAC7D,CAAC,CAAC,OAAOmB,EAAE,EAAE;MACT;MACAb,QAAQ,CAAC,CAAC;MACV;IACJ,CAAC,SAAS;MACN,IAAI3B,OAAO,EAAE;QACTgB,GAAG,CAACyB,eAAe,CAACzC,OAAO,CAAC;MAChC;IACJ;;IAEA;IACA;IACA;IACA;IACA;IACA;;IAEA,IAAI0C,QAAQ,GAAG,KAAK;MAAEC,GAAG,GAAG7L,YAAY,CAAC,CAAC;MAAE8L,KAAK,GAAG9L,YAAY,CAAC,CAAC;IAClE,IAAI+L,QAAQ,GAAGP,OAAO,CAACtG,IAAI;IAC3B,IAAIzB,CAAC,GAAG,CAAC;IACT,OAAOA,CAAC,GAAGsI,QAAQ,CAACpI,MAAM,EAAE;MACxBkI,GAAG,CAACG,SAAS,CAACD,QAAQ,CAACtI,CAAC,EAAE,CAAC,CAAC;MAC5BoI,GAAG,CAACG,SAAS,CAACD,QAAQ,CAACtI,CAAC,EAAE,CAAC,CAAC;MAC5BoI,GAAG,CAACG,SAAS,CAACD,QAAQ,CAACtI,CAAC,EAAE,CAAC,CAAC;MAC5B,IAAIwI,CAAC,GAAGF,QAAQ,CAACtI,CAAC,EAAE,CAAC;MACrB,IAAIwI,CAAC,GAAG,GAAG,EAAE;QACTL,QAAQ,GAAG,IAAI;MACnB;MACAE,KAAK,CAACE,SAAS,CAACC,CAAC,CAAC;IACtB;IAEA,IAAIL,QAAQ,IAAIxF,OAAO,CAAC8F,OAAO,EAAE;MAC7BjD,GAAG,GAAG,IAAIkD,WAAW,CAACnD,IAAI,CAACsB,KAAK,EAAEtB,IAAI,CAACuB,MAAM,EAAEsB,GAAG,EAAEC,KAAK,CAAC;IAC9D,CAAC,MAAM;MACH;MACA,IAAI5G,IAAI,GAAGgG,MAAM,CAACkB,SAAS,CAAC,YAAY,EAAEhG,OAAO,CAACiG,WAAW,CAAC;MAC9DnH,IAAI,GAAGA,IAAI,CAACuC,MAAM,CAACvC,IAAI,CAACT,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;MAEhD,IAAIiB,MAAM,GAAG1F,YAAY,CAAC,CAAC;MAC3B0F,MAAM,CAAC4G,WAAW,CAACpH,IAAI,CAAC;MACxB+D,GAAG,GAAG,IAAIsD,YAAY,CAAC7G,MAAM,CAAC;IAClC;IAEA2B,IAAI,CAACwB,WAAW,CAACzB,GAAG,CAAC,GAAG6B,GAAG,CAAC;EAChC;EAEA,SAAS4B,QAAQA,CAAA,EAAG;IAChBxD,IAAI,CAACwB,WAAW,CAACzB,GAAG,CAAC,GAAG,OAAO,CAAC;EACpC;EAEA,SAAS4D,OAAOA,CAAA,EAAG;IACf,IAAIhC,IAAI,EAAE;MACN,MAAMe,GAAG,GAAIZ,IAAI,IAAIA,IAAI,CAACK,IAAI,KAAK,eAAe,IAChD,yBAAyB,CAAC5E,IAAI,CAAC,IAAI,CAACkG,GAAG,CAAC0B,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CACzD;MAED,MAAMC,OAAO,GAAGzD,IAAI,CAACsB,KAAK,IAAIrB,GAAG,CAACqB,KAAK,IAAItB,IAAI,CAACuB,MAAM,IAAItB,GAAG,CAACsB,MAAM;;MAEpE;MACA;MACA,IAAI,CAACR,GAAG,IAAI0C,OAAO,EAAE;QACjBzD,IAAI,GAAG,IAAI;MACf;IACJ;IACA,IAAI,CAACA,IAAI,IAAIG,IAAI,IAAI,iBAAiB,CAACvE,IAAI,CAACuE,IAAI,CAACK,IAAI,CAAC,EAAE;MACpD;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,IAAIC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;MAC7BD,MAAM,CAACvB,MAAM,GAAG,YAAW;QACvB,IAAI;UACA,IAAIe,GAAG,GAAG,IAAIsD,YAAY,CAACvM,YAAY,CAAC,IAAIoI,UAAU,CAAC,IAAI,CAAC0B,MAAM,CAAC,CAAC,CAAC;UACrEI,GAAG,CAACyB,eAAe,CAACzC,OAAO,CAAC;UAC5B7B,IAAI,CAACwB,WAAW,CAACzB,GAAG,CAAC,GAAG6B,GAAG,CAAC;QAChC,CAAC,CAAC,OAAOyC,EAAE,EAAE;UACT;UACA;UACA;UACA;UACAT,UAAU,CAAC,CAAC;QAChB;MACJ,CAAC;MACDxB,MAAM,CAACiD,iBAAiB,CAACvD,IAAI,CAAC;IAClC,CAAC,MAAM;MACH8B,UAAU,CAAC,CAAC;IAChB;EACJ;AACJ;AAEA,SAAS0B,UAAUA,CAACC,OAAO,EAAE;EACzB,OAAO,UAASC,IAAI,EAAEC,QAAQ,EAAE;IAC5B,IAAIC,CAAC,GAAGF,IAAI,CAAClJ,MAAM;MAAEF,CAAC,GAAGsJ,CAAC;IAC1B,IAAIA,CAAC,KAAK,CAAC,EAAE;MACT,OAAOD,QAAQ,CAAC,CAAC;IACrB;IACA,SAASE,IAAIA,CAAA,EAAG;MACZ,IAAI,EAAED,CAAC,KAAK,CAAC,EAAE;QACXD,QAAQ,CAAC,CAAC;MACd;IACJ;IACA,OAAOrJ,CAAC,EAAE,GAAG,CAAC,EAAE;MACZmJ,OAAO,CAACC,IAAI,CAACpJ,CAAC,CAAC,EAAEuJ,IAAI,CAAC;IAC1B;EACJ,CAAC;AACL;AAEA,IAAIC,SAAS,GAAGN,UAAU,CAAChE,QAAQ,CAAC;AACpC,IAAIuE,UAAU,GAAG,SAAAA,CAASC,MAAM,EAAEL,QAAQ,EAAE1G,OAAO,EAAE;EACjDA,OAAO,GAAGgH,MAAM,CAACC,MAAM,CAAC;IACpBhB,WAAW,EAAG,IAAI;IAClBH,OAAO,EAAO;EAClB,CAAC,EAAE9F,OAAO,CAAC;EACX,IAAIyG,IAAI,GAAGO,MAAM,CAACE,IAAI,CAACH,MAAM,CAAC;IAAEJ,CAAC,GAAGF,IAAI,CAAClJ,MAAM;EAC/C,IAAIoJ,CAAC,KAAK,CAAC,EAAE;IACT,OAAOD,QAAQ,CAAC,CAAC;EACrB;EACA,SAASE,IAAIA,CAAA,EAAG;IACZ,IAAI,EAAED,CAAC,KAAK,CAAC,EAAE;MACXD,QAAQ,CAAC,CAAC;IACd;EACJ;EACAD,IAAI,CAACU,OAAO,CAAC,UAASnG,GAAG,EAAC;IACtB2B,SAAS,CAAC3B,GAAG,EAAE+F,MAAM,CAAC/F,GAAG,CAAC,EAAE4F,IAAI,EAAE5G,OAAO,CAAC;EAC9C,CAAC,CAAC;AACN,CAAC;AAED,MAAMoH,WAAW,CAAC;EACdC,WAAWA,CAAErH,OAAO,EAAE;IAClB,IAAIsH,IAAI,GAAG,IAAI;IACf,IAAIlK,GAAG,GAAGH,UAAU,CAAC,CAAC;IACtB,IAAIsK,QAAQ,GAAG,CAAC;IAChB,IAAIC,OAAO,GAAG,EAAE;IAEhB,SAASzH,SAASA,CAAC0H,IAAI,EAAEC,MAAM,EAAE;MAC7B,OAAQ1H,OAAO,IAAIA,OAAO,CAACyH,IAAI,CAAC,IAAI,IAAI,GAAIzH,OAAO,CAACyH,IAAI,CAAC,GAAGC,MAAM;IACtE;IAEAJ,IAAI,CAACvH,SAAS,GAAGA,SAAS;IAE1BuH,IAAI,CAACK,MAAM,GAAG,UAASnI,KAAK,EAAE;MAC1B,IAAIgI,OAAO,CAACnJ,OAAO,CAACmB,KAAK,CAAC,GAAG,CAAC,EAAE;QAC5BD,UAAU,CAACC,KAAK,EAAE,EAAE+H,QAAQ,CAAC;QAC7BC,OAAO,CAACI,IAAI,CAACpI,KAAK,CAAC;MACvB;MACA,OAAOA,KAAK;IAChB,CAAC;IAED8H,IAAI,CAACO,KAAK,GAAG,EAAE;IAEfP,IAAI,CAACQ,KAAK,GAAG,CAAC,CAAC;IACfR,IAAI,CAACS,MAAM,GAAG,CAAC,CAAC;IAChBT,IAAI,CAACU,kBAAkB,GAAG,CAAC,CAAC,CAAC,CAAC;IAC9BV,IAAI,CAACW,kBAAkB,GAAG,CAAC,CAAC,CAAC,CAAC;IAC9BX,IAAI,CAACY,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAK;IACxBZ,IAAI,CAACa,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAK;;IAExB,IAAIC,OAAO,GAAGd,IAAI,CAACK,MAAM,CAAC,IAAIU,UAAU,CAAC,CAAC,CAAC;IAC3C,IAAIC,QAAQ,GAAGhB,IAAI,CAACK,MAAM,CAAC,IAAIY,WAAW,CAAC,CAAC,CAAC;IAE7C,IAAIxI,SAAS,CAAC,WAAW,CAAC,EAAE;MACxB,IAAIyI,QAAQ,GAAG,CAAC,CAAC;MACjBA,QAAQ,CAACC,UAAU,GAAG,IAAI7J,aAAa,CAAC;QAAE8J,KAAK,EAAE,CAC7C,IAAIC,SAAS,CAAC,IAAI,CAAC,EAAErB,IAAI,CAACK,MAAM,CAAC,IAAI/I,aAAa,CAAC;UAC/CgK,CAAC,EAAEC,CAAC,CAAC,YAAY,CAAC;UAClBC,EAAE,EAAE,IAAIH,SAAS,CAAC,cAAc;QACpC,CAAC,CAAC,CAAC;MACL,CAAC,CAAC;MACJP,OAAO,CAACW,KAAK,CAACL,KAAK,GAAG,IAAI9J,aAAa,CAAC4J,QAAQ,CAAC;IACrD;IAEAJ,OAAO,CAACY,QAAQ,CAACV,QAAQ,CAAC;IAE1B,IAAIW,IAAI,GAAG3B,IAAI,CAACK,MAAM,CAAC,IAAI/I,aAAa,CAAC;MACrCsK,QAAQ,EAAO,IAAIP,SAAS,CAAC5I,SAAS,CAAC,UAAU,EAAE,wBAAwB,CAAC,EAAE,IAAI,CAAC;MAAE;MACrFoJ,KAAK,EAAU,IAAIR,SAAS,CAAC5I,SAAS,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC;MAC1DqJ,MAAM,EAAS,IAAIT,SAAS,CAAC5I,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC;MAC3DsJ,OAAO,EAAQ,IAAIV,SAAS,CAAC5I,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC;MAC5DuJ,QAAQ,EAAO,IAAIX,SAAS,CAAC5I,SAAS,CAAC,UAAU,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC;MAC7DwJ,OAAO,EAAQ,IAAIZ,SAAS,CAAC5I,SAAS,CAAC,SAAS,EAAE,wBAAwB,CAAC,EAAE,IAAI,CAAC;MAClFyJ,YAAY,EAAGzJ,SAAS,CAAC,MAAM,EAAE,IAAI0J,IAAI,CAAC,CAAC;IAC/C,CAAC,CAAC,CAAC;IAEHnC,IAAI,CAACoC,OAAO,GAAG,UAAS1J,OAAO,EAAE;MAC7B,IAAI2J,YAAY,GAAI7J,eAAe,CAAC,UAAS2H,IAAI,EAAEC,MAAM,EAAC;QACtD,OAAQ1H,OAAO,IAAIA,OAAO,CAACyH,IAAI,CAAC,IAAI,IAAI,GAAIzH,OAAO,CAACyH,IAAI,CAAC,GAAGC,MAAM;MACtE,CAAC,CAAC;MACF,IAAIvH,SAAS,GAAOwJ,YAAY,CAACxJ,SAAS;MAC1C,IAAIM,MAAM,GAAUkJ,YAAY,CAAClJ,MAAM;MACvC,IAAImJ,YAAY,GAAIzJ,SAAS,CAAC,CAAC,CAAC;MAChC,IAAI0J,aAAa,GAAG1J,SAAS,CAAC,CAAC,CAAC;MAChC,IAAIM,MAAM,EAAE;QACRmJ,YAAY,IAAInJ,MAAM,CAACC,IAAI,GAAGD,MAAM,CAACG,KAAK;QAC1CiJ,aAAa,IAAIpJ,MAAM,CAACE,GAAG,GAAGF,MAAM,CAACI,MAAM;MAC/C;MACA,IAAIiJ,OAAO,GAAG,IAAIC,SAAS,CAAC9M,UAAU,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC;MACrD,IAAI8L,KAAK,GAAG;QACRiB,QAAQ,EAAG1C,IAAI,CAACK,MAAM,CAACmC,OAAO,CAAC;QAC/BG,MAAM,EAAK3B,QAAQ;QACnB4B,QAAQ,EAAG,CAAE,CAAC,EAAE,CAAC,EAAE/J,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC;MACjD,CAAC;MACD,IAAIgK,IAAI,GAAG,IAAIC,OAAO,CAAC9C,IAAI,EAAEyB,KAAK,CAAC;MACnCoB,IAAI,CAACE,QAAQ,GAAGP,OAAO;MACvBxB,QAAQ,CAACoB,OAAO,CAACpC,IAAI,CAACK,MAAM,CAACwC,IAAI,CAAC,CAAC;;MAEnC;MACA;MACAA,IAAI,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAEnK,SAAS,CAAC,CAAC,CAAC,CAAC;MAE5C,IAAIM,MAAM,EAAE;QACR0J,IAAI,CAACI,SAAS,CAAC9J,MAAM,CAACC,IAAI,EAAED,MAAM,CAACE,GAAG,CAAC;QACvC;QACAwJ,IAAI,CAACK,IAAI,CAAC,CAAC,EAAE,CAAC,EAAEZ,YAAY,EAAEC,aAAa,CAAC;QAC5CM,IAAI,CAACM,IAAI,CAAC,CAAC;MACf;MAEAnD,IAAI,CAACO,KAAK,CAACD,IAAI,CAACuC,IAAI,CAAC;MACrB,OAAOA,IAAI;IACf,CAAC;IAED7C,IAAI,CAACzJ,MAAM,GAAG,YAAW;MACrB,IAAIR,CAAC;MACL;MACAD,GAAG,CAAC,UAAU,EAAE5C,EAAE,EAAE,uBAAuB,EAAEA,EAAE,EAAEA,EAAE,CAAC;;MAEpD;MACA,KAAK6C,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmK,OAAO,CAACjK,MAAM,EAAE,EAAEF,CAAC,EAAE;QACjCmK,OAAO,CAACnK,CAAC,CAAC,CAACsC,UAAU,CAACvC,GAAG,CAAC;QAC1BA,GAAG,CAAC5C,EAAE,EAAEA,EAAE,CAAC;MACf;;MAEA;MACA,IAAIkQ,UAAU,GAAGtN,GAAG,CAACgC,MAAM,CAAC,CAAC;MAC7BhC,GAAG,CAAC,MAAM,EAAE5C,EAAE,EAAE,CAAC,EAAE,GAAG,EAAEgN,OAAO,CAACjK,MAAM,GAAG,CAAC,EAAE/C,EAAE,CAAC;MAC/C4C,GAAG,CAAC,qBAAqB,EAAE5C,EAAE,CAAC;MAC9B,KAAK6C,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmK,OAAO,CAACjK,MAAM,EAAE,EAAEF,CAAC,EAAE;QACjCD,GAAG,CAACuN,OAAO,CAACnD,OAAO,CAACnK,CAAC,CAAC,CAACuC,OAAO,EAAE,EAAE,CAAC,EAAE,WAAW,EAAEpF,EAAE,CAAC;MACzD;MACA4C,GAAG,CAAC5C,EAAE,CAAC;;MAEP;MACA4C,GAAG,CAAC,SAAS,EAAE5C,EAAE,CAAC;MAClB4C,GAAG,CAAC,IAAIwB,aAAa,CAAC;QAClBgM,IAAI,EAAEpD,OAAO,CAACjK,MAAM,GAAG,CAAC;QACxBsN,IAAI,EAAEzC,OAAO;QACb0C,IAAI,EAAE7B;MACV,CAAC,CAAC,EAAEzO,EAAE,EAAEA,EAAE,CAAC;;MAEX;MACA4C,GAAG,CAAC,WAAW,EAAE5C,EAAE,EAAEkQ,UAAU,EAAElQ,EAAE,CAAC;MACpC4C,GAAG,CAAC,OAAO,EAAE5C,EAAE,CAAC;MAEhB,OAAO4C,GAAG,CAACkC,MAAM,CAAC,CAAC,CAACF,MAAM,CAAC,CAAC,CAAC;IACjC,CAAC;IAEDkI,IAAI,CAACT,SAAS,GAAGA,SAAS;IAC1BS,IAAI,CAACR,UAAU,GAAGA,UAAU;EAChC;EAEAiE,OAAOA,CAAC/J,GAAG,EAAE;IACT,IAAIwB,IAAI,GAAG,IAAI,CAACsF,KAAK,CAAC9G,GAAG,CAAC;IAC1B,IAAI,CAACwB,IAAI,EAAE;MACPA,IAAI,GAAG1B,UAAU,CAACE,GAAG,CAAC;MACtB,IAAI,CAACwB,IAAI,EAAE;QACP,MAAM,IAAI9E,KAAK,CAAC,OAAO,GAAGsD,GAAG,GAAG,sBAAsB,CAAC;MAC3D;MACA,IAAIwB,IAAI,KAAK,IAAI,EAAE;QACfA,IAAI,GAAG,IAAI,CAACmF,MAAM,CAAC,IAAIqD,eAAe,CAAChK,GAAG,CAAC,CAAC;MAChD,CAAC,MAAM;QACHwB,IAAI,GAAG,IAAI,CAACmF,MAAM,CAAC,IAAIsD,OAAO,CAAC,IAAI,EAAEzI,IAAI,CAAC,CAAC;MAC/C;MACA,IAAI,CAACsF,KAAK,CAAC9G,GAAG,CAAC,GAAGwB,IAAI;IAC1B;IACA,OAAOA,IAAI;EACf;EAEA0I,QAAQA,CAAClK,GAAG,EAAE;IACV,IAAI6B,GAAG,GAAG,IAAI,CAACkF,MAAM,CAAC/G,GAAG,CAAC;IAC1B,IAAI,CAAC6B,GAAG,EAAE;MACNA,GAAG,GAAGJ,WAAW,CAACzB,GAAG,CAAC;MACtB,IAAI,CAAC6B,GAAG,EAAE;QACN,MAAM,IAAInF,KAAK,CAAC,QAAQ,GAAGsD,GAAG,GAAG,sBAAsB,CAAC;MAC5D;MACA,IAAI6B,GAAG,KAAK,OAAO,EAAE;QACjB,OAAO,IAAI;MACf;MACAA,GAAG,GAAG,IAAI,CAACkF,MAAM,CAAC/G,GAAG,CAAC,GAAG,IAAI,CAAC2G,MAAM,CAAC9E,GAAG,CAACsI,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC5D;IACA,OAAOtI,GAAG;EACd;EAEAuI,YAAYA,CAACC,OAAO,EAAEC,SAAS,EAAE;IAC7B,IAAI7L,EAAE,GAAG8L,UAAU,CAACF,OAAO,CAAC,CAACjN,OAAO,CAAC,CAAC,CAAC;IACvCiN,OAAO,GAAGE,UAAU,CAAC9L,EAAE,CAAC;IACxBA,EAAE,IAAI6L,SAAS,GAAG,GAAG,GAAG,GAAG;IAC3B,IAAIE,KAAK,GAAG,IAAI,CAACC,eAAe,KAAK,IAAI,CAACA,eAAe,GAAG,CAAC,CAAC,CAAC;IAC/D,IAAIC,EAAE,GAAGF,KAAK,CAAC/L,EAAE,CAAC;IAClB,IAAI,CAACiM,EAAE,EAAE;MACL,IAAI3C,KAAK,GAAG;QACR4C,IAAI,EAAE9C,CAAC,CAAC,WAAW;MACvB,CAAC;MACD,IAAIyC,SAAS,EAAE;QACXvC,KAAK,CAAC6C,EAAE,GAAGP,OAAO;MACtB,CAAC,MAAM;QACHtC,KAAK,CAAC8C,EAAE,GAAGR,OAAO;MACtB;MACAK,EAAE,GAAG,IAAI,CAAC/D,MAAM,CAAC,IAAI/I,aAAa,CAACmK,KAAK,CAAC,CAAC;MAC1C2C,EAAE,CAACI,aAAa,GAAGjD,CAAC,CAAC,IAAI,GAAI,EAAEpO,gBAAiB,CAAC;MACjD+Q,KAAK,CAAC/L,EAAE,CAAC,GAAGiM,EAAE;IAClB;IACA,OAAOA,EAAE;EACb;EAEAK,IAAIA,CAAChD,KAAK,EAAE;IACR,OAAO,IAAInK,aAAa,CAACmK,KAAK,CAAC;EACnC;EAEAtB,IAAIA,CAACuE,GAAG,EAAE;IACN,OAAOnD,CAAC,CAACmD,GAAG,CAAC;EACjB;EAEA1M,MAAMA,CAACyJ,KAAK,EAAEe,OAAO,EAAE;IACnB,OAAO,IAAIC,SAAS,CAACD,OAAO,EAAEf,KAAK,CAAC;EACxC;AACJ;;AAEA;;AAEA,SAAS7J,GAAGA,CAAC8M,GAAG,EAAEC,GAAG,EAAEC,EAAE,EAAE;EACvB,OAAOF,GAAG,CAACzO,MAAM,GAAG0O,GAAG,EAAE;IACrBD,GAAG,GAAGE,EAAE,GAAGF,GAAG;EAClB;EACA,OAAOA,GAAG;AACd;AAEA,SAASrB,OAAOA,CAAChE,CAAC,EAAEsF,GAAG,EAAE;EACrB,OAAO/M,GAAG,CAACT,MAAM,CAACkI,CAAC,CAAC,EAAEsF,GAAG,EAAE,GAAG,CAAC;AACnC;AAEA,SAASE,cAAcA,CAACC,GAAG,EAAEnM,GAAG,EAAE;EAC9B,OAAO+G,MAAM,CAACqF,SAAS,CAACF,cAAc,CAACtM,IAAI,CAACuM,GAAG,EAAEnM,GAAG,CAAC;AACzD;AAEA,IAAInC,OAAO,GAAGwO,KAAK,CAACxO,OAAO,IAAI,UAASsO,GAAG,EAAE;EACzC,OAAOA,GAAG,YAAYE,KAAK;AAC/B,CAAC;AAED,SAAStO,MAAMA,CAACoO,GAAG,EAAE;EACjB,OAAOA,GAAG,YAAY3C,IAAI;AAC9B;AAEA,SAAS1L,WAAWA,CAAC8H,CAAC,EAAEzI,GAAG,EAAE;EACzBA,GAAG,CAAC,GAAG,CAAC;EACR,IAAIyI,CAAC,CAACtI,MAAM,GAAG,CAAC,EAAE;IACdH,GAAG,CAAC2B,UAAU,CAAC,YAAU;MACrB,KAAK,IAAI1B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGwI,CAAC,CAACtI,MAAM,EAAE,EAAEF,CAAC,EAAE;QAC/B,IAAIA,CAAC,GAAG,CAAC,IAAIA,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;UACtBD,GAAG,CAAC6B,MAAM,CAAC4G,CAAC,CAACxI,CAAC,CAAC,CAAC;QACpB,CAAC,MAAM;UACHD,GAAG,CAAC,GAAG,EAAEyI,CAAC,CAACxI,CAAC,CAAC,CAAC;QAClB;MACJ;IACJ,CAAC,CAAC;IACF;EACJ;;EACAD,GAAG,CAAC,IAAI,CAAC;AACb;AAEA,SAASa,UAAUA,CAACsO,IAAI,EAAEnP,GAAG,EAAE;EAC3BA,GAAG,CAAC,KAAK,EACLuN,OAAO,CAAC4B,IAAI,CAACC,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,EACjC7B,OAAO,CAAC4B,IAAI,CAACE,WAAW,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAClC9B,OAAO,CAAC4B,IAAI,CAACG,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC,EAC7B/B,OAAO,CAAC4B,IAAI,CAACI,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,EAC9BhC,OAAO,CAAC4B,IAAI,CAACK,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,EAChCjC,OAAO,CAAC4B,IAAI,CAACM,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,EAChC,IAAI,CAAC;AACb;AAEA,SAASC,KAAKA,CAACC,EAAE,EAAE;EACf,OAAOA,EAAE,IAAI,EAAE,GAAC,IAAI,CAAC;AACzB;AAEA,SAASC,KAAKA,CAACC,EAAE,EAAE;EACf,OAAOH,KAAK,CAACG,EAAE,GAAG,EAAE,CAAC;AACzB;AAEA,SAASC,KAAKA,CAACC,IAAI,EAAG;EAClB,OAAOA,IAAI,GAAG,EAAE;AACpB;AAGA,SAAS9M,aAAaA,CAAC7C,CAAC,EAAE0C,GAAG,EAAE;EAC3B,IAAI,OAAO1C,CAAC,IAAI,QAAQ,EAAE;IACtB,OAAOA,CAAC;EACZ;EACA,IAAI,OAAOA,CAAC,IAAI,QAAQ,EAAE;IACtB,IAAI0D,CAAC;IACLA,CAAC,GAAG,mCAAmC,CAACE,IAAI,CAAC5D,CAAC,CAAC;IAC/C,IAAI0D,CAAC,EAAE;MACH,IAAI/C,GAAG,GAAGoN,UAAU,CAACrK,CAAC,CAAC,CAAC,CAAC,CAAC;MAC1B,IAAI,CAAChD,KAAK,CAACC,GAAG,CAAC,EAAE;QACb,IAAI+C,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE;UACd,OAAO/C,GAAG;QACd;QACA,OAAO;UACH,IAAI,EAAE2O,KAAK;UACX,IAAI,EAAEE,KAAK;UACX,IAAI,EAAEE;QACV,CAAC,CAAChM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC/C,GAAG,CAAC;MAChB;IACJ;EACJ;EACA,IAAI+B,GAAG,IAAI,IAAI,EAAE;IACb,OAAOA,GAAG;EACd;EACA,MAAM,IAAIxC,KAAK,CAAC,oBAAoB,GAAGF,CAAC,CAAC;AAC7C;;AAEA;;AAEA,MAAMG,QAAQ,CAAC;EACXC,YAAYA,CAAA,EAAG,CAAC;AACpB;AAEA,MAAM+K,SAAS,SAAShL,QAAQ,CAAC;EAC7B0J,WAAWA,CAAC7H,KAAK,EAAE4N,OAAO,EAAE;IACxB,KAAK,CAAC,CAAC;IACP,IAAI,CAAC5N,KAAK,GAAGA,KAAK;IAClB,IAAI,CAAC4N,OAAO,GAAGC,OAAO,CAACD,OAAO,CAAC;EACnC;EAEAvP,MAAMA,CAACT,GAAG,EAAE;IACR,IAAIkQ,GAAG,GAAG,IAAI,CAAC9N,KAAK;IACpB,IAAI,IAAI,CAAC4N,OAAO,EAAE;MACdE,GAAG,GAAGjT,GAAG,GAAGD,aAAa,CAACkT,GAAG,CAAC;MAC9BA,GAAG,GAAGA,GAAG,CAAChP,OAAO,CAAC,aAAa,EAAE,MAAM,CAAC;MACxClB,GAAG,CAAC,GAAG,EAAEkQ,GAAG,EAAE,GAAG,CAAC;IACtB,CAAC,MAAM;MACH;MACA;MACA;MACA;MACA,IAAIxO,IAAI,GAAG,CAAE,EAAE,CAAE,CAAC,CAAC;MACnB,KAAK,IAAIzB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGiQ,GAAG,CAAC/P,MAAM,EAAE,EAAEF,CAAC,EAAE;QACjC,IAAIkQ,IAAI,GAAGD,GAAG,CAACE,UAAU,CAACnQ,CAAC,CAAC,GAAG,IAAI;QACnC,IAAIkQ,IAAI,IAAI,EAAE,IAAIA,IAAI,IAAI,EAAE,IAAIA,IAAI,IAAI,EAAE,EAAE;UACxC;UACAzO,IAAI,CAAC8I,IAAI,CAAC,EAAE,CAAC;QACjB;QACA9I,IAAI,CAAC8I,IAAI,CAAC2F,IAAI,CAAC;MACnB;MACAzO,IAAI,CAAC8I,IAAI,CAAC,EAAE,CAAC,CAAC,CAAE;MAChBxK,GAAG,CAACyB,SAAS,CAACC,IAAI,CAAC;IACvB;EACJ;EAEAO,QAAQA,CAAA,EAAG;IACP,OAAO,IAAI,CAACG,KAAK;EACrB;AACJ;AAEA,MAAMiO,YAAY,SAAS9E,SAAS,CAAC;EACjCtB,WAAWA,CAAC7H,KAAK,EAAE;IACf,KAAK,CAACA,KAAK,CAAC;IACZ,IAAI,CAACA,KAAK,GAAGA,KAAK;EACtB;EAEA3B,MAAMA,CAACT,GAAG,EAAE;IACRA,GAAG,CAAC,GAAG,CAAC;IACR,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACmC,KAAK,CAACjC,MAAM,EAAE,EAAEF,CAAC,EAAE;MACxCD,GAAG,CAACuN,OAAO,CAAC,IAAI,CAACnL,KAAK,CAACgO,UAAU,CAACnQ,CAAC,CAAC,CAACgC,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IAC1D;IACAjC,GAAG,CAAC,GAAG,CAAC;EACZ;AACJ;;AAEA;AACA,MAAMsQ,OAAO,SAAS/P,QAAQ,CAAC;EAC3B,OAAOe,GAAGA,CAAC+I,IAAI,EAAE;IACb,OAAOoB,CAAC,CAACpB,IAAI,CAAC;EAClB;EAEAJ,WAAWA,CAACI,IAAI,EAAE;IACd,KAAK,CAAC,CAAC;IACP,IAAI,CAACA,IAAI,GAAGA,IAAI;EACpB;EAEA5J,MAAMA,CAACT,GAAG,EAAE;IACRA,GAAG,CAAC,GAAG,GAAG,IAAI,CAACuQ,MAAM,CAAC,CAAC,CAAC;EAC5B;EAEAA,MAAMA,CAAA,EAAG;IACL,OAAO,IAAI,CAAClG,IAAI,CAACnJ,OAAO,CAAC,eAAe,EAAE,UAASsP,CAAC,EAAC;MACjD,OAAO,GAAG,GAAGjD,OAAO,CAACiD,CAAC,CAACJ,UAAU,CAAC,CAAC,CAAC,CAACnO,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACzD,CAAC,CAAC;EACN;EAEAA,QAAQA,CAAA,EAAG;IACP,OAAO,IAAI,CAACoI,IAAI;EACpB;AACJ;AAEA,IAAIoG,aAAa,GAAG,CAAC,CAAC;AAEtB,SAAShF,CAACA,CAACpB,IAAI,EAAE;EACb,IAAI0E,cAAc,CAAC0B,aAAa,EAAEpG,IAAI,CAAC,EAAE;IACrC,OAAOoG,aAAa,CAACpG,IAAI,CAAC;EAC9B;EACA,OAAQoG,aAAa,CAACpG,IAAI,CAAC,GAAG,IAAIiG,OAAO,CAACjG,IAAI,CAAC;AACnD;;AAEA;;AAEA,MAAM7I,aAAa,SAASjB,QAAQ,CAAC;EACjC0J,WAAWA,CAAC0B,KAAK,EAAE;IACf,KAAK,CAAC,CAAC;IACP,IAAI,CAACA,KAAK,GAAGA,KAAK;EACtB;EAEAlL,MAAMA,CAACT,GAAG,EAAE;IACR,IAAI2L,KAAK,GAAG,IAAI,CAACA,KAAK;MAAE+E,KAAK,GAAG,IAAI;IACpC1Q,GAAG,CAAC,IAAI,CAAC;IACTA,GAAG,CAAC2B,UAAU,CAAC,YAAU;MACrB,KAAK,IAAI1B,CAAC,IAAI0L,KAAK,EAAE;QACjB,IAAIoD,cAAc,CAACpD,KAAK,EAAE1L,CAAC,CAAC,IAAI,CAAC,IAAI,CAACmB,IAAI,CAACnB,CAAC,CAAC,EAAE;UAC3CyQ,KAAK,GAAG,KAAK;UACb1Q,GAAG,CAAC6B,MAAM,CAAC4J,CAAC,CAACxL,CAAC,CAAC,EAAE,GAAG,EAAE0L,KAAK,CAAC1L,CAAC,CAAC,CAAC;QACnC;MACJ;IACJ,CAAC,CAAC;IACF,IAAI,CAACyQ,KAAK,EAAE;MACR1Q,GAAG,CAAC6B,MAAM,CAAC,CAAC;IAChB;IACA7B,GAAG,CAAC,IAAI,CAAC;EACb;AACJ;;AAEA;;AAEA,MAAM2M,SAAS,SAASpM,QAAQ,CAAC;EAC7B0J,WAAWA,CAACvI,IAAI,EAAEiK,KAAK,EAAEgF,QAAQ,EAAE;IAC/B,KAAK,CAAC,CAAC;IACP,IAAI,OAAOjP,IAAI,IAAI,QAAQ,EAAE;MACzB,IAAIkP,GAAG,GAAGpU,YAAY,CAAC,CAAC;MACxBoU,GAAG,CAACrP,KAAK,CAACG,IAAI,CAAC;MACfA,IAAI,GAAGkP,GAAG;IACd;IACA,IAAI,CAAClP,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACiK,KAAK,GAAGA,KAAK,IAAI,CAAC,CAAC;IACxB,IAAI,CAACgF,QAAQ,GAAGA,QAAQ;EAC5B;EAEAlQ,MAAMA,CAACT,GAAG,EAAE;IACR,IAAI0B,IAAI,GAAG,IAAI,CAACA,IAAI,CAACJ,GAAG,CAAC,CAAC;MAAEqK,KAAK,GAAG,IAAI,CAACA,KAAK;IAC9C,IAAI,IAAI,CAACgF,QAAQ,IAAI5T,eAAe,CAAC,CAAC,EAAE;MACpC,IAAI,CAAC4O,KAAK,CAACkF,MAAM,EAAE;QACflF,KAAK,CAACkF,MAAM,GAAG,EAAE;MACrB,CAAC,MAAM,IAAI,EAAElF,KAAK,CAACkF,MAAM,YAAY3B,KAAK,CAAC,EAAE;QACzCvD,KAAK,CAACkF,MAAM,GAAG,CAAElF,KAAK,CAACkF,MAAM,CAAE;MACnC;MACAlF,KAAK,CAACkF,MAAM,CAACC,OAAO,CAACrF,CAAC,CAAC,aAAa,CAAC,CAAC;MACtC/J,IAAI,GAAG5E,OAAO,CAAC4E,IAAI,CAAC;IACxB;IACAiK,KAAK,CAACoF,MAAM,GAAGrP,IAAI,CAACvB,MAAM;IAC1BH,GAAG,CAAC,IAAIwB,aAAa,CAACmK,KAAK,CAAC,EAAE,SAAS,EAAEvO,EAAE,CAAC;IAC5C4C,GAAG,CAACyB,SAAS,CAACC,IAAI,CAAC;IACnB1B,GAAG,CAAC5C,EAAE,EAAE,WAAW,CAAC;EACxB;AACJ;;AAEA;;AAEA,MAAM6N,UAAU,SAASzJ,aAAa,CAAC;EACnCyI,WAAWA,CAAA,EAAG;IACV,KAAK,CAAC;MACFsE,IAAI,EAAE9C,CAAC,CAAC,SAAS;IACrB,CAAC,CAAC;EACN;EAEAG,QAAQA,CAACoF,QAAQ,EAAE;IACf,IAAI,CAACrF,KAAK,CAACsF,KAAK,GAAGD,QAAQ;EAC/B;AACJ;;AAEA;;AAEA,MAAM7F,WAAW,SAAS3J,aAAa,CAAC;EACpCyI,WAAWA,CAAA,EAAG;IACV,KAAK,CAAC;MACFsE,IAAI,EAAI9C,CAAC,CAAC,OAAO,CAAC;MAClByF,IAAI,EAAI,EAAE;MACVC,KAAK,EAAG;IACZ,CAAC,CAAC;EACN;EAEA7E,OAAOA,CAAC8E,OAAO,EAAE;IACb,IAAI,CAACzF,KAAK,CAACuF,IAAI,CAAC1G,IAAI,CAAC4G,OAAO,CAAC;IAC7B,IAAI,CAACzF,KAAK,CAACwF,KAAK,EAAE;EACtB;AACJ;;AAEA;;AAEA;;AAEA,IAAIE,SAAS,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;AAE9F,MAAMtI,YAAY,CAAC;EACfkB,WAAWA,CAACvI,IAAI,EAAE;IACd;IACA;IACA;IACA;IACAA,IAAI,CAACM,MAAM,CAAC,CAAC,CAAC;IACd,IAAI8E,KAAK,EAAEC,MAAM,EAAEuK,UAAU,EAAEC,gBAAgB;IAC/C,IAAIC,GAAG,GAAG9P,IAAI,CAAC+P,SAAS,CAAC,CAAC;IAC1B,IAAID,GAAG,IAAI,MAAM,EAAE;MACf;MACA,MAAM,IAAIlR,KAAK,CAAC,oBAAoB,CAAC;IACzC;IACA,OAAO,CAACoB,IAAI,CAACgQ,GAAG,CAAC,CAAC,EAAE;MAChB,IAAIC,EAAE,GAAGjQ,IAAI,CAACkQ,QAAQ,CAAC,CAAC;MACxB,IAAID,EAAE,IAAI,IAAI,EAAE;QACZ,MAAM,IAAIrR,KAAK,CAAC,oBAAoB,CAAC;MACzC;MACA,IAAIuR,MAAM,GAAGnQ,IAAI,CAACkQ,QAAQ,CAAC,CAAC;MAC5B,IAAIzR,MAAM,GAAGuB,IAAI,CAAC+P,SAAS,CAAC,CAAC;MAC7B,IAAIJ,SAAS,CAACpQ,OAAO,CAAC4Q,MAAM,CAAC,IAAI,CAAC,EAAE;QAChC;QACAN,gBAAgB,GAAG7P,IAAI,CAACkQ,QAAQ,CAAC,CAAC;QAClC7K,MAAM,GAAGrF,IAAI,CAAC+P,SAAS,CAAC,CAAC;QACzB3K,KAAK,GAAGpF,IAAI,CAAC+P,SAAS,CAAC,CAAC;QACxBH,UAAU,GAAG5P,IAAI,CAACkQ,QAAQ,CAAC,CAAC;QAC5B;MACJ;MACAlQ,IAAI,CAACoQ,IAAI,CAAC3R,MAAM,GAAG,CAAC,CAAC;IACzB;IAEA,IAAImR,UAAU,IAAI,IAAI,EAAE;MACpB,MAAM,IAAIhR,KAAK,CAAC,oBAAoB,CAAC;IACzC;IAEA,IAAIqL,KAAK,GAAG;MACR4C,IAAI,EAAe9C,CAAC,CAAC,SAAS,CAAC;MAC/BsG,OAAO,EAAYtG,CAAC,CAAC,OAAO,CAAC;MAC7BuG,KAAK,EAAclL,KAAK;MACxBmL,MAAM,EAAalL,MAAM;MACzBmL,gBAAgB,EAAGX,gBAAgB;MACnCV,MAAM,EAAapF,CAAC,CAAC,WAAW;IACpC,CAAC;IAED,QAAQ6F,UAAU;MAClB,KAAK,CAAC;QACF3F,KAAK,CAACwG,UAAU,GAAG1G,CAAC,CAAC,YAAY,CAAC;QAClC;MACJ,KAAK,CAAC;QACFE,KAAK,CAACwG,UAAU,GAAG1G,CAAC,CAAC,WAAW,CAAC;QACjC;MACJ,KAAK,CAAC;QACFE,KAAK,CAACwG,UAAU,GAAG1G,CAAC,CAAC,YAAY,CAAC;QAClCE,KAAK,CAACyG,MAAM,GAAG,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC,CAAC;QAC3C;IACJ;IAEA,IAAI,CAACrE,QAAQ,GAAG,YAAW;MACvBrM,IAAI,CAACM,MAAM,CAAC,CAAC,CAAC;MACd,IAAIE,MAAM,GAAG,IAAIyK,SAAS,CAACjL,IAAI,EAAEiK,KAAK,CAAC;MACvCzJ,MAAM,CAACwM,aAAa,GAAGjD,CAAC,CAAC,GAAG,GAAI,EAAEpO,gBAAiB,CAAC;MACpD,OAAO6E,MAAM;IACjB,CAAC;EACL;AACJ;;AAEA;;AAEA,MAAMyG,WAAW,CAAC;EACdsB,WAAWA,CAACnD,KAAK,EAAEC,MAAM,EAAEsB,GAAG,EAAEC,KAAK,EAAE;IACnC,IAAI,CAACyF,QAAQ,GAAG,UAASsE,GAAG,EAAE;MAC1B,IAAIC,IAAI,GAAG,IAAI3F,SAAS,CAACrE,KAAK,EAAE;QAC5BiG,IAAI,EAAe9C,CAAC,CAAC,SAAS,CAAC;QAC/BsG,OAAO,EAAYtG,CAAC,CAAC,OAAO,CAAC;QAC7BuG,KAAK,EAAclL,KAAK;QACxBmL,MAAM,EAAalL,MAAM;QACzBmL,gBAAgB,EAAG,CAAC;QACpBC,UAAU,EAAS1G,CAAC,CAAC,YAAY;MACrC,CAAC,EAAE,IAAI,CAAC;MACR,IAAIvJ,MAAM,GAAG,IAAIyK,SAAS,CAACtE,GAAG,EAAE;QAC5BkG,IAAI,EAAe9C,CAAC,CAAC,SAAS,CAAC;QAC/BsG,OAAO,EAAYtG,CAAC,CAAC,OAAO,CAAC;QAC7BuG,KAAK,EAAclL,KAAK;QACxBmL,MAAM,EAAalL,MAAM;QACzBmL,gBAAgB,EAAG,CAAC;QACpBC,UAAU,EAAS1G,CAAC,CAAC,WAAW,CAAC;QACjC8G,KAAK,EAAcF,GAAG,CAAC9H,MAAM,CAAC+H,IAAI;MACtC,CAAC,EAAE,IAAI,CAAC;MACRpQ,MAAM,CAACwM,aAAa,GAAGjD,CAAC,CAAC,GAAG,GAAI,EAAEpO,gBAAiB,CAAC;MACpD,OAAO6E,MAAM;IACjB,CAAC;EACL;AACJ;;AAEA;;AAEA,MAAM0L,eAAe,SAASpM,aAAa,CAAC;EACxCyI,WAAWA,CAACI,IAAI,EAAC;IACb,KAAK,CAAC;MACFkE,IAAI,EAAO9C,CAAC,CAAC,MAAM,CAAC;MACpBsG,OAAO,EAAItG,CAAC,CAAC,OAAO,CAAC;MACrB+G,QAAQ,EAAG/G,CAAC,CAACpB,IAAI;IACrB,CAAC,CAAC;IAEF,IAAI,CAACqE,aAAa,GAAGjD,CAAC,CAAC,GAAG,GAAI,EAAEpO,gBAAiB,CAAC;EACtD;EAEAoV,UAAUA,CAAC7D,GAAG,EAAE;IACZ,OAAO,IAAIrD,SAAS,CAAClK,MAAM,CAACuN,GAAG,CAAC,CAAC;EACrC;AACJ;;AAEA;;AAEA,MAAMf,OAAO,SAASrM,aAAa,CAAC;EAChCyI,WAAWA,CAACoI,GAAG,EAAEjN,IAAI,EAAEuG,KAAK,EAAC;IACzB,KAAK,CAAC,CAAC,CAAC,CAAC;IAETA,KAAK,GAAG,IAAI,CAACA,KAAK;IAClBA,KAAK,CAAC4C,IAAI,GAAG9C,CAAC,CAAC,MAAM,CAAC;IACtBE,KAAK,CAACoG,OAAO,GAAGtG,CAAC,CAAC,OAAO,CAAC;IAC1BE,KAAK,CAAC+G,QAAQ,GAAGjH,CAAC,CAAC,YAAY,CAAC;IAEhC,IAAI,CAACkH,IAAI,GAAGN,GAAG;IACf,IAAI,CAACO,KAAK,GAAGxN,IAAI;IACjB,IAAI,CAACyN,IAAI,GAAGzN,IAAI,CAAC0N,UAAU,CAAC,CAAC;IAC7B,IAAI,CAACpE,aAAa,GAAGjD,CAAC,CAAC,GAAG,GAAI,EAAEpO,gBAAiB,CAAC;IAElD,IAAI0V,IAAI,GAAG3N,IAAI,CAAC2N,IAAI;IAEpB,IAAI,CAAC1I,IAAI,GAAGjF,IAAI,CAAC4N,MAAM;IACvB,IAAIC,KAAK,GAAG,IAAI,CAACA,KAAK,GAAG7N,IAAI,CAAC6N,KAAK;IACnC,IAAI,CAACC,IAAI,GAAG,CACRH,IAAI,CAACI,IAAI,GAAGF,KAAK,EACjBF,IAAI,CAACK,IAAI,GAAGH,KAAK,EACjBF,IAAI,CAACM,IAAI,GAAGJ,KAAK,EACjBF,IAAI,CAACO,IAAI,GAAGL,KAAK,CACpB;IAED,IAAI,CAACM,WAAW,GAAGnO,IAAI,CAACoO,IAAI,CAACD,WAAW;IACxC,IAAI,CAACE,MAAM,GAAGrO,IAAI,CAACqO,MAAM,GAAGR,KAAK;IACjC,IAAI,CAACS,OAAO,GAAGtO,IAAI,CAACsO,OAAO,GAAGT,KAAK;IACnC,IAAI,CAACU,OAAO,GAAGvO,IAAI,CAACuO,OAAO,GAAGV,KAAK;IACnC,IAAI,CAACW,SAAS,GAAGxO,IAAI,CAACyO,GAAG,CAACD,SAAS,IAAI,IAAI,CAACH,MAAM;IAClD,IAAI,CAACK,OAAO,GAAG1O,IAAI,CAACyO,GAAG,CAACC,OAAO,IAAI,CAAC;IACpC,IAAI,CAACC,KAAK,GAAG,CAAC;IAEd,IAAI,CAACC,WAAW,GAAG,CAAC5O,IAAI,CAACyO,GAAG,CAACG,WAAW,IAAI,CAAC,KAAK,CAAC;IACnD,IAAI,CAACC,OAAO,GAAG,IAAI,CAACD,WAAW,IAAI,CAAC,IAAI,IAAI,CAACA,WAAW,IAAI,CAAC;IAC7D,IAAI,CAACE,QAAQ,GAAG,IAAI,CAACF,WAAW,IAAI,EAAE;IAEtC,IAAI,CAACG,KAAK,GAAI,CAAC/O,IAAI,CAACoO,IAAI,CAACY,YAAY,GAAG,CAAC,GAAG,CAAC,KAChC,IAAI,CAACH,OAAO,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAC1B,IAAI,CAACC,QAAQ,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAC3B,IAAI,CAACX,WAAW,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GACpC,CAAC,IAAI,CAAG;EACrB;EAEAd,UAAUA,CAAC4B,IAAI,EAAE;IACb,OAAO,IAAIhE,YAAY,CAAC,IAAI,CAACwC,IAAI,CAACJ,UAAU,CAACpR,MAAM,CAACgT,IAAI,CAAC,CAAC,CAAC;EAC/D;EAEAC,YAAYA,CAACC,QAAQ,EAAEF,IAAI,EAAE;IACzB,IAAIvN,KAAK,GAAG,CAAC;MAAE0N,OAAO,GAAG,IAAI,CAAC5B,KAAK,CAAC6B,IAAI,CAACD,OAAO;IAChD,KAAK,IAAIvU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoU,IAAI,CAAClU,MAAM,EAAE,EAAEF,CAAC,EAAE;MAClC,IAAIyU,OAAO,GAAGF,OAAO,CAACH,IAAI,CAACjE,UAAU,CAACnQ,CAAC,CAAC,CAAC;MACzC6G,KAAK,IAAI,IAAI,CAAC8L,KAAK,CAAC+B,YAAY,CAACD,OAAO,IAAI,CAAC,CAAC;IAClD;IACA,OAAO5N,KAAK,GAAGyN,QAAQ,GAAG,IAAI;EAClC;EAEA/T,YAAYA,CAAA,EAAG;IACX,IAAI0J,IAAI,GAAG,IAAI;IACf,IAAI0K,GAAG,GAAG1K,IAAI,CAAC2I,IAAI;;IAEnB;IACA,IAAInR,IAAI,GAAGkT,GAAG,CAACnU,MAAM,CAAC,CAAC;IACvB,IAAIoU,UAAU,GAAG,IAAIlI,SAAS,CAACnQ,YAAY,CAACkF,IAAI,CAAC,EAAE;MAC/CoT,OAAO,EAAEpT,IAAI,CAACvB;IAClB,CAAC,EAAE,IAAI,CAAC;IAER,IAAI4U,UAAU,GAAG7K,IAAI,CAACyI,IAAI,CAACpI,MAAM,CAAC,IAAI/I,aAAa,CAAC;MAChD+M,IAAI,EAAW9C,CAAC,CAAC,gBAAgB,CAAC;MAClCuJ,QAAQ,EAAOvJ,CAAC,CAACvB,IAAI,CAAC2I,IAAI,CAACG,MAAM,CAAC;MAClCiC,QAAQ,EAAO/K,IAAI,CAACgJ,IAAI;MACxBgC,KAAK,EAAUhL,IAAI,CAACiK,KAAK;MACzBgB,KAAK,EAAUjL,IAAI,CAAC6J,KAAK;MACzBqB,WAAW,EAAIlL,IAAI,CAACqJ,WAAW;MAC/B8B,MAAM,EAASnL,IAAI,CAACuJ,MAAM;MAC1B6B,OAAO,EAAQpL,IAAI,CAACwJ,OAAO;MAC3B6B,SAAS,EAAMrL,IAAI,CAAC0J,SAAS;MAC7B4B,OAAO,EAAQtL,IAAI,CAAC4J,OAAO;MAC3B2B,SAAS,EAAMvL,IAAI,CAACyI,IAAI,CAACpI,MAAM,CAACsK,UAAU;IAC9C,CAAC,CAAC,CAAC;IAEH,IAAIJ,IAAI,GAAGG,GAAG,CAACc,SAAS;IACxB,IAAIC,SAAS,GAAGf,GAAG,CAACe,SAAS;IAC7B,IAAIC,QAAQ,GAAGhB,GAAG,CAACgB,QAAQ;IAC3B,IAAIC,UAAU,GAAG,EAAE;IACnB,CAAC,SAASC,IAAIA,CAAC7V,CAAC,EAAE8V,KAAK,EAAC;MACpB,IAAI9V,CAAC,IAAI2V,QAAQ,EAAE;QACf,IAAII,GAAG,GAAGvB,IAAI,CAACxU,CAAC,CAAC;QACjB,IAAI+V,GAAG,IAAI,IAAI,EAAE;UACbF,IAAI,CAAC7V,CAAC,GAAG,CAAC,CAAC;QACf,CAAC,MAAM;UACH,IAAI,CAAC8V,KAAK,EAAE;YACRF,UAAU,CAACrL,IAAI,CAACvK,CAAC,EAAE8V,KAAK,GAAG,EAAE,CAAC;UAClC;UACAA,KAAK,CAACvL,IAAI,CAACN,IAAI,CAAC0I,KAAK,CAAC+B,YAAY,CAACqB,GAAG,CAAC,CAAC;UACxCF,IAAI,CAAC7V,CAAC,GAAG,CAAC,EAAE8V,KAAK,CAAC;QACtB;MACJ;IACJ,CAAC,EAAEJ,SAAS,CAAC;;IAEb;IACA;IACA;IACA;IACA;;IAEA,IAAIM,UAAU,GAAG,IAAIzU,aAAa,CAAC;MAC/B+M,IAAI,EAAE9C,CAAC,CAAC,MAAM,CAAC;MACfsG,OAAO,EAAEtG,CAAC,CAAC,cAAc,CAAC;MAC1B+G,QAAQ,EAAE/G,CAAC,CAACvB,IAAI,CAAC2I,IAAI,CAACG,MAAM,CAAC;MAC7BkD,aAAa,EAAE,IAAI1U,aAAa,CAAC;QAC7B2U,QAAQ,EAAK,IAAI5K,SAAS,CAAC,OAAO,CAAC;QACnC6K,QAAQ,EAAK,IAAI7K,SAAS,CAAC,UAAU,CAAC;QACtC8K,UAAU,EAAG;MACjB,CAAC,CAAC;MACFC,cAAc,EAAEvB,UAAU;MAC1BwB,SAAS,EAAEZ,SAAS;MACpBa,QAAQ,EAAEZ,QAAQ;MAClBa,EAAE,EAAEvT,IAAI,CAACwT,KAAK,CAACxM,IAAI,CAAC0I,KAAK,CAAC+B,YAAY,CAAC,CAAC,CAAC,CAAC;MAC1CgC,CAAC,EAAEd,UAAU;MACbe,WAAW,EAAE1M,IAAI,CAACyI,IAAI,CAACpI,MAAM,CAACL,IAAI,CAAC2M,gBAAgB,CAAC,CAAC;IACzD,CAAC,CAAC;IAEF,IAAIlI,IAAI,GAAGzE,IAAI,CAACyB,KAAK;IACrBgD,IAAI,CAAC6D,QAAQ,GAAG/G,CAAC,CAACvB,IAAI,CAAC2I,IAAI,CAACG,MAAM,CAAC;IACnCrE,IAAI,CAACmI,eAAe,GAAG,CAAE5M,IAAI,CAACyI,IAAI,CAACpI,MAAM,CAAC0L,UAAU,CAAC,CAAE;;IAEvD;IACA;IACA,IAAIc,MAAM,GAAG,IAAIC,gBAAgB,CAACrB,SAAS,EAAEC,QAAQ,EAAEhB,GAAG,CAACqC,MAAM,CAAC;IAClE,IAAIC,YAAY,GAAG,IAAIvK,SAAS,CAAC9M,UAAU,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC;IAC1DqX,YAAY,CAACxV,IAAI,CAACqV,MAAM,CAAC;IACzBpI,IAAI,CAACwI,SAAS,GAAGjN,IAAI,CAACyI,IAAI,CAACpI,MAAM,CAAC2M,YAAY,CAAC;EACnD;EAEAL,gBAAgBA,CAAA,EAAG;IACf,OAAO,IAAIlK,SAAS,CAACnQ,YAAY,CAAC,IAAI,CAACqW,IAAI,CAACuE,WAAW,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC;EAC3E;AACR;AAEA,MAAMJ,gBAAgB,SAASzW,QAAQ,CAAC;EACpC0J,WAAWA,CAAC0L,SAAS,EAAEC,QAAQ,EAAEyB,GAAG,EAAC;IACjC,KAAK,CAAC,CAAC;IACP,IAAI,CAAC1B,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACC,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACyB,GAAG,GAAGA,GAAG;EAClB;EAEA5W,MAAMA,CAACT,GAAG,EAAE;IACRA,GAAG,CAAC6B,MAAM,CAAC,sCAAsC,CAAC;IAClD7B,GAAG,CAAC6B,MAAM,CAAC,eAAe,CAAC;IAC3B7B,GAAG,CAAC6B,MAAM,CAAC,WAAW,CAAC;IACvB7B,GAAG,CAAC6B,MAAM,CAAC,mBAAmB,CAAC;IAC/B7B,GAAG,CAAC6B,MAAM,CAAC,qBAAqB,CAAC;IACjC7B,GAAG,CAAC6B,MAAM,CAAC,mBAAmB,CAAC;IAC/B7B,GAAG,CAAC6B,MAAM,CAAC,iBAAiB,CAAC;IAC7B7B,GAAG,CAAC6B,MAAM,CAAC,QAAQ,CAAC;IACpB7B,GAAG,CAAC6B,MAAM,CAAC,mCAAmC,CAAC;IAC/C7B,GAAG,CAAC6B,MAAM,CAAC,iBAAiB,CAAC;IAC7B7B,GAAG,CAAC6B,MAAM,CAAC,uBAAuB,CAAC;IACnC7B,GAAG,CAAC6B,MAAM,CAAC,gBAAgB,CAAC;IAC5B7B,GAAG,CAAC6B,MAAM,CAAC,mBAAmB,CAAC;IAE/B,IAAIqI,IAAI,GAAG,IAAI;IACflK,GAAG,CAAC6B,MAAM,CAACqI,IAAI,CAAC0L,QAAQ,GAAG1L,IAAI,CAACyL,SAAS,GAAG,CAAC,EAAE,cAAc,CAAC;IAC9D3V,GAAG,CAAC2B,UAAU,CAAC,YAAU;MACrB,KAAK,IAAIwO,IAAI,GAAGjG,IAAI,CAACyL,SAAS,EAAExF,IAAI,IAAIjG,IAAI,CAAC0L,QAAQ,EAAE,EAAEzF,IAAI,EAAE;QAC3D,IAAImH,OAAO,GAAGpN,IAAI,CAACmN,GAAG,CAAClH,IAAI,CAAC;QAC5B,IAAIvB,GAAG,GAAGnS,UAAU,CAAC,CAAE6a,OAAO,CAAE,CAAC;QACjCtX,GAAG,CAAC6B,MAAM,CAAC,GAAG,EAAE0L,OAAO,CAAC4C,IAAI,CAAClO,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;QACxD,KAAK,IAAIhC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG2O,GAAG,CAACzO,MAAM,EAAE,EAAEF,CAAC,EAAE;UACjCD,GAAG,CAACuN,OAAO,CAACqB,GAAG,CAACwB,UAAU,CAACnQ,CAAC,CAAC,CAACgC,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACnD;QACAjC,GAAG,CAAC,GAAG,CAAC;MACZ;IACJ,CAAC,CAAC;IACFA,GAAG,CAAC6B,MAAM,CAAC,WAAW,CAAC;IAEvB7B,GAAG,CAAC6B,MAAM,CAAC,SAAS,CAAC;IACrB7B,GAAG,CAAC6B,MAAM,CAAC,+CAA+C,CAAC;IAC3D7B,GAAG,CAAC6B,MAAM,CAAC,KAAK,CAAC;IACjB7B,GAAG,CAAC6B,MAAM,CAAC,KAAK,CAAC;EACrB;AACJ;;AAEA;;AAEA,SAAS0V,QAAQA,CAAC9O,CAAC,EAAE;EACjB,OAAOA,CAAC,CAAC4O,GAAG,CAAC,UAASjX,CAAC,EAAC;IACpB,OAAOM,OAAO,CAACN,CAAC,CAAC,GAAGmX,QAAQ,CAACnX,CAAC,CAAC,GACzB,OAAOA,CAAC,IAAI,QAAQ,GAAG,CAAC8C,IAAI,CAACwT,KAAK,CAACtW,CAAC,GAAG,IAAI,CAAC,GAAG,IAAI,EAAEY,OAAO,CAAC,CAAC,CAAC,GAC/DZ,CAAC;EACX,CAAC,CAAC,CAACoX,IAAI,CAAC,GAAG,CAAC;AAChB;AAEA,SAASC,0BAA0BA,CAACpF,GAAG,EAAEqF,EAAE,EAAEC,EAAE,EAAExZ,EAAE,EAAEyZ,EAAE,EAAEC,EAAE,EAAEzZ,EAAE,EAAE;EAC7D,IAAI0Z,IAAI,GAAGP,QAAQ,CAAC,CAAEG,EAAE,EAAEC,EAAE,EAAExZ,EAAE,EAAEyZ,EAAE,EAAEC,EAAE,EAAEzZ,EAAE,CAAE,CAAC;EAC/C,IAAI2Z,IAAI,GAAG1F,GAAG,CAACzH,kBAAkB,CAACkN,IAAI,CAAC;EACvC,IAAI,CAACC,IAAI,EAAE;IACPA,IAAI,GAAG1F,GAAG,CAACzH,kBAAkB,CAACkN,IAAI,CAAC,GAAGzF,GAAG,CAAC9H,MAAM,CAAC,IAAI/I,aAAa,CAAC;MAC/DwW,YAAY,EAAE,CAAC;MACfC,MAAM,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;MAChBC,KAAK,EAAE,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;MAC3BC,CAAC,EAAE,CAAC;MACJC,EAAE,EAAE,CAAEV,EAAE,EAAGC,EAAE,EAAGxZ,EAAE,CAAE;MACpBka,EAAE,EAAE,CAAET,EAAE,EAAGC,EAAE,EAAGzZ,EAAE;IACtB,CAAC,CAAC,CAAC;EACP;EACA,OAAO2Z,IAAI;AACf;AAEA,SAASO,4BAA4BA,CAACjG,GAAG,EAAE7U,EAAE,EAAEC,EAAE,EAAE;EAC/C,IAAIqa,IAAI,GAAGP,QAAQ,CAAC,CAAE/Z,EAAE,EAAEC,EAAE,CAAE,CAAC;EAC/B,IAAIsa,IAAI,GAAG1F,GAAG,CAACxH,kBAAkB,CAACiN,IAAI,CAAC;EACvC,IAAI,CAACC,IAAI,EAAE;IACPA,IAAI,GAAG1F,GAAG,CAACxH,kBAAkB,CAACiN,IAAI,CAAC,GAAGzF,GAAG,CAAC9H,MAAM,CAAC,IAAI/I,aAAa,CAAC;MAC/DwW,YAAY,EAAE,CAAC;MACfC,MAAM,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;MAChBC,KAAK,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;MACfC,CAAC,EAAE,CAAC;MACJC,EAAE,EAAE,CAAE5a,EAAE,CAAE;MACV6a,EAAE,EAAE,CAAE5a,EAAE;IACZ,CAAC,CAAC,CAAC;EACP;EACA,OAAOsa,IAAI;AACf;AAEA,SAASQ,qBAAqBA,CAAClG,GAAG,EAAEmG,KAAK,EAAE;EACvC,IAAIpQ,QAAQ,GAAG,KAAK;EACpB,IAAIqQ,SAAS,GAAG,EAAE;EAClB,IAAIC,MAAM,GAAG,EAAE;EACf,IAAIC,OAAO,GAAG,EAAE;EAChB,IAAIC,MAAM,GAAG,EAAE;EACf,IAAI3Y,CAAC,EAAE4Y,IAAI,EAAEC,GAAG,EAAEC,SAAS,EAAEC,QAAQ;EACrC,KAAK/Y,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuY,KAAK,CAACrY,MAAM,EAAE,EAAEF,CAAC,EAAE;IAC/B4Y,IAAI,GAAGL,KAAK,CAACvY,CAAC,GAAG,CAAC,CAAC;IACnB6Y,GAAG,GAAGN,KAAK,CAACvY,CAAC,CAAC;IACd8Y,SAAS,GAAGF,IAAI,CAACI,KAAK;IACtBD,QAAQ,GAAGF,GAAG,CAACG,KAAK;IACpBP,MAAM,CAAClO,IAAI,CAACiN,0BAA0B,CAClCpF,GAAG,EACH0G,SAAS,CAACG,CAAC,EAAEH,SAAS,CAACI,CAAC,EAAEJ,SAAS,CAACK,CAAC,EACrCJ,QAAQ,CAACE,CAAC,EAAGF,QAAQ,CAACG,CAAC,EAAGH,QAAQ,CAACI,CACvC,CAAC,CAAC;IACF,IAAIL,SAAS,CAACtQ,CAAC,GAAG,CAAC,IAAIuQ,QAAQ,CAACvQ,CAAC,GAAG,CAAC,EAAE;MACnCL,QAAQ,GAAG,IAAI;IACnB;IACAuQ,OAAO,CAACnO,IAAI,CAACsO,GAAG,CAAC9W,MAAM,CAAC;IACxB4W,MAAM,CAACpO,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;EACrB;EACA,IAAIpC,QAAQ,EAAE;IACV,KAAKnI,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuY,KAAK,CAACrY,MAAM,EAAE,EAAEF,CAAC,EAAE;MAC/B4Y,IAAI,GAAGL,KAAK,CAACvY,CAAC,GAAG,CAAC,CAAC;MACnB6Y,GAAG,GAAGN,KAAK,CAACvY,CAAC,CAAC;MACd8Y,SAAS,GAAGF,IAAI,CAACI,KAAK;MACtBD,QAAQ,GAAGF,GAAG,CAACG,KAAK;MACpBR,SAAS,CAACjO,IAAI,CAAC8N,4BAA4B,CACvCjG,GAAG,EAAE0G,SAAS,CAACtQ,CAAC,EAAEuQ,QAAQ,CAACvQ,CAC/B,CAAC,CAAC;IACN;EACJ;EACAkQ,OAAO,CAACU,GAAG,CAAC,CAAC;EACb,OAAO;IACHjR,QAAQ,EAAIA,QAAQ;IACpBsQ,MAAM,EAAMY,QAAQ,CAACZ,MAAM,CAAC;IAC5BD,SAAS,EAAGrQ,QAAQ,GAAGkR,QAAQ,CAACb,SAAS,CAAC,GAAG;EACjD,CAAC;EACD,SAASa,QAAQA,CAACC,KAAK,EAAE;IACrB,IAAIA,KAAK,CAACpZ,MAAM,IAAI,CAAC,EAAE;MACnB,OAAOoZ,KAAK,CAAC,CAAC,CAAC;IACnB;IACA,OAAO;MACHvB,YAAY,EAAE,CAAC;MACfwB,SAAS,EAAED,KAAK;MAChBtB,MAAM,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;MAChBwB,MAAM,EAAEd,OAAO;MACfe,MAAM,EAAEd;IACZ,CAAC;EACL;AACJ;AAEA,SAASe,kBAAkBA,CAACtH,GAAG,EAAEuH,QAAQ,EAAEpB,KAAK,EAAEqB,MAAM,EAAEN,KAAK,EAAEO,GAAG,EAAE;EAClE,IAAIC,OAAO,EAAEjC,IAAI;EACjB;EACA;EACA;EACA,IAAI,CAACgC,GAAG,EAAE;IACN,IAAIrR,CAAC,GAAG,CAAEmR,QAAQ,CAAE,CAACI,MAAM,CAACH,MAAM,CAAC;IACnCrB,KAAK,CAACzO,OAAO,CAAC,UAAS3J,CAAC,EAAC;MACrBqI,CAAC,CAAC+B,IAAI,CAACpK,CAAC,CAAC4B,MAAM,EAAE5B,CAAC,CAAC6Y,KAAK,CAACC,CAAC,EAAE9Y,CAAC,CAAC6Y,KAAK,CAACE,CAAC,EAAE/Y,CAAC,CAAC6Y,KAAK,CAACG,CAAC,CAAC;IACrD,CAAC,CAAC;IACFtB,IAAI,GAAGP,QAAQ,CAAC9O,CAAC,CAAC;IAClBsR,OAAO,GAAG1H,GAAG,CAACvH,QAAQ,CAACgN,IAAI,CAAC;EAChC;EACA,IAAI,CAACiC,OAAO,EAAE;IACVA,OAAO,GAAG,IAAIvY,aAAa,CAAC;MACxB+M,IAAI,EAAE9C,CAAC,CAAC,SAAS,CAAC;MAClBwO,WAAW,EAAEL,QAAQ,GAAG,CAAC,GAAG,CAAC;MAC7BzH,UAAU,EAAE1G,CAAC,CAAC,WAAW,CAAC;MAC1ByO,MAAM,EAAEL,MAAM;MACd5B,MAAM,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;MAChBkC,QAAQ,EAAEZ,KAAK;MACfa,MAAM,EAAE,CAAE,IAAI,EAAE,IAAI;IACxB,CAAC,CAAC;IACF/H,GAAG,CAAC9H,MAAM,CAACwP,OAAO,CAAC;IACnBA,OAAO,CAACrL,aAAa,GAAG,GAAG,GAAI,EAAErR,gBAAiB;IAClD,IAAIya,IAAI,EAAE;MACNzF,GAAG,CAACvH,QAAQ,CAACgN,IAAI,CAAC,GAAGiC,OAAO;IAChC;EACJ;EACA,OAAOA,OAAO;AAClB;AAEA,SAASM,oBAAoBA,CAAChI,GAAG,EAAEuH,QAAQ,EAAEpB,KAAK,EAAEqB,MAAM,EAAEN,KAAK,EAAEO,GAAG,EAAE;EACpE,IAAI7L,OAAO,EAAE6J,IAAI;EACjB;EACA;EACA;EACA,IAAI,CAACgC,GAAG,EAAE;IACN,IAAIrR,CAAC,GAAG,CAAEmR,QAAQ,CAAE,CAACI,MAAM,CAACH,MAAM,CAAC;IACnCrB,KAAK,CAACzO,OAAO,CAAC,UAAS3J,CAAC,EAAC;MACrBqI,CAAC,CAAC+B,IAAI,CAACpK,CAAC,CAAC4B,MAAM,EAAE5B,CAAC,CAAC6Y,KAAK,CAACxQ,CAAC,CAAC;IAC/B,CAAC,CAAC;IACFqP,IAAI,GAAGP,QAAQ,CAAC9O,CAAC,CAAC;IAClBwF,OAAO,GAAGoE,GAAG,CAACtH,QAAQ,CAAC+M,IAAI,CAAC;EAChC;EACA,IAAI,CAAC7J,OAAO,EAAE;IACVA,OAAO,GAAG,IAAIzM,aAAa,CAAC;MACxB+M,IAAI,EAAE9C,CAAC,CAAC,WAAW,CAAC;MACpB6O,GAAG,EAAE,KAAK;MACV9L,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE,CAAC;MACL8D,KAAK,EAAE;QACHhE,IAAI,EAAE9C,CAAC,CAAC,MAAM,CAAC;QACfD,CAAC,EAAEC,CAAC,CAAC,YAAY,CAAC;QAClB8O,CAAC,EAAElI,GAAG,CAAC9H,MAAM,CAAC,IAAIoC,SAAS,CAAC,eAAe,EAAE;UACzC4B,IAAI,EAAE9C,CAAC,CAAC,SAAS,CAAC;UAClBsG,OAAO,EAAEtG,CAAC,CAAC,MAAM,CAAC;UAClB+O,QAAQ,EAAE,CAAC;UACXC,IAAI,EAAGX,GAAG,GAAG,CACTA,GAAG,CAACxW,IAAI,EAAEwW,GAAG,CAACvW,GAAG,GAAGuW,GAAG,CAAC/S,MAAM,EAAE+S,GAAG,CAACxW,IAAI,GAAGwW,GAAG,CAAChT,KAAK,EAAEgT,GAAG,CAACvW,GAAG,CAChE,GAAG,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAG;UACnBmX,KAAK,EAAE;YACHnM,IAAI,EAAE9C,CAAC,CAAC,OAAO,CAAC;YAChBD,CAAC,EAAEC,CAAC,CAAC,cAAc,CAAC;YACpBkP,EAAE,EAAElP,CAAC,CAAC,YAAY,CAAC;YACnBmP,CAAC,EAAE;UACP,CAAC;UACDC,SAAS,EAAE;YACPC,SAAS,EAAE;cACPvd,EAAE,EAAE;gBAAEiR,EAAE,EAAE,CAAC;gBAAEC,EAAE,EAAE;cAAE;YACvB,CAAC;YACDsM,OAAO,EAAE;cACLC,EAAE,EAAE;gBACA7I,UAAU,EAAE1G,CAAC,CAAC,YAAY,CAAC;gBAC3ByO,MAAM,EAAEL,MAAM;gBACd5B,MAAM,EAAE,CAAE,CAAC,EAAE,CAAC,CAAE;gBAChBgC,WAAW,EAAEL,QAAQ,GAAG,CAAC,GAAG,CAAC;gBAC7BO,QAAQ,EAAEZ,KAAK;gBACfa,MAAM,EAAE,CAAE,IAAI,EAAE,IAAI;cACxB;YACJ;UACJ;QACJ,CAAC,CAAC;MACN;IACJ,CAAC,CAAC;IACF/H,GAAG,CAAC9H,MAAM,CAAC0D,OAAO,CAAC;IACnBA,OAAO,CAACS,aAAa,GAAG,GAAG,GAAI,EAAErR,gBAAiB;IAClD,IAAIya,IAAI,EAAE;MACNzF,GAAG,CAACtH,QAAQ,CAAC+M,IAAI,CAAC,GAAG7J,OAAO;IAChC;EACJ;EACA,OAAOA,OAAO;AAClB;AAEA,SAASgN,aAAaA,CAAC5I,GAAG,EAAE6I,QAAQ,EAAEpB,GAAG,EAAE;EACvC,IAAIF,QAAQ,GAAGsB,QAAQ,CAAClV,IAAI,IAAI,QAAQ;EACxC,IAAIuT,KAAK,GAAGhB,qBAAqB,CAAClG,GAAG,EAAE6I,QAAQ,CAAC1C,KAAK,CAAC;EACtD,IAAIqB,MAAM,GAAGD,QAAQ,GAAG,CACpBsB,QAAQ,CAACC,KAAK,CAAC/a,CAAC,EAAG8a,QAAQ,CAACC,KAAK,CAACC,CAAC,EAAGF,QAAQ,CAACC,KAAK,CAACjC,CAAC,EACtDgC,QAAQ,CAACG,GAAG,CAACjb,CAAC,EAAK8a,QAAQ,CAACG,GAAG,CAACD,CAAC,EAAKF,QAAQ,CAACG,GAAG,CAACnC,CAAC,CACvD,GAAG,CACAgC,QAAQ,CAACC,KAAK,CAAC/a,CAAC,EAAG8a,QAAQ,CAACC,KAAK,CAACC,CAAC,EACnCF,QAAQ,CAACG,GAAG,CAACjb,CAAC,EAAK8a,QAAQ,CAACG,GAAG,CAACD,CAAC,CACpC;EACD,IAAIrB,OAAO,GAAGJ,kBAAkB,CAC5BtH,GAAG,EAAEuH,QAAQ,EAAEsB,QAAQ,CAAC1C,KAAK,EAAEqB,MAAM,EAAEN,KAAK,CAACb,MAAM,EAAEwC,QAAQ,CAACI,SAAS,IAAIxB,GAC/E,CAAC;EACD,IAAI7L,OAAO,GAAGsL,KAAK,CAACnR,QAAQ,GAAGiS,oBAAoB,CAC/ChI,GAAG,EAAEuH,QAAQ,EAAEsB,QAAQ,CAAC1C,KAAK,EAAEqB,MAAM,EAAEN,KAAK,CAACd,SAAS,EAAEyC,QAAQ,CAACI,SAAS,IAAIxB,GAClF,CAAC,GAAG,IAAI;EACR,OAAO;IACH1R,QAAQ,EAAEmR,KAAK,CAACnR,QAAQ;IACxB2R,OAAO,EAAEA,OAAO;IAChB9L,OAAO,EAAEA;EACb,CAAC;AACL;;AAEA;;AAEA,MAAMjB,OAAO,SAASxL,aAAa,CAAC;EAChCyI,WAAWA,CAACoI,GAAG,EAAE1G,KAAK,EAAC;IACnB,KAAK,CAACA,KAAK,CAAC;IAEZ,IAAI,CAACgH,IAAI,GAAGN,GAAG;IACf,IAAI,CAACkJ,OAAO,GAAG,CAAC;IAChB,IAAI,CAACC,SAAS,GAAG,KAAK;IACtB,IAAI,CAACC,cAAc,GAAG,CAAC,CAAC;IACxB,IAAI,CAACC,YAAY,GAAG,CAAC,CAAC;IACtB,IAAI,CAACC,WAAW,GAAG,CAAC,CAAC;IACrB,IAAI,CAACC,aAAa,GAAG,CAAC,CAAC;IACvB,IAAI,CAACC,YAAY,GAAG,CAAC,CAAC;IACtB,IAAI,CAACC,QAAQ,GAAG,CAAC;IACjB,IAAI,CAACC,OAAO,GAAG,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;IACnC,IAAI,CAACC,YAAY,GAAG,EAAE;IAEtB,IAAI,CAACpJ,KAAK,GAAG,IAAI;IACjB,IAAI,CAACqJ,SAAS,GAAG,IAAI;IAErB,IAAI,CAACC,aAAa,GAAG,EAAE;IAEvBvQ,KAAK,GAAG,IAAI,CAACA,KAAK;IAClBA,KAAK,CAAC4C,IAAI,GAAG9C,CAAC,CAAC,MAAM,CAAC;IACtBE,KAAK,CAACwQ,OAAO,GAAG,CACZ1Q,CAAC,CAAC,KAAK,CAAC,EACRA,CAAC,CAAC,MAAM,CAAC,EACTA,CAAC,CAAC,QAAQ,CAAC,EACXA,CAAC,CAAC,QAAQ,CAAC,EACXA,CAAC,CAAC,QAAQ,CAAC,CACd;IACDE,KAAK,CAACkP,SAAS,GAAG,IAAIrZ,aAAa,CAAC;MAChC4a,IAAI,EAAQ,IAAI5a,aAAa,CAAC,IAAI,CAACia,cAAc,CAAC;MAClDX,SAAS,EAAG,IAAItZ,aAAa,CAAC,IAAI,CAACka,YAAY,CAAC;MAChDW,OAAO,EAAK,IAAI7a,aAAa,CAAC,IAAI,CAACma,WAAW,CAAC;MAC/CW,OAAO,EAAK,IAAI9a,aAAa,CAAC,IAAI,CAACoa,aAAa,CAAC;MACjDb,OAAO,EAAK,IAAIvZ,aAAa,CAAC,IAAI,CAACqa,YAAY;IACnD,CAAC,CAAC;IACFlQ,KAAK,CAAC4Q,MAAM,GAAG,IAAI,CAACP,YAAY;EACpC;EAEAQ,IAAIA,CAAA,EAAG;IACH,IAAI,CAACvP,QAAQ,CAACvL,IAAI,CAACK,KAAK,CAAC,IAAI,EAAE7B,SAAS,CAAC;EAC7C;EAEAgN,SAASA,CAACzE,CAAC,EAAE2Q,CAAC,EAAE5I,CAAC,EAAEiM,CAAC,EAAEC,CAAC,EAAE9a,CAAC,EAAE;IACxB,IAAI,CAAC+a,gBAAgB,CAACzc,SAAS,CAAC,EAAE;MAC9B,IAAI,CAAC6b,OAAO,GAAGa,IAAI,CAAC1c,SAAS,EAAE,IAAI,CAAC6b,OAAO,CAAC;MAC5C,IAAI,CAACS,IAAI,CAAC/T,CAAC,EAAE,GAAG,EAAE2Q,CAAC,EAAE,GAAG,EAAE5I,CAAC,EAAE,GAAG,EAAEiM,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,GAAG,EAAE9a,CAAC,EAAE,KAAK,CAAC;MAC3D;MACA;MACA,IAAI,CAAC4a,IAAI,CAACpf,EAAE,CAAC;IACjB;EACJ;EAEA+P,SAASA,CAAC0P,EAAE,EAAEC,EAAE,EAAE;IACd,IAAI,CAAC5P,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE2P,EAAE,EAAEC,EAAE,CAAC;EACtC;EAEA7J,KAAKA,CAAC8J,EAAE,EAAEC,EAAE,EAAE;IACV,IAAI,CAAC9P,SAAS,CAAC6P,EAAE,EAAE,CAAC,EAAE,CAAC,EAAEC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;EACtC;EAEAC,MAAMA,CAACC,KAAK,EAAE;IACV,IAAIC,GAAG,GAAGja,IAAI,CAACia,GAAG,CAACD,KAAK,CAAC;MAAEE,GAAG,GAAGla,IAAI,CAACka,GAAG,CAACF,KAAK,CAAC;IAChD,IAAI,CAAChQ,SAAS,CAACiQ,GAAG,EAAEC,GAAG,EAAE,CAACA,GAAG,EAAED,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;EAC7C;EAEAE,SAASA,CAAA,EAAG;IACR,IAAI,CAAC7B,SAAS,GAAG,IAAI;IACrB,IAAI,CAACgB,IAAI,CAAC,IAAI,EAAEpf,EAAE,CAAC;EACvB;EAEAkgB,OAAOA,CAAA,EAAG;IACN,IAAI,CAAC9B,SAAS,GAAG,KAAK;IACtB,IAAI,CAACgB,IAAI,CAAC,IAAI,EAAEpf,EAAE,CAAC;EACvB;EAEAmgB,gBAAgBA,CAAA,EAAG;IACf,IAAI,CAAC,IAAI,CAAC/B,SAAS,EAAE;MACjB,MAAM,IAAIlb,KAAK,CAAC,iDAAiD,CAAC;IACtE;EACJ;EAEAkd,YAAYA,CAAA,EAAG;IACX,IAAI,CAAC,IAAI,CAAC5K,KAAK,EAAE;MACb,MAAM,IAAItS,KAAK,CAAC,6CAA6C,CAAC;IAClE;EACJ;EAEAmd,OAAOA,CAACrY,IAAI,EAAEI,IAAI,EAAE;IAChB,IAAI,CAAC+X,gBAAgB,CAAC,CAAC;IACvB,IAAInY,IAAI,IAAI,IAAI,EAAE;MACdA,IAAI,GAAG,IAAI,CAACwN,KAAK;IACrB,CAAC,MAAM,IAAI,EAAExN,IAAI,YAAYyI,OAAO,CAAC,EAAE;MACnCzI,IAAI,GAAG,IAAI,CAACuN,IAAI,CAAChF,OAAO,CAACvI,IAAI,CAAC;IAClC;IACA,IAAII,IAAI,IAAI,IAAI,EAAE;MACdA,IAAI,GAAG,IAAI,CAACyW,SAAS;IACzB;IACA,IAAI,CAACR,cAAc,CAACrW,IAAI,CAACsJ,aAAa,CAAC,GAAGtJ,IAAI;IAC9C,IAAI,CAACwN,KAAK,GAAGxN,IAAI;IACjB,IAAI,CAAC6W,SAAS,GAAGzW,IAAI;IACrB,IAAI,CAACgX,IAAI,CAACpX,IAAI,CAACsJ,aAAa,EAAE,GAAG,EAAElJ,IAAI,EAAE,KAAK,EAAEpI,EAAE,CAAC;EACvD;EAEAsgB,cAAcA,CAAClY,IAAI,EAAE;IACjB,IAAI,CAAC+X,gBAAgB,CAAC,CAAC;IACvB,IAAI,CAACf,IAAI,CAAChX,IAAI,EAAE,KAAK,EAAEpI,EAAE,CAAC;EAC9B;EAEAugB,oBAAoBA,CAACC,IAAI,EAAE;IACvB,IAAI,CAACL,gBAAgB,CAAC,CAAC;IACvB,IAAI,CAACf,IAAI,CAACoB,IAAI,EAAE,KAAK,EAAExgB,EAAE,CAAC;EAC9B;EAEAygB,QAAQA,CAACxJ,IAAI,EAAEyJ,cAAc,EAAE;IAC3B,IAAI,CAACN,YAAY,CAAC,CAAC;IACnB,IAAInJ,IAAI,CAAClU,MAAM,GAAG,CAAC,IAAI2d,cAAc,IAAI,IAAI,CAAClL,KAAK,YAAY/E,OAAO,EAAE;MACpE,IAAIkQ,WAAW,GAAG,IAAI,CAACnL,KAAK,CAAC0B,YAAY,CAAC,IAAI,CAAC2H,SAAS,EAAE5H,IAAI,CAAC;MAC/D,IAAIpB,KAAK,GAAG6K,cAAc,GAAGC,WAAW,GAAG,GAAG;MAC9C,IAAI,CAACvB,IAAI,CAACvJ,KAAK,EAAE,MAAM,CAAC;IAC5B;IACA,IAAI,CAACuJ,IAAI,CAAC,IAAI,CAAC5J,KAAK,CAACH,UAAU,CAAC4B,IAAI,CAAC,EAAE,KAAK,EAAEjX,EAAE,CAAC;EACrD;EAEA4gB,UAAUA,CAAC3J,IAAI,EAAE;IACb,IAAI,CAACmJ,YAAY,CAAC,CAAC;IACnB,IAAI,CAAChB,IAAI,CAAC,IAAI,CAAC5J,KAAK,CAACH,UAAU,CAAC4B,IAAI,CAAC,EAAE,IAAI,EAAEjX,EAAE,CAAC;EACpD;EAEA6gB,OAAOA,CAACC,GAAG,EAAEpE,GAAG,EAAE;IACd,IAAIqE,EAAE,GAAG,IAAI,CAACC,OAAO,CAAC;MAAEhe,CAAC,EAAE0Z,GAAG,CAACxW,IAAI;MAAE8X,CAAC,EAAEtB,GAAG,CAACrW;IAAO,CAAC,CAAC;IACrD,IAAI4a,EAAE,GAAG,IAAI,CAACD,OAAO,CAAC;MAAEhe,CAAC,EAAE0Z,GAAG,CAACtW,KAAK;MAAE4X,CAAC,EAAEtB,GAAG,CAACvW;IAAI,CAAC,CAAC;IACnD,IAAI,CAACyY,YAAY,CAACxR,IAAI,CAAC,IAAIhJ,aAAa,CAAC;MACrC+M,IAAI,EAAM9C,CAAC,CAAC,OAAO,CAAC;MACpBsG,OAAO,EAAGtG,CAAC,CAAC,MAAM,CAAC;MACnB6S,IAAI,EAAM,CAAEH,EAAE,CAAC/d,CAAC,EAAE+d,EAAE,CAAC/C,CAAC,EAAEiD,EAAE,CAACje,CAAC,EAAEie,EAAE,CAACjD,CAAC,CAAE;MACpCmD,MAAM,EAAI,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;MACrBC,CAAC,EAAS,IAAIhd,aAAa,CAAC;QACxB+M,IAAI,EAAG9C,CAAC,CAAC,QAAQ,CAAC;QAClBD,CAAC,EAAMC,CAAC,CAAC,KAAK,CAAC;QACfgT,GAAG,EAAI,IAAIlT,SAAS,CAAC2S,GAAG;MAC5B,CAAC;IACL,CAAC,CAAC,CAAC;EACP;EAEAQ,cAAcA,CAACxF,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IACpB,IAAI,CAACoD,IAAI,CAACtD,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,KAAK,EAAEhc,EAAE,CAAC;EAC3C;EAEAuhB,UAAUA,CAAC1Q,OAAO,EAAE;IAChB,IAAI,CAAC2Q,cAAc,CAAC3Q,OAAO,CAAC;IAC5B,IAAI,CAAC4Q,gBAAgB,CAAC5Q,OAAO,CAAC;IAC9B,IAAI,CAAC6N,QAAQ,IAAI7N,OAAO;EAC5B;EAEA4Q,gBAAgBA,CAAC5Q,OAAO,EAAE;IACtB,IAAIA,OAAO,GAAG,CAAC,EAAE;MACb,IAAIK,EAAE,GAAG,IAAI,CAACqE,IAAI,CAAC3E,YAAY,CAAC,IAAI,CAAC8N,QAAQ,GAAG7N,OAAO,EAAE,IAAI,CAAC;MAC9D,IAAI,CAACyN,YAAY,CAACpN,EAAE,CAACI,aAAa,CAAC,GAAGJ,EAAE;MACxC,IAAI,CAACkO,IAAI,CAAClO,EAAE,CAACI,aAAa,EAAE,KAAK,EAAEtR,EAAE,CAAC;IAC1C;EACJ;EAEA0hB,YAAYA,CAAC5F,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IAClB,IAAI,CAACoD,IAAI,CAACtD,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,KAAK,EAAEhc,EAAE,CAAC;EAC3C;EAEAwhB,cAAcA,CAAC3Q,OAAO,EAAE;IACpB,IAAIA,OAAO,GAAG,CAAC,EAAE;MACb,IAAIK,EAAE,GAAG,IAAI,CAACqE,IAAI,CAAC3E,YAAY,CAAC,IAAI,CAAC8N,QAAQ,GAAG7N,OAAO,EAAE,KAAK,CAAC;MAC/D,IAAI,CAACyN,YAAY,CAACpN,EAAE,CAACI,aAAa,CAAC,GAAGJ,EAAE;MACxC,IAAI,CAACkO,IAAI,CAAClO,EAAE,CAACI,aAAa,EAAE,KAAK,EAAEtR,EAAE,CAAC;IAC1C;EACJ;EAEA8d,QAAQA,CAACA,QAAQ,EAAEpB,GAAG,EAAE;IACpB,IAAI,CAACiF,IAAI,CAAC,CAAC;IACX,IAAI,CAAC3R,IAAI,CAAC0M,GAAG,CAACxW,IAAI,EAAEwW,GAAG,CAACvW,GAAG,EAAEuW,GAAG,CAAChT,KAAK,EAAEgT,GAAG,CAAC/S,MAAM,CAAC;IACnD,IAAI,CAACsG,IAAI,CAAC,CAAC;IACX,IAAI,CAAC6N,QAAQ,CAACI,SAAS,EAAE;MACrB,IAAI,CAACpO,SAAS,CAAC4M,GAAG,CAAChT,KAAK,EAAE,CAAC,EAAE,CAAC,EAAEgT,GAAG,CAAC/S,MAAM,EAAE+S,GAAG,CAACxW,IAAI,EAAEwW,GAAG,CAACvW,GAAG,CAAC;IAClE;IACA,IAAI4V,CAAC,GAAG8B,aAAa,CAAC,IAAI,CAACtI,IAAI,EAAEuI,QAAQ,EAAEpB,GAAG,CAAC;IAC/C,IAAIkF,KAAK,GAAG7F,CAAC,CAACY,OAAO,CAACrL,aAAa;MAAEuQ,KAAK;IAC1C,IAAI,CAACpD,YAAY,CAACmD,KAAK,CAAC,GAAG7F,CAAC,CAACY,OAAO;IACpC,IAAIZ,CAAC,CAAC/Q,QAAQ,EAAE;MACZ6W,KAAK,GAAG9F,CAAC,CAAClL,OAAO,CAACS,aAAa;MAC/B,IAAI,CAACgN,YAAY,CAACuD,KAAK,CAAC,GAAG9F,CAAC,CAAClL,OAAO;MACpC,IAAI,CAACuO,IAAI,CAAC,GAAG,GAAGyC,KAAK,GAAG,MAAM,CAAC;IACnC;IACA,IAAI,CAACzC,IAAI,CAAC,GAAG,GAAGwC,KAAK,GAAG,KAAK,EAAE5hB,EAAE,CAAC;IAClC,IAAI,CAAC8hB,OAAO,CAAC,CAAC;EAClB;EAEAC,cAAcA,CAACC,SAAS,EAAEC,SAAS,EAAE;IACjC,IAAI,CAAC7C,IAAI,CAAC4C,SAAS,EAAE,GAAG,EAAEC,SAAS,EAAE,IAAI,EAAEjiB,EAAE,CAAC;EAClD;EAEAkiB,YAAYA,CAACxY,KAAK,EAAE;IAChB,IAAI,CAAC0V,IAAI,CAAC1V,KAAK,EAAE,IAAI,EAAE1J,EAAE,CAAC;EAC9B;EAEAmiB,UAAUA,CAACC,OAAO,EAAE;IAChB,IAAI,CAAChD,IAAI,CAACgD,OAAO,EAAE,IAAI,EAAEpiB,EAAE,CAAC;EAChC;EAEAqiB,WAAWA,CAACC,QAAQ,EAAE;IAClB,IAAI,CAAClD,IAAI,CAACkD,QAAQ,EAAE,IAAI,EAAEtiB,EAAE,CAAC;EACjC;EAEAuiB,cAAcA,CAACC,WAAW,EAAE;IACxB,IAAI,CAACpD,IAAI,CAACoD,WAAW,EAAE,IAAI,EAAExiB,EAAE,CAAC;EACpC;EAEA2hB,IAAIA,CAAA,EAAG;IACH,IAAI,CAAC7C,aAAa,CAAC1R,IAAI,CAAC,IAAI,CAACqV,QAAQ,CAAC,CAAC,CAAC;IACxC,IAAI,CAACrD,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEA8hB,OAAOA,CAAA,EAAG;IACN,IAAI,CAAC1C,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;IAClB,IAAI,CAACyiB,QAAQ,CAAC,IAAI,CAAC3D,aAAa,CAAC7C,GAAG,CAAC,CAAC,CAAC;EAC3C;;EAGA;EACAyG,MAAMA,CAAC1f,CAAC,EAAEgb,CAAC,EAAE;IACT,IAAI,CAACoB,IAAI,CAACpc,CAAC,EAAE,GAAG,EAAEgb,CAAC,EAAE,IAAI,EAAEhe,EAAE,CAAC;EAClC;EAEA2iB,MAAMA,CAAC3f,CAAC,EAAEgb,CAAC,EAAE;IACT,IAAI,CAACoB,IAAI,CAACpc,CAAC,EAAE,GAAG,EAAEgb,CAAC,EAAE,IAAI,EAAEhe,EAAE,CAAC;EAClC;EAEA4iB,MAAMA,CAACC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE;IAC3B,IAAI,CAAC9D,IAAI,CAACyD,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,IAAI,EAAEljB,EAAE,CAAC;EACxE;EAEAmjB,OAAOA,CAACN,EAAE,EAAEC,EAAE,EAAEG,EAAE,EAAEC,EAAE,EAAE;IACpB,IAAI,CAAC9D,IAAI,CAACyD,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEG,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,IAAI,EAAEljB,EAAE,CAAC;EACtD;EAEAojB,OAAOA,CAACL,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE;IACpB,IAAI,CAAC9D,IAAI,CAAC2D,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,GAAG,EAAEC,EAAE,EAAE,IAAI,EAAEljB,EAAE,CAAC;EACtD;EAEAqjB,KAAKA,CAAA,EAAG;IACJ,IAAI,CAACjE,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEAgQ,IAAIA,CAAChN,CAAC,EAAEgb,CAAC,EAAEsF,CAAC,EAAEC,CAAC,EAAE;IACb,IAAI,CAACnE,IAAI,CAACpc,CAAC,EAAE,GAAG,EAAEgb,CAAC,EAAE,GAAG,EAAEsF,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,KAAK,EAAEvjB,EAAE,CAAC;EACnD;EAEAwjB,OAAOA,CAACxgB,CAAC,EAAEgb,CAAC,EAAEyF,EAAE,EAAEC,EAAE,EAAE;IAClB,SAASC,EAAEA,CAACC,CAAC,EAAE;MAAE,OAAO5gB,CAAC,GAAG4gB,CAAC;IAAE;IAC/B,SAASC,EAAEA,CAACD,CAAC,EAAE;MAAE,OAAO5F,CAAC,GAAG4F,CAAC;IAAE;;IAE/B;IACA;IACA,IAAIE,CAAC,GAAG,kBAAkB;IAE1B,IAAI,CAACpB,MAAM,CAACiB,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAACH,EAAE,CAAC,CAAC;IAC1B,IAAI,CAACd,MAAM,CACPe,EAAE,CAACF,EAAE,GAAGK,CAAC,CAAC,EAAGD,EAAE,CAACH,EAAE,CAAC,EACnBC,EAAE,CAACF,EAAE,CAAC,EAAOI,EAAE,CAACH,EAAE,GAAGI,CAAC,CAAC,EACvBH,EAAE,CAACF,EAAE,CAAC,EAAOI,EAAE,CAAC,CAAC,CACrB,CAAC;IACD,IAAI,CAACjB,MAAM,CACPe,EAAE,CAACF,EAAE,CAAC,EAAOI,EAAE,CAAC,CAACH,EAAE,GAAGI,CAAC,CAAC,EACxBH,EAAE,CAACF,EAAE,GAAGK,CAAC,CAAC,EAAGD,EAAE,CAAC,CAACH,EAAE,CAAC,EACpBC,EAAE,CAAC,CAAC,CAAC,EAAQE,EAAE,CAAC,CAACH,EAAE,CACvB,CAAC;IACD,IAAI,CAACd,MAAM,CACPe,EAAE,CAAC,CAACF,EAAE,GAAGK,CAAC,CAAC,EAAGD,EAAE,CAAC,CAACH,EAAE,CAAC,EACrBC,EAAE,CAAC,CAACF,EAAE,CAAC,EAAOI,EAAE,CAAC,CAACH,EAAE,GAAGI,CAAC,CAAC,EACzBH,EAAE,CAAC,CAACF,EAAE,CAAC,EAAOI,EAAE,CAAC,CAAC,CACtB,CAAC;IACD,IAAI,CAACjB,MAAM,CACPe,EAAE,CAAC,CAACF,EAAE,CAAC,EAAOI,EAAE,CAACH,EAAE,GAAGI,CAAC,CAAC,EACxBH,EAAE,CAAC,CAACF,EAAE,GAAGK,CAAC,CAAC,EAAGD,EAAE,CAACH,EAAE,CAAC,EACpBC,EAAE,CAAC,CAAC,CAAC,EAASE,EAAE,CAACH,EAAE,CACvB,CAAC;EACL;EAEAK,MAAMA,CAAC/gB,CAAC,EAAEgb,CAAC,EAAElC,CAAC,EAAE;IACZ,IAAI,CAAC0H,OAAO,CAACxgB,CAAC,EAAEgb,CAAC,EAAElC,CAAC,EAAEA,CAAC,CAAC;EAC5B;EAEAkI,MAAMA,CAAA,EAAG;IACL,IAAI,CAAC5E,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEAikB,GAAGA,CAAA,EAAG;IACF,IAAI,CAAC7E,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEAiQ,IAAIA,CAAA,EAAG;IACH,IAAI,CAACmP,IAAI,CAAC,KAAK,EAAEpf,EAAE,CAAC;EACxB;EAEAkkB,UAAUA,CAAA,EAAG;IACT,IAAI,CAAC9E,IAAI,CAAC,KAAK,EAAEpf,EAAE,CAAC;EACxB;EAEAmkB,WAAWA,CAAA,EAAG;IACV,IAAI,CAAC/E,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEAokB,IAAIA,CAAA,EAAG;IACH,IAAI,CAAChF,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEAqkB,UAAUA,CAAA,EAAG;IACT,IAAI,CAACjF,IAAI,CAAC,GAAG,EAAEpf,EAAE,CAAC;EACtB;EAEA2K,SAASA,CAACnE,GAAG,EAAE;IACX,IAAI6B,GAAG,GAAG,IAAI,CAACkN,IAAI,CAAC7E,QAAQ,CAAClK,GAAG,CAAC;IACjC,IAAI6B,GAAG,EAAE;MAAE;MACP,IAAI,CAACkW,WAAW,CAAClW,GAAG,CAACiJ,aAAa,CAAC,GAAGjJ,GAAG;MACzC,IAAI,CAAC+W,IAAI,CAAC/W,GAAG,CAACiJ,aAAa,EAAE,KAAK,EAAEtR,EAAE,CAAC;IAC3C;EACJ;EAEAskB,OAAOA,CAACxR,GAAG,EAAE;IACT,IAAIhG,IAAI,GAAG,IAAI;IACfgG,GAAG,CAACyR,KAAK,CAAC,QAAQ,CAAC,CAAC5X,OAAO,CAAC,UAAS6X,IAAI,EAAC;MACtC1X,IAAI,CAACsS,IAAI,CAAC,IAAI,EAAEoF,IAAI,EAAExkB,EAAE,CAAC;IAC7B,CAAC,CAAC;EACN;;EAEA;EACAyiB,QAAQA,CAACgC,GAAG,EAAE;IACV,IAAIA,GAAG,IAAI,IAAI,EAAE;MACb,IAAI,CAAC/F,QAAQ,GAAG+F,GAAG,CAAC5T,OAAO;MAC3B,IAAI,CAAC8N,OAAO,GAAG8F,GAAG,CAACC,MAAM;IAC7B,CAAC,MAAM;MACH,OAAO;QACH7T,OAAO,EAAE,IAAI,CAAC6N,QAAQ;QACtBgG,MAAM,EAAE,IAAI,CAAC/F;MACjB,CAAC;IACL;EACJ;EAEAqC,OAAOA,CAAC2D,CAAC,EAAE;IACP,IAAIje,CAAC,GAAG,IAAI,CAACiY,OAAO;IACpB,IAAItT,CAAC,GAAG3E,CAAC,CAAC,CAAC,CAAC;MAAEsV,CAAC,GAAGtV,CAAC,CAAC,CAAC,CAAC;MAAE0M,CAAC,GAAG1M,CAAC,CAAC,CAAC,CAAC;MAAE2Y,CAAC,GAAG3Y,CAAC,CAAC,CAAC,CAAC;MAAE4Y,CAAC,GAAG5Y,CAAC,CAAC,CAAC,CAAC;MAAElC,CAAC,GAAGkC,CAAC,CAAC,CAAC,CAAC;IAC9D,OAAO;MACH1D,CAAC,EAAEqI,CAAC,GAACsZ,CAAC,CAAC3hB,CAAC,GAAGoQ,CAAC,GAACuR,CAAC,CAAC3G,CAAC,GAAGsB,CAAC;MACpBtB,CAAC,EAAEhC,CAAC,GAAC2I,CAAC,CAAC3hB,CAAC,GAAGqc,CAAC,GAACsF,CAAC,CAAC3G,CAAC,GAAGxZ;IACvB,CAAC;EACL;AACJ;AAEA,SAASogB,OAAOA,CAACpT,GAAG,EAAE;EAClB,OAAOA,GAAG,CAAC1N,OAAO,CAAC,sBAAsB,EAAE,IAAI,CAAC;AACpD;AAEA,SAAS+gB,YAAYA,CAACC,OAAO,EAAE;EAC3B;EACA,IAAIrB,EAAE,GAAG,wIAAwI;EACjJ,IAAI/c,CAAC,GAAG+c,EAAE,CAAC7c,IAAI,CAACke,OAAO,CAAC;EACxB,IAAI,CAACpe,CAAC,EAAE;IACJ,OAAO;MAAEyQ,QAAQ,EAAE,EAAE;MAAE4N,UAAU,EAAE;IAAa,CAAC;EACrD;EACA,IAAI5N,QAAQ,GAAGzQ,CAAC,CAAC,CAAC,CAAC,GAAGse,QAAQ,CAACte,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE;EAC7C,OAAO;IACHue,MAAM,EAAOve,CAAC,CAAC,CAAC,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAACd,WAAW,CAAC,CAAC,IAAI,QAAQ;IACnDsf,OAAO,EAAMxe,CAAC,CAAC,CAAC,CAAC;IACjBye,IAAI,EAASze,CAAC,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC1C,IAAI,CAAC0C,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3CyQ,QAAQ,EAAKA,QAAQ;IACrBiO,UAAU,EAAG1e,CAAC,CAAC,EAAE,CAAC,GAAGA,CAAC,CAAC,EAAE,CAAC,IAAI,QAAQ,GAAGyQ,QAAQ,GAAG6N,QAAQ,CAACte,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,IAAI;IAC9Eqe,UAAU,EAAGre,CAAC,CAAC,EAAE,CAAC,CAAC6d,KAAK,CAAC,UAAU,CAAC,CAACtK,GAAG,CAAC2K,OAAO;EACpD,CAAC;AACL;AAEA,SAASS,UAAUA,CAACC,KAAK,EAAE;EACvB,SAASC,QAAQA,CAACtY,IAAI,EAAE;IACpB,IAAIqY,KAAK,CAACH,IAAI,EAAE;MACZlY,IAAI,IAAI,OAAO;IACnB;IACA,IAAIqY,KAAK,CAACL,MAAM,EAAE;MACdhY,IAAI,IAAI,SAAS;IACrB;IACA,OAAOA,IAAI,CAACrH,WAAW,CAAC,CAAC;EAC7B;EACA,IAAImf,UAAU,GAAGO,KAAK,CAACP,UAAU;EACjC,IAAI9X,IAAI,EAAEzG,GAAG;EACb,IAAIue,UAAU,YAAYjT,KAAK,EAAE;IAC7B,KAAK,IAAIjP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkiB,UAAU,CAAChiB,MAAM,EAAE,EAAEF,CAAC,EAAE;MACxCoK,IAAI,GAAGsY,QAAQ,CAACR,UAAU,CAACliB,CAAC,CAAC,CAAC;MAC9B2D,GAAG,GAAGgf,aAAa,CAACvY,IAAI,CAAC;MACzB,IAAIzG,GAAG,EAAE;QACL;MACJ;IACJ;EACJ,CAAC,MAAM;IACHA,GAAG,GAAGgf,aAAa,CAACT,UAAU,CAACnf,WAAW,CAAC,CAAC,CAAC;EACjD;EACA,OAAO,OAAOY,GAAG,IAAI,UAAU,EAAE;IAC7BA,GAAG,GAAGA,GAAG,CAAC,CAAC;EACf;EACA,IAAI,CAACA,GAAG,EAAE;IACNA,GAAG,GAAG,aAAa;EACvB;EACA,OAAOA,GAAG;AACd;AAEA,IAAIgf,aAAa,GAAG;EAChB,OAAO,EAAsB,aAAa;EAC1C,YAAY,EAAiB,YAAY;EACzC,cAAc,EAAe,cAAc;EAC3C,mBAAmB,EAAU,kBAAkB;EAC/C,YAAY,EAAiB,WAAW;EACxC,iBAAiB,EAAY,gBAAgB;EAC7C,mBAAmB,EAAU,mBAAmB;EAChD,wBAAwB,EAAK,uBAAuB;EACpD,WAAW,EAAkB,SAAS;EACtC,gBAAgB,EAAa,cAAc;EAC3C,kBAAkB,EAAW,iBAAiB;EAC9C,uBAAuB,EAAM,qBAAqB;EAClD,cAAc,EAAe,cAAc;EAC3C,mBAAmB,EAAU,cAAc;EAC3C,qBAAqB,EAAQ,cAAc;EAC3C,0BAA0B,EAAG;AACjC,CAAC;AAED,SAASC,SAASA,CAACC,KAAK,EAAEzY,IAAI,EAAE;EAC5ByY,KAAK,GAAGA,KAAK,CAAC9f,WAAW,CAAC,CAAC;EAC3B4f,aAAa,CAACE,KAAK,CAAC,GAAG,YAAW;IAC9B,OAAOF,aAAa,CAACvY,IAAI,CAAC;EAC9B,CAAC;EACDuY,aAAa,CAACE,KAAK,GAAG,OAAO,CAAC,GAAG,YAAW;IACxC,OAAOF,aAAa,CAACvY,IAAI,GAAG,OAAO,CAAC;EACxC,CAAC;EACDuY,aAAa,CAACE,KAAK,GAAG,SAAS,CAAC,GAAG,YAAW;IAC1C,OAAOF,aAAa,CAACvY,IAAI,GAAG,SAAS,CAAC;EAC1C,CAAC;EACDuY,aAAa,CAACE,KAAK,GAAG,cAAc,CAAC,GAAG,YAAW;IAC/C,OAAOF,aAAa,CAACvY,IAAI,GAAG,cAAc,CAAC;EAC/C,CAAC;AACL;;AAEA;AACA;AACA;;AAEAwY,SAAS,CAAC,iBAAiB,EAAG,OAAO,CAAC;AACtCA,SAAS,CAAC,aAAa,EAAO,WAAW,CAAC;AAC1CA,SAAS,CAAC,OAAO,EAAa,YAAY,CAAC;AAC3CA,SAAS,CAAC,WAAW,EAAS,YAAY,CAAC;AAC3CA,SAAS,CAAC,SAAS,EAAW,YAAY,CAAC;AAC3CA,SAAS,CAAC,QAAQ,EAAY,YAAY,CAAC;AAC3CA,SAAS,CAAC,SAAS,EAAW,YAAY,CAAC;AAC3CA,SAAS,CAAC,QAAQ,EAAY,WAAW,CAAC;AAC1CA,SAAS,CAAC,aAAa,EAAO,WAAW,CAAC;AAE1C,SAASE,UAAUA,CAAC1Y,IAAI,EAAEzG,GAAG,EAAE;EAC3B,IAAI1D,SAAS,CAACC,MAAM,IAAI,CAAC,EAAE;IACvB,KAAK,IAAIF,CAAC,IAAIoK,IAAI,EAAE;MAChB,IAAI0E,cAAc,CAAC1E,IAAI,EAAEpK,CAAC,CAAC,EAAE;QACzB8iB,UAAU,CAAC9iB,CAAC,EAAEoK,IAAI,CAACpK,CAAC,CAAC,CAAC;MAC1B;IACJ;EACJ,CAAC,MAAM;IACHoK,IAAI,GAAGA,IAAI,CAACrH,WAAW,CAAC,CAAC;IACzB4f,aAAa,CAACvY,IAAI,CAAC,GAAGzG,GAAG;;IAEzB;IACA;IACA;IACA,QAAQyG,IAAI;MACV,KAAK,aAAa;QAAiBuY,aAAa,CAAC,YAAY,CAAC,GAAgBhf,GAAG;QAAE;MACnF,KAAK,kBAAkB;QAAYgf,aAAa,CAAC,iBAAiB,CAAC,GAAWhf,GAAG;QAAE;MACnF,KAAK,oBAAoB;QAAUgf,aAAa,CAAC,mBAAmB,CAAC,GAAShf,GAAG;QAAE;MACnF,KAAK,yBAAyB;QAAKgf,aAAa,CAAC,wBAAwB,CAAC,GAAIhf,GAAG;QAAE;MACnF,KAAK,cAAc;QAAgBgf,aAAa,CAAC,OAAO,CAAC,GAAqBhf,GAAG;QAAE;MACnF,KAAK,mBAAmB;QAAWgf,aAAa,CAAC,YAAY,CAAC,GAAgBhf,GAAG;QAAE;MACnF,KAAK,qBAAqB;QAASgf,aAAa,CAAC,cAAc,CAAC,GAAchf,GAAG;QAAE;MACnF,KAAK,0BAA0B;QAAIgf,aAAa,CAAC,mBAAmB,CAAC,GAAShf,GAAG;QAAE;MACnF,KAAK,aAAa;QAAiBgf,aAAa,CAAC,WAAW,CAAC,GAAiBhf,GAAG;QAAE;MACnF,KAAK,kBAAkB;QAAYgf,aAAa,CAAC,gBAAgB,CAAC,GAAYhf,GAAG;QAAE;MACnF,KAAK,oBAAoB;QAAUgf,aAAa,CAAC,kBAAkB,CAAC,GAAUhf,GAAG;QAAE;MACnF,KAAK,yBAAyB;QAAKgf,aAAa,CAAC,uBAAuB,CAAC,GAAKhf,GAAG;QAAE;IACrF;EACJ;AACJ;AAEA,SAASgZ,IAAIA,CAACnU,CAAC,EAAE2Q,CAAC,EAAE;EAChB,IAAI5b,EAAE,GAAGiL,CAAC,CAAC,CAAC,CAAC;IAAEtK,EAAE,GAAGsK,CAAC,CAAC,CAAC,CAAC;IAAE3J,EAAE,GAAG2J,CAAC,CAAC,CAAC,CAAC;IAAEua,EAAE,GAAGva,CAAC,CAAC,CAAC,CAAC;IAAEwa,EAAE,GAAGxa,CAAC,CAAC,CAAC,CAAC;IAAEya,EAAE,GAAGza,CAAC,CAAC,CAAC,CAAC;EACpE,IAAIhL,EAAE,GAAG2b,CAAC,CAAC,CAAC,CAAC;IAAEhb,EAAE,GAAGgb,CAAC,CAAC,CAAC,CAAC;IAAEra,EAAE,GAAGqa,CAAC,CAAC,CAAC,CAAC;IAAE+J,EAAE,GAAG/J,CAAC,CAAC,CAAC,CAAC;IAAEgK,EAAE,GAAGhK,CAAC,CAAC,CAAC,CAAC;IAAEiK,EAAE,GAAGjK,CAAC,CAAC,CAAC,CAAC;EACpE,OAAO,CACH5b,EAAE,GAACC,EAAE,GAAGU,EAAE,GAACY,EAAE,EAAWvB,EAAE,GAACY,EAAE,GAAGD,EAAE,GAACglB,EAAE,EACrCrkB,EAAE,GAACrB,EAAE,GAAGulB,EAAE,GAACjkB,EAAE,EAAWD,EAAE,GAACV,EAAE,GAAG4kB,EAAE,GAACG,EAAE,EACrCF,EAAE,GAACxlB,EAAE,GAAGylB,EAAE,GAACnkB,EAAE,GAAGqkB,EAAE,EAAMH,EAAE,GAAC7kB,EAAE,GAAG8kB,EAAE,GAACC,EAAE,GAAGE,EAAE,CAC7C;AACL;AAEA,SAAS1G,gBAAgBA,CAAC7Y,CAAC,EAAE;EACzB,OAAOA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;AAC3F;AAEA,MAAMwf,mBAAmB,GAAG;EACxB9B,IAAI,EAAa,CAAC;EAClBJ,MAAM,EAAW,CAAC;EAClBmC,aAAa,EAAI,CAAC;EAClBC,SAAS,EAAQ,CAAC;EAClBC,WAAW,EAAM,CAAC;EAClBC,aAAa,EAAI,CAAC;EAClBC,cAAc,EAAG,CAAC;EAClBtW,IAAI,EAAa;AACrB,CAAC;AAED,SACIrD,WAAW,IAAI4Z,QAAQ,EACvBpnB,YAAY,EACZumB,UAAU,EACVd,YAAY,EACZQ,UAAU,EACVhZ,SAAS,EACTC,UAAU,EACVhH,eAAe,EACf4C,eAAe,EACfge,mBAAmB"},"metadata":{},"sourceType":"module","externalDependencies":[]}